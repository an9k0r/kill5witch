<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="day-prompt" content="days ago"><meta name="hour-prompt" content="hours ago"><meta name="minute-prompt" content="minutes ago"><meta name="justnow-prompt" content="just now"><meta name="generator" content="Jekyll v4.2.1" /><meta property="og:title" content="(Portswigger/WebAcademy) - JWT Token Vulnerabilities" /><meta name="author" content="eng4ge" /><meta property="og:locale" content="en" /><meta name="description" content="Intro This post/writeup is all about the JWT Token Vulnerabilities." /><meta property="og:description" content="Intro This post/writeup is all about the JWT Token Vulnerabilities." /><link rel="canonical" href="https://an9k0r.github.io/posts/JWT_Token/" /><meta property="og:url" content="https://an9k0r.github.io/posts/JWT_Token/" /><meta property="og:site_name" content="CyberSec-Research.Space" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2023-01-15T08:00:00+01:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="(Portswigger/WebAcademy) - JWT Token Vulnerabilities" /><meta name="twitter:site" content="@cybersec_space" /><meta name="twitter:creator" content="@eng4ge" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"author":{"@type":"Person","name":"eng4ge"},"description":"Intro This post/writeup is all about the JWT Token Vulnerabilities.","headline":"(Portswigger/WebAcademy) - JWT Token Vulnerabilities","dateModified":"2023-01-21T19:31:35+01:00","url":"https://an9k0r.github.io/posts/JWT_Token/","datePublished":"2023-01-15T08:00:00+01:00","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://an9k0r.github.io/posts/JWT_Token/"},"@context":"https://schema.org"}</script><title>(Portswigger/WebAcademy) - JWT Token Vulnerabilities | CyberSec-Research.Space</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="CyberSec-Research.Space"><meta name="application-name" content="CyberSec-Research.Space"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc" topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end" lang="en"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/images/logo.jpeg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">CyberSec-Research.Space</a></div><div class="site-subtitle font-italic">Information Security Personal Blog</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/blogging/" class="nav-link"> <i class="fa-fw fas fa-book ml-xl-3 mr-xl-3 unloaded"></i> <span>BLOGS AND GUIDES</span> </a><li class="nav-item"> <a href="/hack_the_box/" class="nav-link"> <i class="fa-fw fas fa-bug ml-xl-3 mr-xl-3 unloaded"></i> <span>HACK THE BOX</span> </a><li class="nav-item"> <a href="/blue_team_ctf/" class="nav-link"> <i class="fa-fw fas fa-anchor ml-xl-3 mr-xl-3 unloaded"></i> <span>BLUE TEAM CTFS</span> </a><li class="nav-item"> <a href="/web_application/" class="nav-link"> <i class="fa-fw fas fa-terminal ml-xl-3 mr-xl-3 unloaded"></i> <span>WEB APPLICATION</span> </a><li class="nav-item"> <a href="/binary_exploitation/" class="nav-link"> <i class="fa-fw fas fa-microchip ml-xl-3 mr-xl-3 unloaded"></i> <span>BINARY EXPLOITATION</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/an9k0r" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/cybersec_space" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['',''].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>(Portswigger/WebAcademy) - JWT Token Vulnerabilities</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>(Portswigger/WebAcademy) - JWT Token Vulnerabilities</h1><div class="post-meta text-muted"><div> By <em> <a href="https://github.com/an9k0r">eng4ge</a> </em></div><div class="d-flex"><div> <span> Posted <em class="timeago" date="2023-01-15 08:00:00 +0100" data-toggle="tooltip" data-placement="bottom" title="Sun, Jan 15, 2023, 8:00 AM +0100" >Jan 15</em> </span> <span> Updated <em class="timeago" date="2023-01-21 19:31:35 +0100 " data-toggle="tooltip" data-placement="bottom" title="Sat, Jan 21, 2023, 7:31 PM +0100" >Jan 21</em> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1436 words"> <em>7 min</em> read</span></div></div></div><div class="post-content"><h1 id="intro">Intro</h1><p>This post/writeup is all about the JWT Token Vulnerabilities.</p><p>I’ll be using primarily <a href="https://portswigger.net/web-security/jwt">Portswigger Web Academy</a> Labs, but i do intent do throw other labs and writeups here as well.</p><p>To learn more on the topic, please visit the article linked above at Portswigger’s.</p><h2 id="toc">TOC<a href="#toc" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><ul><li><a href="#intro">Intro</a><ul><li><a href="#toc">TOC</a></ul><li><a href="#jwt-authentication-bypass-via-unverified-signature">JWT authentication bypass via unverified signature</a><li><a href="#jwt-authentication-bypass-via-flawed-signature-verification">JWT authentication bypass via flawed signature verification</a><li><a href="#jwt-authentication-bypass-via-weak-signing-key">JWT authentication bypass via weak signing key</a><li><a href="#jwt-authentication-bypass-via-jwk-header-injection">JWT authentication bypass via jwk header injection</a><li><a href="#jwt-authentication-bypass-via-jku-header-injection">JWT authentication bypass via jku header injection</a><li><a href="#jwt-authentication-bypass-via-kid-header-path-traversal">JWT authentication bypass via kid header path traversal</a><li><a href="#jwt-authentication-bypass-via-algorithm-confusion">JWT authentication bypass via algorithm confusion</a><li><a href="#jwt-authentication-bypass-via-algorithm-confusion-with-no-exposed-key">JWT authentication bypass via algorithm confusion with no exposed key</a></ul><h1 id="jwt-authentication-bypass-via-unverified-signature">JWT authentication bypass via unverified signature</h1><blockquote><p>This lab uses a JWT-based mechanism for handling sessions. Due to implementation flaws, the server doesn’t verify the signature of any JWTs that it receives.</p><p>To solve the lab, modify your session token to gain access to the admin panel at /admin, then delete the user carlos.</p><p>You can log in to your own account using the following credentials: wiener:peter</p></blockquote><p>We can login using provided credentials <code class="language-plaintext highlighter-rouge">wiener:peter</code>.</p><p><img data-src="/assets/images/ee89ffeb3e8c69b058b55fbd299965dffc48dab781b6bc6fe59d04dd7438a611.png" alt="picture 1" data-proofer-ignore></p><p>We should take a look at JWT token.</p><p>I’ll be using <code class="language-plaintext highlighter-rouge">JWT Editor</code> Burp Extension</p><p><img data-src="/assets/images/52b5947600ae493909dfb15a1112239824435198cfad100ec2f37f02ee347bc6.png" alt="picture 2" data-proofer-ignore></p><p>We can intercept and simply change <code class="language-plaintext highlighter-rouge">wiener</code> to <code class="language-plaintext highlighter-rouge">administrator</code> as signature isn’t being verified</p><p><img data-src="/assets/images/7a4697a4c29aa3dcb0dc88eee493b153cc282f89125d6cff73646c87f4547f76.png" alt="picture 3" data-proofer-ignore></p><p>We can reach the <code class="language-plaintext highlighter-rouge">/admin</code> panel where we can delete user <code class="language-plaintext highlighter-rouge">carlos</code> in order to solve the lab</p><p><img data-src="/assets/images/5d6fdae0f5365b7f289ca279b0278139d55b50db742e69bbe888b09c786a4168.png" alt="picture 4" data-proofer-ignore></p><p>Alternatively, we could simply change the user on <code class="language-plaintext highlighter-rouge">https://jwt.io</code> and copy-paste the token.</p><h1 id="jwt-authentication-bypass-via-flawed-signature-verification">JWT authentication bypass via flawed signature verification</h1><blockquote><p>This lab uses a JWT-based mechanism for handling sessions. The server is insecurely configured to accept unsigned JWTs.</p><p>To solve the lab, modify your session token to gain access to the admin panel at /admin, then delete the user carlos.</p><p>You can log in to your own account using the following credentials: wiener:peter</p></blockquote><p>Same as in the previous lab, spin the lab and login using provided credentials <code class="language-plaintext highlighter-rouge">wiener:peter</code>.</p><p><img data-src="/assets/images/564a64a9b21f987b5221ad03a6c6d84a608a11e747d2f030f433c29db005ae1f.png" alt="picture 5" data-proofer-ignore></p><p>Let’s check the JWT Token using <code class="language-plaintext highlighter-rouge">JWT Editor</code> in Burp.</p><p><img data-src="/assets/images/2ae0241ea56a8f64cfefb5f4edba11c9a8978fb3df311f5dfded06fe909c0551.png" alt="picture 6" data-proofer-ignore></p><p>Let’s try <code class="language-plaintext highlighter-rouge">none signing algorithm</code></p><p><img data-src="/assets/images/aacb1623b354f013d1d340d739c3c5ebdd3ddaaa88d18054d584113bb128fa6a.png" alt="picture 7" data-proofer-ignore></p><p>Paste the token in the browser and delete <code class="language-plaintext highlighter-rouge">carlos</code> in order to solve the lab.</p><p><img data-src="/assets/images/349f499862ecff52755130a3915fe37f06a89e61d43feea704288f8d8bda7b8a.png" alt="picture 8" data-proofer-ignore></p><p>Alternatively we could use <code class="language-plaintext highlighter-rouge">wiener</code>’s token and run it througt <code class="language-plaintext highlighter-rouge">jwt_tool</code></p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>jwt_tool eyJraWQiOiJhNjI5OTk2My1jYmIwLTQ0NmMtOTk0YS01MzNjZjk5MWNiMjAiLCJhbGciOiJSUzI1NiJ9.eyJpc3MiOiJwb3J0c3dpZ2dlciIsInN1YiI6IndpZW5lciIsImV4cCI6MTY3Mzg5ODY5NH0.dSMupWeq6dJxk9WOqDjW9Hv2wrOs2y29fhig24pwroH6vI8gmO6lU-Zniz3T8eCrvpGz8Bs36RK0PWKxTcsWfvI68LMbwuud9pmHwg5hpTGMXphZptTYTmh_T1Cu-J9gzRJVLvYkKobseJ_z5PISh5f0nTNuF5QIpV7nZ2s-bLD7OxrwNl3VTjDqUQOIS13l9Xn-jPs28IyQiskI8IbOe4EpRUDfc8179Xa-w5l4LV_QD3rQcDyybq6fvkow6kw_tE01G2Ck4qTAQxImXcM-nIICW-vwssqZQYVCZ6hLui-IKbMgnssQOayEhwC1Vqg2FEQr0WN8uQMEKdZrjvasJw -pc sub -pv administator -I -X a
</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">-pc</code> and <code class="language-plaintext highlighter-rouge">-pv</code> will change payload value from <code class="language-plaintext highlighter-rouge">wiener</code> to <code class="language-plaintext highlighter-rouge">administrator</code> and <code class="language-plaintext highlighter-rouge">-X a</code> means attack - <code class="language-plaintext highlighter-rouge">algo:none</code></p><h1 id="jwt-authentication-bypass-via-weak-signing-key">JWT authentication bypass via weak signing key</h1><blockquote><p>This lab uses a JWT-based mechanism for handling sessions. It uses an extremely weak secret key to both sign and verify tokens. This can be easily brute-forced using a <a href="https://github.com/wallarm/jwt-secrets/blob/master/jwt.secrets.list">wordlist of common secrets</a>.</p><p>To solve the lab, first brute-force the website’s secret key. Once you’ve obtained this, use it to sign a modified session token that gives you access to the admin panel at /admin, then delete the user carlos.</p><p>You can log in to your own account using the following credentials: wiener:peter</p></blockquote><p>This one i’ll make it short as it’s relatively simple. We login using ´wiener:peter´. Run hashcat against the hash</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>hashcat hash ../wordlists/jwt.secrets.list -m 16500
</pre></table></code></div></div><p>Use either <code class="language-plaintext highlighter-rouge">https://jwt.io</code> or jwt_tool and sign the token back using found secret key.</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>jwt_tool eyJraWQiOiIxZDlkNWZhMS0xMWRjLTQzZWMtYjZjZC1jOGYxM2YxOTk2ZTIiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJwb3J0c3dpZ2dlciIsInN1YiI6IndpZW5lciIsImV4cCI6MTY3Mzg5OTcxM30.hUWLKQ6Fyrc1iywdg2Iv8_DFmzal7cvR3OD1UbS5mRg -pc sub -pv administrator -I -p secret1 -S hs256
</pre></table></code></div></div><p>Exchange the token new one and delete <code class="language-plaintext highlighter-rouge">carlos</code></p><h1 id="jwt-authentication-bypass-via-jwk-header-injection">JWT authentication bypass via jwk header injection</h1><blockquote><p>This lab uses a JWT-based mechanism for handling sessions. The server supports the jwk parameter in the JWT header. This is sometimes used to embed the correct verification key directly in the token. However, it fails to check whether the provided key came from a trusted source.</p><p>To solve the lab, modify and sign a JWT that gives you access to the admin panel at /admin, then delete the user carlos.</p><p>You can log in to your own account using the following credentials: wiener:peter</p></blockquote><p>As in previous lab, login using <code class="language-plaintext highlighter-rouge">wiener:peter</code> and intercept the request.</p><p><img data-src="/assets/images/e713168ac32f2e5be7b438a6c475679a239fdce7806e6d9ac743b42dcde29f0e.png" alt="picture 9" data-proofer-ignore></p><p>Choose Embeded JWK in <code class="language-plaintext highlighter-rouge">Attack</code>, but bear in mind that you need to have generated RSA key before that. Change <code class="language-plaintext highlighter-rouge">wiener</code> to <code class="language-plaintext highlighter-rouge">administrator</code>.</p><p><img data-src="/assets/images/8fe0dc4c4cd4e4dc8690d5d851e8a562678beef3c4961d9ad9d3c1bf66106f21.png" alt="picture 10" data-proofer-ignore></p><p>When using the new token, <code class="language-plaintext highlighter-rouge">/admin</code> should be reachable where we can delete <code class="language-plaintext highlighter-rouge">carlos</code> in order to solve the lab.</p><p><img data-src="/assets/images/eb12764cbec4ab87e78940f976751cf2c83a78ed179ae2db44fa13db8fb3d95d.png" alt="picture 11" data-proofer-ignore></p><h1 id="jwt-authentication-bypass-via-jku-header-injection">JWT authentication bypass via jku header injection</h1><blockquote><p>This lab uses a JWT-based mechanism for handling sessions. The server supports the jku parameter in the JWT header. However, it fails to check whether the provided URL belongs to a trusted domain before fetching the key.</p><p>To solve the lab, forge a JWT that gives you access to the admin panel at /admin, then delete the user carlos.</p><p>You can log in to your own account using the following credentials: wiener:peter</p></blockquote><p>We will copy public key of our RSA certificate which will be used for signing.</p><p><img data-src="/assets/images/e6ae8c73138833d49c0704ec2b01b83481b2aeebe60dd377a087e94510c0802a.png" alt="picture 15" data-proofer-ignore></p><p>This is what our exploit server will serve. We have copied public key.</p><p><img data-src="/assets/images/390c9aa08e8f72e08d8834f477b9efc5bc7893794ebbc9ef9bc3e252db0b0822.png" alt="picture 16" data-proofer-ignore></p><p>We need to add <code class="language-plaintext highlighter-rouge">jku</code> header which points to our exploit server.</p><p><img data-src="/assets/images/3e0351b4c54fd4b1f8f5302c0dd1bae52cd9f70d750b8936681adcac4ef69bea.png" alt="picture 14" data-proofer-ignore></p><p>Now we can delete user <code class="language-plaintext highlighter-rouge">carlos</code> in order to solve the lab.</p><p><img data-src="/assets/images/e2b32bc00079024910fd94731a952deb332ff054e27b121b74351ca3455239a3.png" alt="picture 13" data-proofer-ignore></p><p>We can also verify that requests have been made towards our exploit server.</p><p><img data-src="/assets/images/3ff74c24927f6630c06c99426d575b5fd39cc5bd6bd6b9258300882457cfaa05.png" alt="picture 12" data-proofer-ignore></p><h1 id="jwt-authentication-bypass-via-kid-header-path-traversal">JWT authentication bypass via kid header path traversal</h1><blockquote><p>This lab uses a JWT-based mechanism for handling sessions. In order to verify the signature, the server uses the kid parameter in JWT header to fetch the relevant key from its filesystem.</p><p>To solve the lab, forge a JWT that gives you access to the admin panel at /admin, then delete the user carlos.</p><p>You can log in to your own account using the following credentials: wiener:peter</p></blockquote><p>As in previous labs, login using <code class="language-plaintext highlighter-rouge">wiener:peter</code> and check the Token in <code class="language-plaintext highlighter-rouge">JWT Editor</code>:</p><p><img data-src="/assets/images/e6a6c6567c60177f14387e4137a4fb734c43fc4642de8deea61a9ec4f01d1c7a.png" alt="picture 17" data-proofer-ignore></p><p>Admin interface is still only available to administrator</p><p><img data-src="/assets/images/c9bfde721ee953e12f2f1dc6b4724a429d164cc39f56729febed882e52fb61d9.png" alt="picture 18" data-proofer-ignore></p><p>For this attack we’ll need <code class="language-plaintext highlighter-rouge">Symmetric Key</code> ready from <code class="language-plaintext highlighter-rouge">JWT Editor</code>.</p><p><img data-src="/assets/images/c37f2adf7aba95768e1b700e714d8459570661b178e15d67c14f92fac0a349e1.png" alt="picture 19" data-proofer-ignore></p><p>Exchange the <code class="language-plaintext highlighter-rouge">k</code> value with <code class="language-plaintext highlighter-rouge">AA==</code> (this is not necesarry for an attack, but it’s just workaround for Burp)</p><p>Change the <code class="language-plaintext highlighter-rouge">kid</code> and sub payload/header values accordingly.</p><p><img data-src="/assets/images/b5f5fb5d45826697790d19232857d7e764b646b5f68049ed6686b979eef10e1c.png" alt="picture 21" data-proofer-ignore></p><p>Now exchange the token and delete <code class="language-plaintext highlighter-rouge">carlos</code> in order to finish the lab.</p><p><img data-src="/assets/images/c2b2ee0c7bb1b2f61d39e82901202d6abacad9ac0fad0f3f4a5dc28827620cc1.png" alt="picture 20" data-proofer-ignore></p><h1 id="jwt-authentication-bypass-via-algorithm-confusion">JWT authentication bypass via algorithm confusion</h1><blockquote><p>This lab uses a JWT-based mechanism for handling sessions. It uses a robust RSA key pair to sign and verify tokens. However, due to implementation flaws, this mechanism is vulnerable to algorithm confusion attacks.</p><p>To solve the lab, first obtain the server’s public key. This is exposed via a standard endpoint. Use this key to sign a modified session token that gives you access to the admin panel at /admin, then delete the user carlos.</p><p>You can log in to your own account using the following credentials: wiener:peter</p></blockquote><hr /><p>Make sure you check this article first so the lab actually makes sense ==&gt; https://portswigger.net/web-security/jwt/algorithm-confusion</p><hr /><p>We can login using <code class="language-plaintext highlighter-rouge">wiener:peter</code> and we’d notice that JWT is hardened however there’s an endpoint exposing a JWK set containing single public key:</p><p><img data-src="/assets/images/70808173319319c324446a5d454256934d7c5788f08b13839ceb24f926e12464.png" alt="picture 22" data-proofer-ignore></p><p>Using that public key we’ll create a new RSA key, so copy the key into <code class="language-plaintext highlighter-rouge">New RSA Key</code> in <code class="language-plaintext highlighter-rouge">Burp's JWT Editor Keys</code>:</p><p><img data-src="/assets/images/ce0caf45dcd1c494dfe5d9a0e665d1768171952fc6e38937a2dfaa175af22da1.png" alt="picture 23" data-proofer-ignore></p><p>Save the RSA key and copy the public key in PEM and encode it using BASE64 (we can use decoder).</p><p>We can now create <code class="language-plaintext highlighter-rouge">New Symmetric Key</code> and save the base64 encoded PEM public key into <code class="language-plaintext highlighter-rouge">k</code> !</p><p><img data-src="/assets/images/0759b65cac24d6ae07810c259943d827497346881d43515469aa50e1ddcd1301.png" alt="picture 24" data-proofer-ignore></p><p>This is now original request if we’ve logged in and tried access <code class="language-plaintext highlighter-rouge">/admin</code>:</p><p><img data-src="/assets/images/54edf88e4fe36602b4360648bae506f2c184d696cc0c0c7e957af0bf90e8c6c3.png" alt="picture 25" data-proofer-ignore></p><p>We have to change <code class="language-plaintext highlighter-rouge">alg</code> to <code class="language-plaintext highlighter-rouge">HS256</code> and <code class="language-plaintext highlighter-rouge">sub</code> to <code class="language-plaintext highlighter-rouge">administrator</code> and sign the token using <code class="language-plaintext highlighter-rouge">Symmetric Key</code> we’ve created moments before.</p><p><img data-src="/assets/images/02a8a9b5f7dd8af30d34e27db895124221c83c30b08cd4603f285ccfa6ee08c2.png" alt="picture 26" data-proofer-ignore></p><p>Exchange the token and delete <code class="language-plaintext highlighter-rouge">carlos</code> in order to solve the lab.</p><h1 id="jwt-authentication-bypass-via-algorithm-confusion-with-no-exposed-key">JWT authentication bypass via algorithm confusion with no exposed key</h1><blockquote><p>This lab uses a JWT-based mechanism for handling sessions. It uses a robust RSA key pair to sign and verify tokens. However, due to implementation flaws, this mechanism is vulnerable to algorithm confusion attacks.</p><p>To solve the lab, first obtain the server’s public key. Use this key to sign a modified session token that gives you access to the admin panel at /admin, then delete the user carlos.</p><p>You can log in to your own account using the following credentials: wiener:peter</p></blockquote><hr /><p>Make sure you check this article first so the lab actually makes sense ==&gt; https://portswigger.net/web-security/jwt/algorithm-confusion</p><hr /><p>For this lab we’ll need two valid tokens, so we’ll login 2 times to get 2 different tokens for single user.</p><p>Both tokens will be piped into a tool <code class="language-plaintext highlighter-rouge">sign2n</code>. The reason why i’m not using docker container from <code class="language-plaintext highlighter-rouge">portswigger/sig2n</code> is because it does not work out of the box for me and basically does the same as https://github.com/silentsignal/rsa_sign2n/tree/release/standalone. Choose either one.</p><p><img data-src="/assets/images/271498e7b7de17ceeb591a11c98f6e4c7150656ff10d790fc7e5bdde67220410.png" alt="picture 27" data-proofer-ignore></p><p>First token worked and i was logged in as <code class="language-plaintext highlighter-rouge">wiener</code>.</p><p>I’ve used <code class="language-plaintext highlighter-rouge">cat</code> on the <code class="language-plaintext highlighter-rouge">x509.pem</code> key and piped it into <code class="language-plaintext highlighter-rouge">bash64</code>.</p><p>Now create a new <code class="language-plaintext highlighter-rouge">Symmetric Key</code> and exchange the <code class="language-plaintext highlighter-rouge">k</code> bash64 encoded value above.</p><p>Change the <code class="language-plaintext highlighter-rouge">alg</code> and <code class="language-plaintext highlighter-rouge">sub</code> and sign the token using <code class="language-plaintext highlighter-rouge">Symmetric Key</code> that was generated above.</p><p><img data-src="/assets/images/4f2be5f4e21be2dd18120bac7b920f5e6001d4d80852bac6179224aad3b5f078.png" alt="picture 28" data-proofer-ignore></p><p>Delete <code class="language-plaintext highlighter-rouge">carlos</code> to solve the lab.</p><p><img data-src="/assets/images/6ea643ac3b02daaa55b37e0c871e3b007caadb32f99b571a36411b65c2437c9c.png" alt="picture 29" data-proofer-ignore></p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/web-application/'>Web Application</a>, <a href='/categories/jwt-token-vulnerabilities/'>JWT Token Vulnerabilities</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/notes/" class="post-tag no-text-decoration" >Notes</a> <a href="/tags/jwt-token-attacks/" class="post-tag no-text-decoration" >JWT Token Attacks</a> <a href="/tags/portswigger/" class="post-tag no-text-decoration" >Portswigger</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=(Portswigger/WebAcademy) - JWT Token Vulnerabilities - CyberSec-Research.Space&url=https://an9k0r.github.io/posts/JWT_Token/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=(Portswigger/WebAcademy) - JWT Token Vulnerabilities - CyberSec-Research.Space&u=https://an9k0r.github.io/posts/JWT_Token/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=(Portswigger/WebAcademy) - JWT Token Vulnerabilities - CyberSec-Research.Space&url=https://an9k0r.github.io/posts/JWT_Token/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/insecure_deserialization/">(Portswigger/WebAcademy) - Insecure Deserialization vulnerabilities</a><li><a href="/posts/ssti/">(Portswigger/WebAcademy) - Server-Side Template Injection vulnerabilities</a><li><a href="/posts/stored_XSS/">(Portswigger/WebAcademy) - Stored Cross-Site Scripting (XSS)</a><li><a href="/posts/Blind_SQL_Injection/">Blind SQL Injection</a><li><a href="/posts/OS_Command_Injection/">OS Command Injection</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/notes/">Notes</a> <a class="post-tag" href="/tags/portswigger/">Portswigger</a> <a class="post-tag" href="/tags/web-application/">Web Application</a> <a class="post-tag" href="/tags/linux/">Linux</a> <a class="post-tag" href="/tags/clear-text-credentials/">Clear Text Credentials</a> <a class="post-tag" href="/tags/password-reuse/">Password Reuse</a> <a class="post-tag" href="/tags/windows/">Windows</a> <a class="post-tag" href="/tags/deserialization/">Deserialization</a> <a class="post-tag" href="/tags/misconfiguration/">Misconfiguration</a> <a class="post-tag" href="/tags/password-cracking/">Password Cracking</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/websockets/"><div class="card-body"> <em class="timeago small" date="2023-01-15 08:00:00 +0100" >Jan 15</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>(Portswigger/WebAcademy) - Websockets</h3><div class="text-muted small"><p> Intro This post/writeup is all about the insecure deserialization vulnerabilities. I’ll be using primarily Portswigger Web Academy Labs, but i do intent do throw other labs and writeups here as we...</p></div></div></a></div><div class="card"> <a href="/posts/DOM_based_vulns/"><div class="card-body"> <em class="timeago small" date="2023-01-15 08:00:00 +0100" >Jan 15</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>(Portswigger/WebAcademy) - DOM-based Vulnerabilities</h3><div class="text-muted small"><p> Intro This post/writeup is all about the DOM-based Vulnerabilitiess. I’ll be using primarily Portswigger Web Academy Labs, but i do intent do throw other labs and writeups here as well. To learn ...</p></div></div></a></div><div class="card"> <a href="/posts/stored_XSS/"><div class="card-body"> <em class="timeago small" date="2023-01-25 08:00:00 +0100" >Jan 25</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>(Portswigger/WebAcademy) - Stored Cross-Site Scripting (XSS)</h3><div class="text-muted small"><p> Intro This post/writeup is all about the stored XSS Vulnerabilities. I’ll be using primarily Portswigger Web Academy Labs, but i do intent do throw other labs and writeups here as well. To learn ...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/vapi_writeup/" class="btn btn-outline-primary" prompt="Older"><p>Vulnerable Lab by Tushar Kulkarni (@roottusk) - vAPI (writeup)</p></a> <a href="/posts/oauth/" class="btn btn-outline-primary" prompt="Newer"><p>(Portswigger/WebAcademy) - OAuth 2.0 authentication vulnerabilities</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center text-muted"><div class="footer-left"><p class="mb-0"> © 2023 <a href="https://twitter.com/cybersec_space">eng4ge</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/notes/">Notes</a> <a class="post-tag" href="/tags/portswigger/">Portswigger</a> <a class="post-tag" href="/tags/web-application/">Web Application</a> <a class="post-tag" href="/tags/linux/">Linux</a> <a class="post-tag" href="/tags/clear-text-credentials/">Clear Text Credentials</a> <a class="post-tag" href="/tags/password-reuse/">Password Reuse</a> <a class="post-tag" href="/tags/windows/">Windows</a> <a class="post-tag" href="/tags/deserialization/">Deserialization</a> <a class="post-tag" href="/tags/misconfiguration/">Misconfiguration</a> <a class="post-tag" href="/tags/password-cracking/">Password Cracking</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><script src="https://cdn.jsdelivr.net/npm/mermaid@8/dist/mermaid.min.js"></script> <script> $(function() { function updateMermaid(event) { if (event.source === window && event.data && event.data.direction === ModeToggle.ID) { const mode = event.data.message; if (typeof mermaid === "undefined") { return; } let expectedTheme = (mode === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* Re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } let initTheme = "default"; if ($("html[mode=dark]").length > 0 || ($("html[mode]").length == 0 && window.matchMedia("(prefers-color-scheme: dark)").matches ) ) { initTheme = "dark"; } let mermaidConf = { theme: initTheme /* <default|dark|forest|neutral> */ }; /* Markdown converts to HTML */ $("pre").has("code.language-mermaid").each(function() { let svgCode = $(this).children().html(); $(this).addClass("unloaded"); $(this).after(`<div class=\"mermaid\">${svgCode}</div>`); }); mermaid.initialize(mermaidConf); window.addEventListener("message", updateMermaid); }); </script><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script> /* see: <https://docs.mathjax.org/en/latest/options/input/tex.html#tex-options> */ MathJax = { tex: { inlineMath: [ /* start/end delimiter pairs for in-line math */ ['$','$'], ['\\(','\\)'] ], displayMath: [ /* start/end delimiter pairs for display math */ ['$$', '$$'], ['\\[', '\\]'] ] } }; </script> <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script type="text/javascript" id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"> </script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.16.1,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/app.js"></script>
