<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="day-prompt" content="days ago"><meta name="hour-prompt" content="hours ago"><meta name="minute-prompt" content="minutes ago"><meta name="justnow-prompt" content="just now"><meta name="generator" content="Jekyll v4.2.1" /><meta property="og:title" content="Broken Access Control" /><meta name="author" content="eng4ge" /><meta property="og:locale" content="en" /><meta name="description" content="Intro This post/writeup is all about the Broken access control." /><meta property="og:description" content="Intro This post/writeup is all about the Broken access control." /><link rel="canonical" href="https://an9k0r.github.io/posts/Broken_Access_Control/" /><meta property="og:url" content="https://an9k0r.github.io/posts/Broken_Access_Control/" /><meta property="og:site_name" content="CyberSec-Research.Space" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-10-08T09:00:00+02:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Broken Access Control" /><meta name="twitter:site" content="@cybersec_space" /><meta name="twitter:creator" content="@eng4ge" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"author":{"@type":"Person","name":"eng4ge"},"description":"Intro This post/writeup is all about the Broken access control.","headline":"Broken Access Control","dateModified":"2022-10-11T15:35:20+02:00","url":"https://an9k0r.github.io/posts/Broken_Access_Control/","datePublished":"2022-10-08T09:00:00+02:00","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://an9k0r.github.io/posts/Broken_Access_Control/"},"@context":"https://schema.org"}</script><title>Broken Access Control | CyberSec-Research.Space</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="CyberSec-Research.Space"><meta name="application-name" content="CyberSec-Research.Space"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc" topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end" lang="en"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/images/logo.jpeg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">CyberSec-Research.Space</a></div><div class="site-subtitle font-italic">Information Security Personal Blog</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/blogging/" class="nav-link"> <i class="fa-fw fas fa-book ml-xl-3 mr-xl-3 unloaded"></i> <span>BLOGS AND GUIDES</span> </a><li class="nav-item"> <a href="/hack_the_box/" class="nav-link"> <i class="fa-fw fas fa-bug ml-xl-3 mr-xl-3 unloaded"></i> <span>HACK THE BOX</span> </a><li class="nav-item"> <a href="/blue_team_ctf/" class="nav-link"> <i class="fa-fw fas fa-anchor ml-xl-3 mr-xl-3 unloaded"></i> <span>BLUE TEAM CTFS</span> </a><li class="nav-item"> <a href="/web_application/" class="nav-link"> <i class="fa-fw fas fa-terminal ml-xl-3 mr-xl-3 unloaded"></i> <span>WEB APPLICATION</span> </a><li class="nav-item"> <a href="/binary_exploitation/" class="nav-link"> <i class="fa-fw fas fa-microchip ml-xl-3 mr-xl-3 unloaded"></i> <span>BINARY EXPLOITATION</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/an9k0r" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/cybersec_space" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['',''].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Broken Access Control</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Broken Access Control</h1><div class="post-meta text-muted"><div> By <em> <a href="https://github.com/an9k0r">eng4ge</a> </em></div><div class="d-flex"><div> <span> Posted <em class="timeago" date="2022-10-08 09:00:00 +0200" data-toggle="tooltip" data-placement="bottom" title="Sat, Oct 8, 2022, 9:00 AM +0200" >Oct 8, 2022</em> </span> <span> Updated <em class="timeago" date="2022-10-11 15:35:20 +0200 " data-toggle="tooltip" data-placement="bottom" title="Tue, Oct 11, 2022, 3:35 PM +0200" >Oct 11, 2022</em> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1704 words"> <em>9 min</em> read</span></div></div></div><div class="post-content"><h1 id="intro">Intro</h1><p>This post/writeup is all about the Broken access control.</p><p>I’ll be using primarily <a href="https://portswigger.net/web-security/access-control">Portswigger Web Academy</a> Labs, but i do intent do throw other labs and writeups here as well.</p><p>Information disclosure is all about disclosing information that was not intended to be exposed to user, like debug page for example or leaks data that is intended for privileged or other users.</p><h2 id="toc">TOC<a href="#toc" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><ul><li><a href="#intro">Intro</a><ul><li><a href="#toc">TOC</a></ul><li><a href="#theory">Theory</a><li><a href="#unprotected-admin-functionality">Unprotected admin functionality</a><li><a href="#unprotected-admin-functionality-with-unpredictable-url">Unprotected admin functionality with unpredictable URL</a><li><a href="#user-role-controlled-by-request-parameter">User role controlled by request parameter</a><li><a href="#user-role-can-be-modified-in-user-profile">User role can be modified in user profile</a><li><a href="#url-based-access-control-can-be-circumvented">URL-based access control can be circumvented</a><li><a href="#method-based-access-control-can-be-circumvented">Method-based access control can be circumvented</a><li><a href="#user-id-controlled-by-request-parameter">User ID controlled by request parameter</a><li><a href="#user-id-controlled-by-request-parameter-with-unpredictable-user-ids">User ID controlled by request parameter, with unpredictable user IDs</a><li><a href="#user-id-controlled-by-request-parameter-with-data-leakage-in-redirect">User ID controlled by request parameter with data leakage in redirect</a><li><a href="#user-id-controlled-by-request-parameter-with-password-disclosure">User ID controlled by request parameter with password disclosure</a><li><a href="#insecure-direct-object-references">Insecure direct object references</a><li><a href="#multi-step-process-with-no-access-control-on-one-step">Multi-step process with no access control on one step</a><li><a href="#referer-based-access-control">Referer-based access control</a></ul><h1 id="theory">Theory</h1><p>Access control (or authorization) is the application of constraints on who (or what) can perform attempted actions or access resources that they have requested. In the context of web applications, access control is dependent on authentication and session management:</p><ul><li>Authentication identifies the user and confirms that they are who they say they are.<li>Session management identifies which subsequent HTTP requests are being made by that same user.<li>Access control determines whether the user is allowed to carry out the action that they are attempting to perform.</ul><h1 id="unprotected-admin-functionality">Unprotected admin functionality</h1><blockquote><p>This lab has an unprotected admin panel.</p><p>Solve the lab by deleting the user carlos.</p></blockquote><p>If we check the Site map we can find <code class="language-plaintext highlighter-rouge">/administrator-panel</code> which is present in <code class="language-plaintext highlighter-rouge">robots.txt</code></p><p><img data-src="/assets/images/51a1d5d2ee6cc2824c90441d054c2e3b4d9191caa85829364e30ba87977c2845.png" alt="picture 1" data-proofer-ignore></p><p>We can simply open the panel and delete the <code class="language-plaintext highlighter-rouge">carlos</code> and solve the lab</p><p><img data-src="/assets/images/43237d9ed1850aee13c797c78cb0c4d36cd73f3248edc439e34c5662347afe26.png" alt="picture 2" data-proofer-ignore></p><h1 id="unprotected-admin-functionality-with-unpredictable-url">Unprotected admin functionality with unpredictable URL</h1><blockquote><p>This lab has an unprotected admin panel. It’s located at an unpredictable location, but the location is disclosed somewhere in the application.</p><p>Solve the lab by accessing the admin panel, and using it to delete the user carlos</p></blockquote><p>This lab is very similar to the previous one, we however need to check the source to find the <code class="language-plaintext highlighter-rouge">Admin panel</code>.</p><p><img data-src="/assets/images/7d6f0796e20b7e75b116e99a5e52b7c2c74a567a5681b2a555a933ddec79da3a.png" alt="picture 4" data-proofer-ignore></p><p>When we access the <code class="language-plaintext highlighter-rouge">Admin panel</code>, we just have to delete <code class="language-plaintext highlighter-rouge">carlos</code> user to solve the lab.</p><p><img data-src="/assets/images/582fb9a13c11d1f57d0450775f5328b93b139b842180b4052f9f2508064cd996.png" alt="picture 5" data-proofer-ignore></p><p>Alternatively we could have a look in <code class="language-plaintext highlighter-rouge">LinkFinder</code>.</p><h1 id="user-role-controlled-by-request-parameter">User role controlled by request parameter</h1><blockquote><p>This lab has an admin panel at /admin, which identifies administrators using a forgeable cookie.</p><p>Solve the lab by accessing the admin panel and using it to delete the user carlos.</p><p>You can log in to your own account using the following credentials: wiener:peter</p></blockquote><p>Let’s login using provided credentials <code class="language-plaintext highlighter-rouge">wiener:carlos</code>:</p><p><img data-src="/assets/images/0e60237a8514fa936f798cd426911ca3d79017b1f4762f7d7e14d3b43a66bfda.png" alt="picture 6" data-proofer-ignore></p><p>If we check the request we can notice that administrator’s role is being controlled by cookie.</p><p><img data-src="/assets/images/42af96e60d76ed2085951c64156f9a44cd5203248206740c1e035578a07b5b06.png" alt="picture 7" data-proofer-ignore></p><p>We can change that cookie in the browser directly, or use <code class="language-plaintext highlighter-rouge">Match and replace</code></p><p><img data-src="/assets/images/f55e105c10ecff05793b91f49322374c836ab0071c364e0836907c02dfc241fd.png" alt="picture 8" data-proofer-ignore></p><p>Either way, go to <code class="language-plaintext highlighter-rouge">Admin panel</code> and delete <code class="language-plaintext highlighter-rouge">carlos</code> when done to solve the lab</p><p><img data-src="/assets/images/1bac2229f6de0f0f93511240064bddd3d5037def47fe62808a3e3c5a613b5c63.png" alt="picture 9" data-proofer-ignore></p><h1 id="user-role-can-be-modified-in-user-profile">User role can be modified in user profile</h1><blockquote><p>This lab has an admin panel at /admin. It’s only accessible to logged-in users with a roleid of 2.</p><p>Solve the lab by accessing the admin panel and using it to delete the user carlos.</p><p>You can log in to your own account using the following credentials: <code class="language-plaintext highlighter-rouge">wiener:peter</code></p></blockquote><p>First we have to login using provided credentials <code class="language-plaintext highlighter-rouge">wiener:peter</code>. If we make a change to profile - we can change Email address, we would notice <code class="language-plaintext highlighter-rouge">roleid</code> parameter in the request</p><p><img data-src="/assets/images/83e410d8fadc69704fcd2f21aee6b0681d4afc5d1d1dd754da7f961bf9a555ca.png" alt="picture 10" data-proofer-ignore></p><p>We can modify that parameter:</p><p><img data-src="/assets/images/eaa5cb7c33a8dd3e6308eed4356136141ede735b50cdee61d67927044a6dcc83.png" alt="picture 11" data-proofer-ignore></p><p>We can then go ahead and solve the lab by deleting <code class="language-plaintext highlighter-rouge">carlos</code> from <code class="language-plaintext highlighter-rouge">Admin panel</code></p><p><img data-src="/assets/images/cfba5b7a7b57777c619f6358da51f60d932ce4ebc3ddbcf2c110b8183e61a179.png" alt="picture 12" data-proofer-ignore></p><h1 id="url-based-access-control-can-be-circumvented">URL-based access control can be circumvented</h1><blockquote><p>This website has an unauthenticated admin panel at /admin, but a front-end system has been configured to block external access to that path. However, the back-end application is built on a framework that supports the X-Original-URL header.</p><p>To solve the lab, access the admin panel and delete the user <code class="language-plaintext highlighter-rouge">carlos</code>.</p></blockquote><p>Upon starting the lab, let us go to <code class="language-plaintext highlighter-rouge">Admin panel</code>:</p><p><img data-src="/assets/images/100260e8d5dac2683d5f725c625b36a9dd6f426037248ec641aaf669bd9f63d1.png" alt="picture 13" data-proofer-ignore></p><p>Disclaimer: We get <code class="language-plaintext highlighter-rouge">"Access denied"</code>.</p><p>Now at this point it was not clear to me what to do, as if i just go and add <code class="language-plaintext highlighter-rouge">X-Original-URL</code> header, we still end up with <code class="language-plaintext highlighter-rouge">Access denied</code> and cannot tell that Header is being used.</p><p>If we do that in root however <code class="language-plaintext highlighter-rouge">/</code> and place invalid header like <code class="language-plaintext highlighter-rouge">/invalid</code> (taken from Solution!), we get <code class="language-plaintext highlighter-rouge">404 Not Found</code> just because of <code class="language-plaintext highlighter-rouge">X-Original-URL</code> header.</p><p>Changing <code class="language-plaintext highlighter-rouge">X-Original-URL</code> value to <code class="language-plaintext highlighter-rouge">/admin</code>, leads us unauthenticated (!) directly to the <code class="language-plaintext highlighter-rouge">Admin panel</code>.</p><p><img data-src="/assets/images/4981814e003633ef00917c1c8915ff1e1ae81e71a2b0bb707bef2c5c4300f1fd.png" alt="picture 14" data-proofer-ignore></p><p>We now have to change the GET request to <code class="language-plaintext highlighter-rouge">/?username=carlos</code> and modify the header <code class="language-plaintext highlighter-rouge">X-Original-URL: /admin/delete</code></p><p><img data-src="/assets/images/62290795a19eb12d6d41d0767aba9bf655b569cc449199879fd47ab6f38b5f27.png" alt="picture 15" data-proofer-ignore></p><p>PS: <code class="language-plaintext highlighter-rouge">Match and replace</code> did not really work as then CSS,JS wasn’t loaded etc.</p><h1 id="method-based-access-control-can-be-circumvented">Method-based access control can be circumvented</h1><blockquote><p>This lab implements <a href="https://portswigger.net/web-security/access-control">access controls</a> based partly on the HTTP method of requests. You can familiarize yourself with the admin panel by logging in using the credentials <code class="language-plaintext highlighter-rouge">administrator:admin</code>.</p><p>To solve the lab, log in using the credentials wiener:peter and exploit the flawed access controls to promote yourself to become an administrator.</p></blockquote><p>As we were given this possibility we can login using provided <code class="language-plaintext highlighter-rouge">administrator:admin</code> credentials and promote <code class="language-plaintext highlighter-rouge">administrator</code> to admin again and check the request in burp to see what’s actualy going on.</p><p><img data-src="/assets/images/ab3496ed5f6eb9707dcb2da47f2e95dd3b83fa683184bbb059a4de008daaebc9.png" alt="picture 16" data-proofer-ignore></p><p>We cannot do it, but we’ve captured the request!</p><p><img data-src="/assets/images/0c53a4e518b0a20977cff6c5f4dfb0282aa024d662ce05ee51a1221d00d06591.png" alt="picture 17" data-proofer-ignore></p><p>Now login as <code class="language-plaintext highlighter-rouge">wiener:peter</code> and send a request to <code class="language-plaintext highlighter-rouge">/admin-roles</code>:</p><p><img data-src="/assets/images/79b6641ab95f485019c69c1f5f49fb265c1c2a039de81d1cf51688fdeaa43537.png" alt="picture 18" data-proofer-ignore></p><p><code class="language-plaintext highlighter-rouge">Unauthorized</code>. How about GET request?</p><p><img data-src="/assets/images/dd8fda20f41ed0eecc9eb91aa3f9f852e7f80c865165aea186e374af8e86a9b9.png" alt="picture 19" data-proofer-ignore></p><p>Now we see the message that <code class="language-plaintext highlighter-rouge">username</code> parameter is missing.</p><p>Can we upgrade ourselves (<code class="language-plaintext highlighter-rouge">wiener</code> = normal user) to administrator?</p><p><img data-src="/assets/images/779cdb80d112f48d02abaf5aa583438a017d658eaf91e5276cdec80f379f56d4.png" alt="picture 20" data-proofer-ignore></p><p>Sure we do &amp; another lab has been solved!</p><h1 id="user-id-controlled-by-request-parameter">User ID controlled by request parameter</h1><blockquote><p>This lab has a horizontal privilege escalation vulnerability on the user account page.</p><p>To solve the lab, obtain the API key for the user <code class="language-plaintext highlighter-rouge">carlos</code> and submit it as the solution.</p><p>You can log in to your own account using the following credentials: <code class="language-plaintext highlighter-rouge">wiener:peter</code></p></blockquote><p>When we login we get an API key assigned!</p><p><img data-src="/assets/images/b97f9bd94d886c17b5ec865f7ece2b6ec589b58c35a670c2c57970fce4ac1d8a.png" alt="picture 21" data-proofer-ignore></p><p>If we click on <code class="language-plaintext highlighter-rouge">My account</code> again, another request would be issued</p><p><img data-src="/assets/images/bc38786fede1dabcf5c979b3eaa9e8512482f9619c8579acaaaf1b6de3033e13.png" alt="picture 22" data-proofer-ignore></p><p>We can request for API from <code class="language-plaintext highlighter-rouge">carlos</code></p><p><img data-src="/assets/images/6703eaeaa264a2f9dc7c5b9c9858db04dd1fa8faa95816ae267d7664d2fd2383.png" alt="picture 23" data-proofer-ignore></p><p>Submit the API Key and solve the lab!</p><h1 id="user-id-controlled-by-request-parameter-with-unpredictable-user-ids">User ID controlled by request parameter, with unpredictable user IDs</h1><blockquote><p>This lab has a horizontal privilege escalation vulnerability on the user account page, but identifies users with GUIDs.</p><p>To solve the lab, find the GUID for <code class="language-plaintext highlighter-rouge">carlos</code>, then submit his API key as the solution.</p><p>You can log in to your own account using the following credentials: <code class="language-plaintext highlighter-rouge">wiener:peter</code></p></blockquote><p>If we login using <code class="language-plaintext highlighter-rouge">wiener:peter</code> credentials that were provided by us and check the <code class="language-plaintext highlighter-rouge">My account</code> link, we’ll see that it’s pointing to GUID from <code class="language-plaintext highlighter-rouge">wiener</code>.</p><p><img data-src="/assets/images/88e71316513cd2542fb0b52eeca7aeb2c0523d666d4b69b868c26c3ee3b5fb69.png" alt="picture 24" data-proofer-ignore></p><p>We would now need to find the place where we could display the GUID of <code class="language-plaintext highlighter-rouge">carlos</code>!</p><p>We can see that <code class="language-plaintext highlighter-rouge">carlos</code> has dropped few posts:</p><p><img data-src="/assets/images/2f7aa894afc0b8dca69cf722fb8bc9645403d4ae3135aff429d15d7762f8380a.png" alt="picture 25" data-proofer-ignore></p><p>If we check the source we’d find the <code class="language-plaintext highlighter-rouge">carlos</code>’s GUID</p><div class="language-html highlighter-rouge"><div class="code-header"> <span label-text="HTML"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">'/blogs?userId=a6e6c070-4117-4627-af43-e299301ae904'</span><span class="nt">&gt;</span>carlos<span class="nt">&lt;/a&gt;&lt;/span&gt;</span> | 12 September 2022<span class="nt">&lt;/p&gt;</span>
</pre></table></code></div></div><p>We can use it to display the API key:</p><p><img data-src="/assets/images/4521b31ae3807d1520828fb4463407b93e37dacb894a460563d0d67f0c208c2c.png" alt="picture 26" data-proofer-ignore></p><h1 id="user-id-controlled-by-request-parameter-with-data-leakage-in-redirect">User ID controlled by request parameter with data leakage in redirect</h1><blockquote><p>This lab contains an access control vulnerability where sensitive information is leaked in the body of a redirect response.</p><p>To solve the lab, obtain the API key for the user carlos and submit it as the solution.</p><p>You can log in to your own account using the following credentials: <code class="language-plaintext highlighter-rouge">wiener:peter</code></p></blockquote><p>Let’s login using provided credentials <code class="language-plaintext highlighter-rouge">wiener:peter</code></p><p><img data-src="/assets/images/88215b0c0b15f32682c75709fc958f49baad54c73cedd14266a2f4707871248f.png" alt="picture 27" data-proofer-ignore></p><p>If we again click on <code class="language-plaintext highlighter-rouge">My account</code> the id should be set.</p><p><img data-src="/assets/images/fa5765ef5989e51d6e71c47ce9c808b93e86635325f3b448e61daf5ce9c9a0b3.png" alt="picture 28" data-proofer-ignore></p><p>Now let’s swap it with <code class="language-plaintext highlighter-rouge">carlos</code> and check the Burp.</p><p>We can notice the <code class="language-plaintext highlighter-rouge">302</code> redirect however page will still load and disclose the API of <code class="language-plaintext highlighter-rouge">carlos</code>’s</p><p><img data-src="/assets/images/bbc5da93d013d5e9ddd74c93c59b6520b31b6c79a8bb9f39ccb10b2e81a21721.png" alt="picture 29" data-proofer-ignore></p><p>Submit the API key and solve the lab!</p><h1 id="user-id-controlled-by-request-parameter-with-password-disclosure">User ID controlled by request parameter with password disclosure</h1><blockquote><p>This lab has user account page that contains the current user’s existing password, prefilled in a masked input.</p><p>To solve the lab, retrieve the administrator’s password, then use it to delete carlos.</p><p>You can log in to your own account using the following credentials: <code class="language-plaintext highlighter-rouge">wiener:peter</code></p></blockquote><p>Let’s login using provided credentials <code class="language-plaintext highlighter-rouge">wiener:peter</code>. If we click on <code class="language-plaintext highlighter-rouge">My account</code> we would notice that password get’s loaded to the frontend which is weird.</p><p><img data-src="/assets/images/e7fea280e185445f24406b38670dd832950e74c0335ae3e636bb11e47a342bc1.png" alt="picture 30" data-proofer-ignore></p><p>Now, we can also achieve that for <code class="language-plaintext highlighter-rouge">administrator</code>.</p><p><img data-src="/assets/images/705c1698e0950aae901ae67e8affb1cf7bb9b7d7f516734f17a2619c7d1af57d.png" alt="picture 31" data-proofer-ignore></p><p>In order to solve the lab, we need to login using password found and login as <code class="language-plaintext highlighter-rouge">administrator</code> and delete <code class="language-plaintext highlighter-rouge">carlos</code>.</p><p><img data-src="/assets/images/3b1127e703962c24a17a89bc457029cc0a3aa25cde6a6dc243643acdf075a633.png" alt="picture 32" data-proofer-ignore></p><h1 id="insecure-direct-object-references">Insecure direct object references</h1><blockquote><p>This lab stores user chat logs directly on the server’s file system, and retrieves them using static URLs.</p><p>Solve the lab by finding the password for the user <code class="language-plaintext highlighter-rouge">carlos</code>, and logging into their account.</p></blockquote><p>We can make use of live chat in this lab.</p><p><img data-src="/assets/images/47c53cfd0dbe4c61c87062028a5a42a59e7cff3d5e7aa70fbe02305801f07c97.png" alt="picture 33" data-proofer-ignore></p><p>Live chat has <code class="language-plaintext highlighter-rouge">Download transcript</code> option and if we use it, we can see our chat history.</p><p><img data-src="/assets/images/315540709f9923e67dcf60fffd6f6f5d7e9d5f25d7c14408d672bf45de0b2b59.png" alt="picture 34" data-proofer-ignore></p><p>What happens if we swap the id of <code class="language-plaintext highlighter-rouge">2</code> with <code class="language-plaintext highlighter-rouge">1</code>?</p><p><img data-src="/assets/images/8a46b2651372e0551e186ecb5d8d74631c33f8df837f88b49dee4999df320c0f.png" alt="picture 35" data-proofer-ignore></p><p>Yeah, we can see the chat that belongs to other user along with the <code class="language-plaintext highlighter-rouge">carlos</code>s password which we can use to login and solve the lab.</p><h1 id="multi-step-process-with-no-access-control-on-one-step">Multi-step process with no access control on one step</h1><blockquote><p>This lab has an admin panel with a flawed multi-step process for changing a user’s role. You can familiarize yourself with the admin panel by logging in using the credentials <code class="language-plaintext highlighter-rouge">administrator:admin</code>.</p><p>To solve the lab, log in using the credentials <code class="language-plaintext highlighter-rouge">wiener:peter</code> and exploit the flawed access controls to promote yourself to become an <code class="language-plaintext highlighter-rouge">administrator</code>.</p></blockquote><p>Let’s login using <code class="language-plaintext highlighter-rouge">administrator:admin</code> that was provided to us.</p><p>User Promotion is done in 2 steps:</p><p><strong>FIRST REQUEST</strong> <img data-src="/assets/images/367fe34ec69f495a341ffc9ca4f3ad4ae6837c69e8e72277be322467ed6a74e9.png" alt="picture 36" data-proofer-ignore></p><p>POST Request</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre>POST /admin-roles HTTP/1.1
Host: 0afd004904aed73fc06eab33000b00a8.web-security-academy.net
Cookie: session=0C1CqV6e1kBdfkaON0eKHjwamc4GDKrO
...
Connection: close

username=administrator&amp;action=upgrade
</pre></table></code></div></div><p><strong>SECOND REQUEST</strong> <img data-src="/assets/images/4f74f8af6cc1b3f1756d0886c731fd3b50fb06f85e022e93197cc81d31b3f46d.png" alt="picture 37" data-proofer-ignore></p><p>POST Request</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre>POST /admin-roles HTTP/1.1
Host: 0afd004904aed73fc06eab33000b00a8.web-security-academy.net
Cookie: session=0C1CqV6e1kBdfkaON0eKHjwamc4GDKrO
...
Connection: close

action=upgrade&amp;confirmed=true&amp;username=administrator
</pre></table></code></div></div><p>Now let’s try replay same requests using <code class="language-plaintext highlighter-rouge">wiener</code> user.</p><p>Replaying first request ends with <code class="language-plaintext highlighter-rouge">401 Unauthorized</code>:</p><p><img data-src="/assets/images/a2581e0f0aeb5e87d64ff5f2d8c858bf1f47bd8d01a8d49fd1ea536f09cfd9a6.png" alt="picture 38" data-proofer-ignore></p><p>Replaying second request seems to work! :)</p><p><img data-src="/assets/images/211edf0c7de8237bb0a416a82fb5078f878635ee7566006917262d1451343f1a.png" alt="picture 39" data-proofer-ignore></p><p>To solve the lab, simply promote <code class="language-plaintext highlighter-rouge">wiener</code> like seen in the screenshot above.</p><h1 id="referer-based-access-control">Referer-based access control</h1><blockquote><p>This lab controls access to certain admin functionality based on the Referer header. You can familiarize yourself with the admin panel by logging in using the credentials administrator:admin.</p><p>To solve the lab, log in using the credentials wiener:peter and exploit the flawed access controls to promote yourself to become an administrator.</p></blockquote><p>Let’s login using provided <code class="language-plaintext highlighter-rouge">administrator:admin</code> and try to promote <code class="language-plaintext highlighter-rouge">carlos</code> user.</p><p><img data-src="/assets/images/8fa10d1511ff4ad5c235fa44d8f5859b77c7bb99c7f30376b7b4cdeadbe1c1ee.png" alt="picture 40" data-proofer-ignore></p><p>Send the query above to <code class="language-plaintext highlighter-rouge">Burp Repeater</code></p><p>Let’s login using<code class="language-plaintext highlighter-rouge">wiener:peter</code> and try to use the <code class="language-plaintext highlighter-rouge">wiener</code>’s session. It will work if <code class="language-plaintext highlighter-rouge">Referer</code> header is set to <code class="language-plaintext highlighter-rouge">hostname/admin</code>.</p><p><img data-src="/assets/images/8752f06445ed0ce06f2a11fc7cb640512b641548489ead52c64d1531a272b06c.png" alt="picture 42" data-proofer-ignore></p><p>Lab has been solved.</p><p><img data-src="/assets/images/5b8e3291e774c769c22892099401ff09b2477b4d4443490f2603d89512c2fe84.png" alt="picture 41" data-proofer-ignore></p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/web-application/'>Web Application</a>, <a href='/categories/broken-access-control/'>Broken Access Control</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/notes/" class="post-tag no-text-decoration" >Notes</a> <a href="/tags/web-application/" class="post-tag no-text-decoration" >Web Application</a> <a href="/tags/portswigger/" class="post-tag no-text-decoration" >Portswigger</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Broken Access Control - CyberSec-Research.Space&url=https://an9k0r.github.io/posts/Broken_Access_Control/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Broken Access Control - CyberSec-Research.Space&u=https://an9k0r.github.io/posts/Broken_Access_Control/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Broken Access Control - CyberSec-Research.Space&url=https://an9k0r.github.io/posts/Broken_Access_Control/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/insecure_deserialization/">(Portswigger/WebAcademy) - Insecure Deserialization vulnerabilities</a><li><a href="/posts/ssti/">(Portswigger/WebAcademy) - Server-Side Template Injection vulnerabilities</a><li><a href="/posts/stored_XSS/">(Portswigger/WebAcademy) - Stored Cross-Site Scripting (XSS)</a><li><a href="/posts/Blind_SQL_Injection/">Blind SQL Injection</a><li><a href="/posts/OS_Command_Injection/">OS Command Injection</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/notes/">Notes</a> <a class="post-tag" href="/tags/portswigger/">Portswigger</a> <a class="post-tag" href="/tags/web-application/">Web Application</a> <a class="post-tag" href="/tags/linux/">Linux</a> <a class="post-tag" href="/tags/clear-text-credentials/">Clear Text Credentials</a> <a class="post-tag" href="/tags/password-reuse/">Password Reuse</a> <a class="post-tag" href="/tags/windows/">Windows</a> <a class="post-tag" href="/tags/deserialization/">Deserialization</a> <a class="post-tag" href="/tags/misconfiguration/">Misconfiguration</a> <a class="post-tag" href="/tags/password-cracking/">Password Cracking</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/Blind_SQL_Injection/"><div class="card-body"> <em class="timeago small" date="2022-09-30 09:00:00 +0200" >Sep 30, 2022</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Blind SQL Injection</h3><div class="text-muted small"><p> Intro Lab at portswigger: Blind SQL Injection TOC Intro TOC Blind SQL injection with conditional responses Intro Finding the SQL Injection Database Enumeration ...</p></div></div></a></div><div class="card"> <a href="/posts/Alternative_vulnerable_authentication_mechanismus/"><div class="card-body"> <em class="timeago small" date="2022-09-30 09:00:00 +0200" >Sep 30, 2022</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Other vulnerable Authentication Mechanismus</h3><div class="text-muted small"><p> Intro This post/writeup is all about the Authentication vulnerabilities or Broken Authentication if we follow OWASP naming scheme. I’ll be using primarily Portswigger Web Academy Labs, but i do in...</p></div></div></a></div><div class="card"> <a href="/posts/Multi_Factor_Authentication/"><div class="card-body"> <em class="timeago small" date="2022-09-30 09:00:00 +0200" >Sep 30, 2022</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Multi-Factor Authentication (MFA)</h3><div class="text-muted small"><p> Intro This post/writeup is all about the Authentication vulnerabilities or Broken Authentication if we follow OWASP naming scheme. I’ll be using primarily Portswigger Web Academy Labs, but i do in...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/Information_Disclosure/" class="btn btn-outline-primary" prompt="Older"><p>Information Disclosure</p></a> <a href="/posts/File_Upload/" class="btn btn-outline-primary" prompt="Newer"><p>File Upload Vulnerabilities</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center text-muted"><div class="footer-left"><p class="mb-0"> © 2023 <a href="https://twitter.com/cybersec_space">eng4ge</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/notes/">Notes</a> <a class="post-tag" href="/tags/portswigger/">Portswigger</a> <a class="post-tag" href="/tags/web-application/">Web Application</a> <a class="post-tag" href="/tags/linux/">Linux</a> <a class="post-tag" href="/tags/clear-text-credentials/">Clear Text Credentials</a> <a class="post-tag" href="/tags/password-reuse/">Password Reuse</a> <a class="post-tag" href="/tags/windows/">Windows</a> <a class="post-tag" href="/tags/deserialization/">Deserialization</a> <a class="post-tag" href="/tags/misconfiguration/">Misconfiguration</a> <a class="post-tag" href="/tags/password-cracking/">Password Cracking</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><script src="https://cdn.jsdelivr.net/npm/mermaid@8/dist/mermaid.min.js"></script> <script> $(function() { function updateMermaid(event) { if (event.source === window && event.data && event.data.direction === ModeToggle.ID) { const mode = event.data.message; if (typeof mermaid === "undefined") { return; } let expectedTheme = (mode === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* Re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } let initTheme = "default"; if ($("html[mode=dark]").length > 0 || ($("html[mode]").length == 0 && window.matchMedia("(prefers-color-scheme: dark)").matches ) ) { initTheme = "dark"; } let mermaidConf = { theme: initTheme /* <default|dark|forest|neutral> */ }; /* Markdown converts to HTML */ $("pre").has("code.language-mermaid").each(function() { let svgCode = $(this).children().html(); $(this).addClass("unloaded"); $(this).after(`<div class=\"mermaid\">${svgCode}</div>`); }); mermaid.initialize(mermaidConf); window.addEventListener("message", updateMermaid); }); </script><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script> /* see: <https://docs.mathjax.org/en/latest/options/input/tex.html#tex-options> */ MathJax = { tex: { inlineMath: [ /* start/end delimiter pairs for in-line math */ ['$','$'], ['\\(','\\)'] ], displayMath: [ /* start/end delimiter pairs for display math */ ['$$', '$$'], ['\\[', '\\]'] ] } }; </script> <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script type="text/javascript" id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"> </script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.16.1,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/app.js"></script>
